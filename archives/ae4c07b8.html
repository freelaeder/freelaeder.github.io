<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>typeScript基础知识 | freelaeder</title><meta name="keywords" content="typeScript基础知识,typeScript"><meta name="author" content="freelaeder"><meta name="copyright" content="freelaeder"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="TypeScript 教程1. TypeScript 概述1.1 TypeScript 是什么 TypeScript 是一门基于 JavaScript 的编程语言，它是具有类型系统的 JavaScript，是一种解决 JavaScript 缺点的编程语言。 12345&#x2F;&#x2F; 所有的 JavaScript 代码都是合法的 TypeScript 代码。var a &#x3D; 10;function fn ()">
<meta property="og:type" content="article">
<meta property="og:title" content="typeScript基础知识">
<meta property="og:url" content="http://mail.freelaeder.cn/archives/ae4c07b8.html">
<meta property="og:site_name" content="freelaeder">
<meta property="og:description" content="TypeScript 教程1. TypeScript 概述1.1 TypeScript 是什么 TypeScript 是一门基于 JavaScript 的编程语言，它是具有类型系统的 JavaScript，是一种解决 JavaScript 缺点的编程语言。 12345&#x2F;&#x2F; 所有的 JavaScript 代码都是合法的 TypeScript 代码。var a &#x3D; 10;function fn ()">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://mail.freelaeder.cn/img/wallseven/wallseven27.png">
<meta property="article:published_time" content="2022-07-01T01:53:00.000Z">
<meta property="article:modified_time" content="2022-07-01T02:40:29.029Z">
<meta property="article:author" content="freelaeder">
<meta property="article:tag" content="typeScript基础知识">
<meta property="article:tag" content="typeScript">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://mail.freelaeder.cn/img/wallseven/wallseven27.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://mail.freelaeder.cn/archives/ae4c07b8"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="codeva-eGsV8jUImL"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":366},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":50,"languages":{"author":"Author: freelaeder","link":"Link: ","source":"Source: freelaeder","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  lightbox: 'mediumZoom',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'typeScript基础知识',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-07-01 10:40:29'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><link rel="stylesheet" href="/css/main.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/header.svg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">100</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">103</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">16</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> freelaeder</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> hole</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/fine/"><i class="fa-fw fas fa-list"></i><span> fine</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> friends</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> me</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/wallseven/wallseven27.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">freelaeder</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> freelaeder</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> hole</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/fine/"><i class="fa-fw fas fa-list"></i><span> fine</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> friends</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> me</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">typeScript基础知识</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-07-01T01:53:00.000Z" title="Created 2022-07-01 09:53:00">2022-07-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-07-01T02:40:29.029Z" title="Updated 2022-07-01 10:40:29">2022-07-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/typeScript/">typeScript</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">31.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>131min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="typeScript基础知识"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="TypeScript-教程"><a href="#TypeScript-教程" class="headerlink" title="TypeScript 教程"></a><strong>TypeScript</strong> 教程</h1><h2 id="1-TypeScript-概述"><a href="#1-TypeScript-概述" class="headerlink" title="1. TypeScript 概述"></a>1. TypeScript 概述</h2><h3 id="1-1-TypeScript-是什么"><a href="#1-1-TypeScript-是什么" class="headerlink" title="1.1 TypeScript 是什么"></a>1.1 TypeScript 是什么</h3><ul>
<li><p>TypeScript 是一门基于 JavaScript 的编程语言，它是具有类型系统的 JavaScript，是一种解决 JavaScript 缺点的编程语言。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 所有的 JavaScript 代码都是合法的 TypeScript 代码。</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TypeScript 是静态类型编程语言，即编译期间进行类型检查，变量、参数、返回值等都必须有固定的类型。</span></span><br><span class="line"><span class="keyword">let</span> x: <span class="built_in">number</span> = <span class="number">10</span>;</span><br><span class="line">x = <span class="number">20</span>;  <span class="comment">// ✅</span></span><br><span class="line">x = <span class="string">&quot;a&quot;</span>; <span class="comment">// ❎</span></span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://s1.ax1x.com/2022/07/01/jMhJKJ.png" /></p>
</li>
</ul>
<ul>
<li><p>TypeScript 不能在浏览器环境或者 Node 环境直接运行，它在执行前需要先被编译为 JavaScript。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TypeScript</span></span><br><span class="line"><span class="keyword">let</span> isLogin: <span class="built_in">boolean</span> = <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Javascript</span></span><br><span class="line"><span class="keyword">let</span> isLogin = <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>
<p>TypeScript 提供的类型系统只应用在开发阶段，只有在开发阶段开发者才需要借助它编写出更加健壮的程序。<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/ts/images/03.png" /></p>
</li>
<li><p>TypeScript 由微软发布，第一个正式版的发布时间为是2013年6月19日。<br><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/ts/images/01.png" /></p>
</li>
</ul>
<h3 id="1-2-类型系统带来的好处"><a href="#1-2-类型系统带来的好处" class="headerlink" title="1.2 类型系统带来的好处"></a>1.2 类型系统带来的好处</h3><p>通过静态类型检查可以让开发者在编译时就发现错误而不是在代码运行时。</p>
<p>类型系统为编辑器带来了更加精准的代码提示，以此来提升开发人员的编程体验。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.</span><br><span class="line">    send</span><br><span class="line">    sendDate</span><br><span class="line">    sendfile</span><br><span class="line">    sendFile</span><br><span class="line">    sendStatus</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>在声明变量时明确告知编译器它的类型，编译器就知道该变量可以调用哪些属性和方法，当开发者调用了错误的属性或方法时，编译器会及时给出提示。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name: <span class="built_in">string</span> = <span class="string">&quot;张三&quot;</span>;</span><br><span class="line">name.toFixed(<span class="number">2</span>); <span class="comment">// 属性&quot;toFixed&quot;在类型&quot;string&quot;上不存在</span></span><br></pre></td></tr></table></figure>
<p>在声明函数时明确告知编译器参数的类型，当开发者调用该函数时如果传递的参数的类型不正确，编译器会及时给出提示。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>) </span>&#123;&#125;</span><br><span class="line">sum(<span class="number">10</span>, <span class="string">&quot;a&quot;</span>); <span class="comment">// 类型&quot;string&quot;的参数不能赋给类型&quot;number&quot;的参数。</span></span><br></pre></td></tr></table></figure>
<p>在声明函数时明确告知编译器返回值的类型，当开发者返回的值的类型错误时，编译器会及时给出提示。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayHello</span>(<span class="params"></span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">100</span>; <span class="comment">// 不能将类型&quot;number&quot;分配给类型&quot;string&quot;。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在声明对象时告知编译器该对象下有哪些属性，当开发者访问了对象中不存在的属性时，编译器会及时给出提示。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123; <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span> &#125;;</span><br><span class="line">person.age; <span class="comment">// 类型&quot;&#123;name: string&#125;&quot;上不存在属性&quot;age&quot;。</span></span><br></pre></td></tr></table></figure>
<p>类型系统使代码变得可预测，能够让开发者更早的发现代码存在的问题和潜在问题。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123; &#125;</span><br><span class="line"><span class="built_in">console</span>.log(i); <span class="comment">// 编译器会捕获到错误: cannot find name &quot;i&quot;</span></span><br></pre></td></tr></table></figure>
<p>当重复声明同名变量时，编译器会立即给出提示。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> colors = [<span class="string">&quot;red&quot;</span>, <span class="string">&quot;green&quot;</span>, <span class="string">&quot;blue&quot;</span>];</span><br><span class="line"><span class="comment">// 无法重新声明块范围变量&quot;colors&quot;。</span></span><br><span class="line"><span class="keyword">let</span> colors = [<span class="string">&quot;red&quot;</span>, <span class="string">&quot;green&quot;</span>, <span class="string">&quot;blue&quot;</span>];</span><br></pre></td></tr></table></figure>
<h2 id="2-TypeScript-初体验"><a href="#2-TypeScript-初体验" class="headerlink" title="2. TypeScript 初体验"></a>2. TypeScript 初体验</h2><h3 id="2-1-第一个-TypeScript-应用"><a href="#2-1-第一个-TypeScript-应用" class="headerlink" title="2.1 第一个 TypeScript 应用"></a>2.1 第一个 TypeScript 应用</h3><blockquote>
<p>需求：向服务端发送请求获取 ID 为 1 的任务对象。</p>
<p>目标：将 TypeScript 编译为 JavaScript。</p>
</blockquote>
<hr>
<ul>
<li>[ ] 安装 TypeScript 编译器，用于将 TypeScript 代码编译为 JavaScript 代码</li>
<li>[ ] 安装 axios 库，用于发送请求</li>
<li>[ ] 新建 index.ts 文件，用于编写代码</li>
<li>[ ] 将 TypeScript 代码编译为 JavaScript 代码并执行</li>
</ul>
<hr>
<p>第一步：安装 TypeScript 编译器，用于将 TypeScript 代码编译为 JavaScript 代码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局安装 typescript 编译器</span></span><br><span class="line">npm install -g typescript</span><br><span class="line"><span class="comment"># 通过查看 typescript 编译器版本验证编译器是否安装成功</span></span><br><span class="line">tsc -version</span><br></pre></td></tr></table></figure>
<p>第二步：安装 axios 库，用于发送请求。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 axios 用于发送请求</span></span><br><span class="line">npm install axios</span><br></pre></td></tr></table></figure>
<p>第三步：新建 index.ts 文件用于编写代码，TypeScript 程序文件的后缀名为 <code>.ts</code>。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"></span><br><span class="line">axios.get(<span class="string">&quot;https://jsonplaceholder.typicode.com/todos/1&quot;</span>).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(response.data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>第四步：将 TypeScript 代码编译为 JavaScript 代码并执行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编译 index.ts 文件, 编译后在同级目录下会多出 index.js 文件, 该文件存储的就是编译后的 JavaScript 代码</span></span><br><span class="line">tsc index.ts</span><br><span class="line"><span class="comment"># 执行 JavaScript 代码</span></span><br><span class="line">node index.js</span><br></pre></td></tr></table></figure>
<h3 id="2-2-优化工作流"><a href="#2-2-优化工作流" class="headerlink" title="2.2 优化工作流"></a>2.2 优化工作流</h3><blockquote>
<p>目标：监控 TypeScript 文件的变化，实现自动编译、自动执行代码</p>
</blockquote>
<hr>
<ul>
<li><p>[ ] 安装 nodemon、ts-node</p>
</li>
<li><p>[ ] 创建应用启动脚本</p>
</li>
<li>[ ] 通过应用启动脚本启动应用</li>
</ul>
<hr>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nodemon: 监听文件的变化, 当 TypeScript 文件内容发生变动后调用 ts-node</span></span><br><span class="line"><span class="comment"># ts-node: 将 TypeScript 编译为 JavaScript 并执行</span></span><br><span class="line">npm install -g nodemon ts-node</span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="attr">&quot;start&quot;</span>: <span class="string">&quot;nodemon index.ts&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure>
<p>tsc 与 ts-node 的主要区别在于 tsc 根据您的 tsconfig 编译所有文件。ts-node 会从入口文件开始，并根据导入/导出逐步转译文件。</p>
<h3 id="2-3-体验类型带来的好处"><a href="#2-3-体验类型带来的好处" class="headerlink" title="2.3 体验类型带来的好处"></a>2.3 体验类型带来的好处</h3><p>需求：将任务ID、任务名称、任务是否完成分别输出到控制台中。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"></span><br><span class="line">axios.get(<span class="string">&quot;https://jsonplaceholder.typicode.com/todos/1&quot;</span>).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> todo = response.data;</span><br><span class="line">  <span class="keyword">const</span> id = todo.ID;</span><br><span class="line">  <span class="keyword">const</span> title = todo.Title;</span><br><span class="line">  <span class="keyword">const</span> finished = todo.finished;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`</span></span><br><span class="line"><span class="string">    任务的ID是: <span class="subst">$&#123;id&#125;</span>,</span></span><br><span class="line"><span class="string">    任务的名称是: <span class="subst">$&#123;title&#125;</span>,</span></span><br><span class="line"><span class="string">    任务是否完成: <span class="subst">$&#123;finished&#125;</span></span></span><br><span class="line"><span class="string">  `</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>以上代码执行后，输出的结果都是 undefined，发生了什么？</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">任务的ID是: undefined,</span><br><span class="line">任务的名称是: undefined,</span><br><span class="line">任务是否完成: undefined</span><br></pre></td></tr></table></figure>
<p>通过查看得知，任务 ID 对应的属性名称是 id，任务名称对应的属性名称是 title，任务是否完成对应的属性名称是 completed，原来是属性名称写错了。</p>
<p>目前的问题是在书写代码的过程中并没有任何的错误提示，只有代码运行以后开发者才能够知道代码中存在错误，这个问题应该怎么解决呢？</p>
<p>显式告知 TypeScript 编译器 response.data 中存储的数据的类型，编译器会实时检测你写的代码是否符合类型上的要求。</p>
<p>以下代码展示的是通过 TypeScript 约束对象中可以存在的属性，当访问了不存在的属性时编译器会实时进行提示。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// interface 意为接口, 可以约束对象中可以有哪些属性, 约束对象中属性的类型 </span></span><br><span class="line"><span class="keyword">interface</span> Todo &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">  title: <span class="built_in">string</span>;</span><br><span class="line">  completed: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">axios.get(<span class="string">&quot;https://jsonplaceholder.typicode.com/todos/1&quot;</span>).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> todo = response.data <span class="keyword">as</span> Todo;</span><br><span class="line">  <span class="keyword">const</span> id = todo.ID; <span class="comment">// 属性&quot;Id&quot;在类型&quot;Todo&quot;上不存在。你是否指的是&quot;id&quot;?</span></span><br><span class="line">  <span class="keyword">const</span> title = todo.Title; <span class="comment">// 属性&quot;Title&quot;在类型“Todo&quot;上不存在。你是否指的是&quot;title&quot;?</span></span><br><span class="line">  <span class="keyword">const</span> finished = todo.finished; <span class="comment">// 属性&quot;finished&quot;在类型&quot;Todo&quot;上不存在。</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`</span></span><br><span class="line"><span class="string">    任务的ID是: <span class="subst">$&#123;id&#125;</span>, </span></span><br><span class="line"><span class="string">    任务的名称是: <span class="subst">$&#123;title&#125;</span>, </span></span><br><span class="line"><span class="string">    任务是否结束: <span class="subst">$&#123;finished&#125;</span></span></span><br><span class="line"><span class="string">  `</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>以下代码展示的是通过 TypeScript 约束函数参数的类型，调用函数时如果传入的参数类型错误，编译器会实时进行提示。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Todo &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">  title: <span class="built_in">string</span>;</span><br><span class="line">  completed: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">axios.get(<span class="string">&quot;https://jsonplaceholder.typicode.com/todos/1&quot;</span>).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> todo = response.data <span class="keyword">as</span> Todo;</span><br><span class="line">  <span class="keyword">const</span> id = todo.id;</span><br><span class="line">  <span class="keyword">const</span> title = todo.title;</span><br><span class="line">  <span class="keyword">const</span> completed = todo.completed;</span><br><span class="line">  logTodo(title, id, completed); <span class="comment">// 类型&quot;string&quot;的参数不能赋给类型&quot;number&quot;的参数。</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logTodo</span>(<span class="params">id: <span class="built_in">number</span>, title: <span class="built_in">string</span>, completed: <span class="built_in">boolean</span></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`</span></span><br><span class="line"><span class="string">  任务的ID是: <span class="subst">$&#123;id&#125;</span>,</span></span><br><span class="line"><span class="string">  任务的名称是: <span class="subst">$&#123;title&#125;</span>,</span></span><br><span class="line"><span class="string">  任务是否结束: <span class="subst">$&#123;completed&#125;</span></span></span><br><span class="line"><span class="string">`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-TypeScript-基础类型"><a href="#3-TypeScript-基础类型" class="headerlink" title="3. TypeScript 基础类型"></a>3. TypeScript 基础类型</h2><h3 id="3-1-概述"><a href="#3-1-概述" class="headerlink" title="3.1 概述"></a>3.1 概述</h3><p>在 TypeScript 中，开发者可以通过类型注释对变量、参数、返回值的类型进行标注。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>JavaScript</th>
<th>TypeScript</th>
</tr>
</thead>
<tbody>
<tr>
<td>number</td>
<td>any</td>
</tr>
<tr>
<td>string</td>
<td>unknow</td>
</tr>
<tr>
<td>boolean</td>
<td>never</td>
</tr>
<tr>
<td>null</td>
<td>enum</td>
</tr>
<tr>
<td>undefined</td>
<td>tuple</td>
</tr>
<tr>
<td>object</td>
</tr>
</tbody>
</table>
</div>
<h3 id="3-2-基本数据类型"><a href="#3-2-基本数据类型" class="headerlink" title="3.2 基本数据类型"></a>3.2 基本数据类型</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数值类型</span></span><br><span class="line"><span class="keyword">let</span> apples: <span class="built_in">number</span> = <span class="number">5</span>;</span><br><span class="line"><span class="comment">// 字符串类型</span></span><br><span class="line"><span class="keyword">let</span> speed: <span class="built_in">string</span> = <span class="string">&quot;fast&quot;</span>;</span><br><span class="line"><span class="comment">// 布尔值布尔</span></span><br><span class="line"><span class="keyword">let</span> hasName: <span class="built_in">boolean</span> = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TS2322: Type &#x27;string&#x27; is not assignable to type &#x27;number&#x27;</span></span><br><span class="line"><span class="comment">// 类型 &#x27;string&#x27; 不能分配给类型为 &#x27;number&#x27;</span></span><br><span class="line">apples = <span class="string">&quot;5&quot;</span>;    <span class="comment">// ❎</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// TS2322: Type &#x27;number&#x27; is not assignable to type &#x27;string&#x27;.</span></span><br><span class="line"><span class="comment">// 类型 &#x27;number&#x27; 不能分配给类型 &#x27;string&#x27;</span></span><br><span class="line">speed = <span class="number">120</span>;     <span class="comment">// ❎</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// TS2322: Type &#x27;string&#x27; is not assignable to type &#x27;boolean&#x27;.</span></span><br><span class="line"><span class="comment">// 类型 &#x27;string&#x27; 不能分类给类型 &#x27;boolean&#x27;</span></span><br><span class="line">hasName = <span class="string">&quot;yes&quot;</span>; <span class="comment">// ❎</span></span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://files.catbox.moe/tclcf5.png" alt=""></p>
<h3 id="3-3-any-类型"><a href="#3-3-any-类型" class="headerlink" title="3.3 any 类型"></a>3.3 any 类型</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// any 类型</span></span><br><span class="line"><span class="comment">// 变量中可以存储任何数据类型的值</span></span><br><span class="line"><span class="keyword">let</span> anything: <span class="built_in">any</span> = <span class="string">&quot;Hello TypeScript&quot;</span>;</span><br><span class="line">anything = <span class="literal">true</span>;           <span class="comment">// ✅</span></span><br><span class="line">anything = <span class="number">3.14</span>;           <span class="comment">// ✅</span></span><br><span class="line">anything = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;; <span class="comment">// ✅</span></span><br><span class="line">anything = <span class="literal">null</span>;           <span class="comment">// ✅</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4-数组-Array"><a href="#3-4-数组-Array" class="headerlink" title="3.4 数组 Array"></a>3.4 数组 Array</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在没有为数组显式标注类型时, 变量的初始值又是一个空数组</span></span><br><span class="line"><span class="comment">// 此时该数组中可以存储任何类型的值</span></span><br><span class="line"><span class="comment">// 虽然写法正确, 但丢失了 TypeScript 类型检查功能</span></span><br><span class="line"><span class="comment">// let colors = any[];</span></span><br><span class="line"><span class="keyword">let</span> colors = [];</span><br><span class="line"></span><br><span class="line">colors[<span class="number">0</span>] = <span class="number">1</span>;        <span class="comment">// ✅</span></span><br><span class="line">colors[<span class="number">1</span>] = <span class="string">&quot;hello&quot;</span>;  <span class="comment">// ✅</span></span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 字符串数组</span></span><br><span class="line"><span class="keyword">let</span> colors: <span class="built_in">string</span>[] = [<span class="string">&quot;red&quot;</span>, <span class="string">&quot;green&quot;</span>, <span class="string">&quot;blue&quot;</span>];</span><br><span class="line"><span class="comment">// 数值数组</span></span><br><span class="line"><span class="keyword">let</span> numbers: <span class="built_in">number</span>[] = [<span class="number">100</span>, <span class="number">200</span>, <span class="number">300</span>];</span><br><span class="line"><span class="comment">// 布尔数组</span></span><br><span class="line"><span class="keyword">let</span> bools: <span class="built_in">boolean</span>[] = [<span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">false</span>];</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 二维数组</span></span><br><span class="line"><span class="keyword">const</span> carMakers: <span class="built_in">string</span>[][] = [[<span class="string">&quot;宝马&quot;</span>, <span class="string">&quot;比亚迪&quot;</span>]];</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// item: string</span></span><br><span class="line">colors.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;&#125;);</span><br><span class="line"><span class="comment">// let colors: string[]</span></span><br><span class="line">colors[<span class="number">0</span>];</span><br></pre></td></tr></table></figure>
<h3 id="3-5-元组-Tuples"><a href="#3-5-元组-Tuples" class="headerlink" title="3.5 元组 Tuples"></a>3.5 元组 Tuples</h3><p>观察下列代码中存在的问题。</p>
<p>在 employee 数组中我们约定在数组中下标为0的位置存储员工姓名，在下标为1的位置存储员工的年龄。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> employee = [<span class="string">&quot;张三&quot;</span>, <span class="number">20</span>];</span><br><span class="line">employee[<span class="number">0</span>] = <span class="number">30</span>;</span><br><span class="line">employee[<span class="number">1</span>] = <span class="string">&quot;李四&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>以上代码存在的问题是 employee 数组没有被类型系统约束，没有约束每个数组元素对应的类型，导致在错误位置修改元素值时没有错误提示。</p>
<p>元组是 TypeScript 引入的一种新数据类型，它像数组一样工作但是有一些额外的限制：元组中元素个数是固定，元组中元素类型已知。</p>
<p>元组用来存储一些以特定顺序出现且相关关联的数据，通过元组可以约束元素个数及元素类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> employee: [<span class="built_in">string</span>, <span class="built_in">number</span>] = [<span class="string">&quot;张三&quot;</span>, <span class="number">20</span>];</span><br><span class="line"><span class="comment">// 不能将类型&quot;number&quot;分配给类型&quot;string&quot;</span></span><br><span class="line">employee[<span class="number">0</span>] = <span class="number">30</span>;</span><br><span class="line"><span class="comment">// 不能将类型&quot;string&quot;分配给类型&quot;number&quot;</span></span><br><span class="line">employee[<span class="number">1</span>] = <span class="string">&quot;李四&quot;</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用元组存储 RGB 颜色值及透明度</span></span><br><span class="line"><span class="keyword">var</span> bgColor: [<span class="built_in">number</span>, <span class="built_in">number</span>, <span class="built_in">number</span>, <span class="built_in">number</span>] = [<span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.5</span>];</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建元组数组(二维数组)</span></span><br><span class="line"><span class="keyword">var</span> employees: [<span class="built_in">number</span>, <span class="built_in">string</span>][] = [</span><br><span class="line">  [<span class="number">1</span>, <span class="string">&quot;Steve&quot;</span>],</span><br><span class="line">  [<span class="number">2</span>, <span class="string">&quot;Tom&quot;</span>],</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<h3 id="3-6-枚举-Enum"><a href="#3-6-枚举-Enum" class="headerlink" title="3.6 枚举 Enum"></a>3.6 枚举 Enum</h3><p>枚举用于存储一组密切相关且有限的值，可以提升代码的可读性，可以限定值的范围，比如比赛结果，考试成绩，颜色种类，性别等等。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">enum</span> Sizes &#123;</span><br><span class="line">  Small,  <span class="comment">// Small = 0</span></span><br><span class="line">  Medium, <span class="comment">// Medium = 1</span></span><br><span class="line">  Large,  <span class="comment">// Large = 2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(Sizes.Small); <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">enum</span> Sizes &#123;</span><br><span class="line">  Small = <span class="number">1</span>,  <span class="comment">// Small = 1</span></span><br><span class="line">  Medium,     <span class="comment">// Medium = 2</span></span><br><span class="line">  Large,      <span class="comment">// Large = 3</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(Sizes.Small); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果枚举值为非数值, 则每个属性都必须进行初始化</span></span><br><span class="line"><span class="built_in">enum</span> Sizes &#123;</span><br><span class="line">  Small = <span class="string">&quot;s&quot;</span>,</span><br><span class="line">  Medium = <span class="string">&quot;m&quot;</span>,</span><br><span class="line">  Large = <span class="string">&quot;l&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(Sizes.Small); <span class="comment">// s</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 枚举被编译为了 JavaScript 中的对象</span></span><br><span class="line"><span class="keyword">var</span> Sizes;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">Sizes</span>) </span>&#123;</span><br><span class="line">    Sizes[<span class="string">&quot;Small&quot;</span>] = <span class="string">&quot;s&quot;</span>;</span><br><span class="line">    Sizes[<span class="string">&quot;Medium&quot;</span>] = <span class="string">&quot;m&quot;</span>;</span><br><span class="line">    Sizes[<span class="string">&quot;Large&quot;</span>] = <span class="string">&quot;l&quot;</span>;</span><br><span class="line">&#125;)(Sizes || (Sizes = &#123;&#125;));</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在声明枚举类型时, 如果使用 const 关键字, TypeScript 编译器将输出更加简洁的代码</span></span><br><span class="line"><span class="keyword">const</span> <span class="built_in">enum</span> Sizes &#123;</span><br><span class="line">  Small = <span class="string">&quot;s&quot;</span>,</span><br><span class="line">  Medium = <span class="string">&quot;m&quot;</span>,</span><br><span class="line">  Large = <span class="string">&quot;l&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> selected = Sizes.Large;</span><br><span class="line"><span class="built_in">console</span>.log(selected);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这是以上代码的编译结果</span></span><br><span class="line"><span class="keyword">var</span> selected = <span class="string">&quot;l&quot;</span> <span class="comment">/* Large */</span>;</span><br><span class="line"><span class="built_in">console</span>.log(selected);</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 枚举使用示例</span></span><br><span class="line"><span class="built_in">enum</span> Sizes &#123;</span><br><span class="line">  Small = <span class="string">&quot;s&quot;</span>,</span><br><span class="line">  Medium = <span class="string">&quot;m&quot;</span>,</span><br><span class="line">  Large = <span class="string">&quot;l&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> selected: Sizes = Sizes.Small;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateSize</span>(<span class="params">size: Sizes</span>) </span>&#123;</span><br><span class="line">  selected = size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">updateSize(Sizes.Large);</span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th>场景</th>
<th>使用</th>
<th>不使用</th>
</tr>
</thead>
<tbody>
<tr>
<td>消息的阅读状态</td>
<td>YES</td>
<td></td>
</tr>
<tr>
<td>从1750年到现在的年份列表</td>
<td></td>
<td>NO</td>
</tr>
<tr>
<td>菜单中饮料的种类</td>
<td>YES</td>
<td></td>
</tr>
<tr>
<td>文章列表的所有标题</td>
<td></td>
<td>NO</td>
</tr>
<tr>
<td>服务器端的电影分类</td>
<td></td>
<td>NO</td>
</tr>
<tr>
<td>颜色选择器中的颜色</td>
<td>YES</td>
</tr>
</tbody>
</table>
</div>
<h3 id="3-7-函数-Function"><a href="#3-7-函数-Function" class="headerlink" title="3.7 函数 Function"></a>3.7 函数 Function</h3><p>通过类型注释可以显式设置函数将要接收的参数的类型，函数将要返回的值的类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a: <span class="built_in">number</span>, b: <span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> add = (a: <span class="built_in">number</span>, <span class="attr">b</span>: <span class="built_in">number</span>): <span class="function"><span class="params">number</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// TS2345: Argument of type &#x27;string&#x27; is not assignable to parameter of type &#x27;number&#x27;.</span></span><br><span class="line">sum(<span class="number">10</span>, <span class="string">&quot;20&quot;</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> logNumber: <span class="function">(<span class="params">n: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">logNumber = (m: <span class="built_in">number</span>): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(m);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>如果函数没有返回值，可以使用 void 进行标注。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params"></span>): <span class="title">void</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>TypeScript 编译器会检查实参的类型及参数数量是否正确。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">a: <span class="built_in">number</span>, b: <span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TS2554: Expected 2 arguments, but got 3.</span></span><br><span class="line">sum(<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>);</span><br></pre></td></tr></table></figure>
<p>TypeScript 编译器会检测函数是否拥有正确的返回值。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TS2366: Function lacks ending return statement and return type does not include &#x27;undefined&#x27;.</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">a: <span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (a &gt; <span class="number">10</span>) <span class="keyword">return</span> a + <span class="number">20</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>TypeScript 编译器会检测函数内部没有使用的变量。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 未使用的 局部变量 x </span></span><br><span class="line">  <span class="comment">// 移除未使用的 局部变量 &#x27;x&#x27; </span></span><br><span class="line">  <span class="keyword">let</span> x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过 ? 的方式设置可选参数, 它的类型是要么是它原本的类型要么是 undefined。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// c?: number | undefined</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">a: <span class="built_in">number</span>, b: <span class="built_in">number</span>, c?: <span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> c !== <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b + c;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sum(<span class="number">10</span>, <span class="number">20</span>);</span><br></pre></td></tr></table></figure>
<p>通过参数默认值的方式设置可选参数，它的类型就是原本的类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// c?: number</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">a: <span class="built_in">number</span>, b: <span class="built_in">number</span>, c: <span class="built_in">number</span> = <span class="number">0</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b + c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sum(<span class="number">10</span>, <span class="number">20</span>);</span><br></pre></td></tr></table></figure>
<p>在定义函数时，如果形参被定义为解构语法，则使用下面的方式为函数形参设置类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> logWeather = <span class="function">(<span class="params">&#123; date, weather &#125;: &#123; date: <span class="built_in">Date</span>; weather: <span class="built_in">string</span> &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(date, weather);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> today = &#123;</span><br><span class="line">  <span class="attr">date</span>: <span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">  <span class="attr">weather</span>: <span class="string">&quot;sunny&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">logWeather(today);</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> profile = &#123;</span><br><span class="line">  <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">  <span class="attr">coords</span>: &#123;</span><br><span class="line">    <span class="attr">lat</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">lng</span>: <span class="number">15</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; age &#125;: &#123; <span class="attr">age</span>: <span class="built_in">number</span> &#125; = profile;</span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  <span class="attr">coords</span>: &#123; lat, lng &#125;,</span><br><span class="line">&#125;: &#123; <span class="attr">coords</span>: &#123; <span class="attr">lat</span>: <span class="built_in">number</span>; lng: <span class="built_in">number</span> &#125; &#125; = profile;</span><br></pre></td></tr></table></figure>
<h3 id="3-8-对象-Object"><a href="#3-8-对象-Object" class="headerlink" title="3.8 对象 Object"></a>3.8 对象 Object</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对象字面量</span></span><br><span class="line"><span class="keyword">let</span> point: &#123; <span class="attr">x</span>: <span class="built_in">number</span>; y: <span class="built_in">number</span> &#125; = &#123; <span class="attr">x</span>: <span class="number">100</span>, <span class="attr">y</span>: <span class="number">200</span> &#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> employee: &#123; <span class="keyword">readonly</span> id: <span class="built_in">number</span> &#125; = &#123; <span class="attr">id</span>: <span class="number">1</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TS2540: Cannot assign to &#x27;id&#x27; because it is a read-only property.</span></span><br><span class="line"><span class="comment">// employee.id = 2;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// TS2741: Property &#x27;name&#x27; is missing in type &#x27;&#123;&#125;&#x27; but required in type &#x27;&#123; name: string; &#125;&#x27;.</span></span><br><span class="line"><span class="comment">// let person: &#123; name: string &#125; = &#123;&#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> people = &#123;&#125;;</span><br><span class="line"><span class="comment">// TS2339: Property &#x27;name&#x27; does not exist on type &#x27;&#123;&#125;&#x27;.</span></span><br><span class="line"><span class="comment">// people.name = &quot;张三&quot;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// age?: number | undefined</span></span><br><span class="line"><span class="keyword">let</span> student: &#123; age?: <span class="built_in">number</span> &#125; = &#123;&#125;;</span><br><span class="line">student.age = <span class="number">20</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 内置对象 类本身可以作为类实例的类型</span></span><br><span class="line"><span class="keyword">let</span> date: <span class="built_in">Date</span> = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义类</span></span><br><span class="line"><span class="comment">// 类可以作为类实例的类型</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;&#125;</span><br><span class="line"><span class="keyword">let</span> car: Car = <span class="keyword">new</span> Car();</span><br></pre></td></tr></table></figure>
<h3 id="3-9-类型推断"><a href="#3-9-类型推断" class="headerlink" title="3.9 类型推断"></a>3.9 类型推断</h3><p>TypeScript 编译器能根据一些简单的规则推断变量的类型，在没有显式设置变量类型的情况下，编译器将变量初始值的类型作为该变量的类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// let apples: number</span></span><br><span class="line"><span class="keyword">let</span> apples = <span class="number">5</span>;</span><br><span class="line"><span class="comment">// let speed: string</span></span><br><span class="line"><span class="keyword">let</span> speed = <span class="string">&quot;fast&quot;</span>;</span><br><span class="line"><span class="comment">// let hasName: boolean</span></span><br><span class="line"><span class="keyword">let</span> hasName = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// let colors: string[]</span></span><br><span class="line"><span class="keyword">let</span> colors = [<span class="string">&quot;red&quot;</span>, <span class="string">&quot;green&quot;</span>, <span class="string">&quot;blue&quot;</span>];</span><br><span class="line"><span class="comment">// let numbers: number[]</span></span><br><span class="line"><span class="keyword">let</span> numbers = [<span class="number">100</span>, <span class="number">200</span>, <span class="number">300</span>];</span><br><span class="line"><span class="comment">// let bools: boolean[]</span></span><br><span class="line"><span class="keyword">let</span> bools = [<span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">false</span>];</span><br><span class="line"><span class="comment">// let anything: any[</span></span><br><span class="line"><span class="keyword">let</span> anything = [];</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// let point: &#123;x: number, y: number&#125;</span></span><br><span class="line"><span class="keyword">let</span> point = &#123; <span class="attr">x</span>: <span class="number">100</span>, <span class="attr">y</span>: <span class="number">200</span> &#125;;</span><br></pre></td></tr></table></figure>
<p>TypeScript 编译器会试图推断函数返回值的类型。</p>
<p>注意：使用函数返回值类型推断时，在编写函数内部代码时就失去了类型检测功能，所以函数返回值类型推荐明确指定。如果函数的返回值是 undefined，可以指定函数的返回值为 void。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// const add: (a: number, b: number) =&gt; number</span></span><br><span class="line"><span class="keyword">const</span> add = <span class="function">(<span class="params">a: <span class="built_in">number</span>, b: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// const add: (a: number, b: number) =&gt; void</span></span><br><span class="line"><span class="keyword">const</span> add = <span class="function">(<span class="params">a: <span class="built_in">number</span>, b: <span class="built_in">number</span></span>) =&gt;</span> &#123;&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// const add: (a: number, b: string) =&gt; string</span></span><br><span class="line"><span class="keyword">const</span> add = <span class="function">(<span class="params">a: <span class="built_in">number</span>, b: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// const add: () =&gt; string</span></span><br><span class="line"><span class="keyword">const</span> add = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;a&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// const find: (name: string) =&gt; string | boolean</span></span><br><span class="line"><span class="keyword">const</span> find = <span class="function">(<span class="params">name: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (name) &#123;</span><br><span class="line">    <span class="keyword">return</span> name;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>在 TypeScript 编译器可以推断出变量类型的情况下，开发者不需要显式编写类型注释，也就是说只有在 TypeScript 不能正确推断变量类型的情况下开发者才需要编写类型注释，那么在哪些情况下 TypeScript 编译器不能正确推断出变量的类型呢？</p>
<p>① 如果变量声明后没有被立即初始化，TypeScript 编译器不能正确的推断出它的类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 此时 TypeScript 编译器认为它是 Any 类型，即在该变量中可以存储任意类型的数据。</span></span><br><span class="line"><span class="comment">// 该变量失去了 TypeScript 中的类型检查功能</span></span><br><span class="line"><span class="comment">// let anything: any;</span></span><br><span class="line"><span class="keyword">let</span> anything;</span><br><span class="line">anything = <span class="number">12</span>;</span><br><span class="line">anything = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">anything = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> colors = [<span class="string">&quot;red&quot;</span>, <span class="string">&quot;green&quot;</span>, <span class="string">&quot;blue&quot;</span>];</span><br><span class="line"><span class="comment">// let foundColor: any</span></span><br><span class="line"><span class="comment">// 解决办法是要么设置初始值, 要么显式指定变量类型</span></span><br><span class="line"><span class="keyword">let</span> foundColor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; colors.length; i++) &#123;</span><br><span class="line">  <span class="keyword">if</span> (colors[i] === <span class="string">&quot;green&quot;</span>) &#123;</span><br><span class="line">    foundColor = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>② 当调用的函数返回值为 Any 类型时，我们应该使用类型注释显式声明它的类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// let json: string;</span></span><br><span class="line"><span class="keyword">let</span> json = <span class="string">&#x27;&#123;&quot;name&quot;: &quot;张三&quot;&#125;&#x27;</span>;</span><br><span class="line"><span class="comment">// let person: any =&gt; let person: &#123;name: string&#125;</span></span><br><span class="line"><span class="keyword">let</span> person = <span class="built_in">JSON</span>.parse(json);</span><br></pre></td></tr></table></figure>
<p>③ 当变量可能有多个类型的值时。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 需求: 在数组中查找大于 0 的数值, 如果找到将该值赋值给变量 target, 如果没有找到, 将 false 赋值给变量 target</span></span><br><span class="line"><span class="keyword">let</span> numbers = [-<span class="number">10</span>, -<span class="number">1</span>, <span class="number">20</span>];</span><br><span class="line"><span class="keyword">let</span> target = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; numbers.length; i++) &#123;</span><br><span class="line">  <span class="keyword">if</span> (numbers[i] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// 不能将类型&quot;number&quot;分配给类型&quot;boolean&quot;</span></span><br><span class="line">    target = numbers[i];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> target: <span class="built_in">boolean</span> | <span class="built_in">number</span> = <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>
<p>④ 函数的参数必须设置类型，TypeScript 并不能推断函数参数的类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TS7006: Parameter &#x27;a&#x27; implicitly has an &#x27;any&#x27; type</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">a, b</span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-TypeScript-高级类型"><a href="#4-TypeScript-高级类型" class="headerlink" title="4. TypeScript 高级类型"></a>4. TypeScript 高级类型</h2><h3 id="4-1-类型别名"><a href="#4-1-类型别名" class="headerlink" title="4.1 类型别名"></a>4.1 类型别名</h3><p>类型别名用来为类型起个新名字。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Name = <span class="built_in">string</span>;</span><br><span class="line"><span class="keyword">let</span> nameValue: Name = <span class="string">&quot;张三&quot;</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Point = &#123;</span><br><span class="line">  <span class="attr">x</span>: <span class="built_in">number</span>;</span><br><span class="line">  y: <span class="built_in">number</span>;</span><br><span class="line">  add: <span class="function">(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">number</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> point: Point = &#123; <span class="attr">x</span>: <span class="number">100</span>, <span class="attr">y</span>: <span class="number">200</span>, <span class="attr">add</span>: <span class="function">(<span class="params">x: <span class="built_in">number</span>, y: <span class="built_in">number</span></span>) =&gt;</span> x + y &#125;;</span><br></pre></td></tr></table></figure>
<p>观察下列代码中存在的问题。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> pizzaSize: <span class="string">&#x27;large&#x27;</span> | <span class="string">&#x27;medium&#x27;</span> | <span class="string">&#x27;small&#x27;</span> = <span class="string">&#x27;medium&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">selectPizzaSize</span> (<span class="params">size: <span class="string">&#x27;large&#x27;</span> | <span class="string">&#x27;medium&#x27;</span>| <span class="string">&#x27;small&#x27;</span></span>) </span>&#123;</span><br><span class="line">  pizzaSize = size</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">selectPizzaSize(<span class="string">&#x27;small&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>以上代码同一个类型被定义了多次, 重复代码太多，可以使用 type 创建类型，复用类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Size = <span class="string">&#x27;large&#x27;</span> | <span class="string">&#x27;medium&#x27;</span> | <span class="string">&#x27;small&#x27;</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> pizzaSize: Size = <span class="string">&#x27;medium&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">selectPizzaSize</span> (<span class="params">size: Size</span>) </span>&#123;</span><br><span class="line">  pizzaSize = size</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">selectPizzaSize(<span class="string">&#x27;large&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="4-2-联合类型"><a href="#4-2-联合类型" class="headerlink" title="4.2 联合类型"></a>4.2 联合类型</h3><p>联合类型可以将变量设置为多种类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 联合类型: 为一个变量设置多个类型</span></span><br><span class="line"><span class="keyword">let</span> a: <span class="built_in">string</span> | <span class="built_in">number</span> | <span class="built_in">boolean</span> = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// arg 参数既可以是字符串类型也可以是数值类型</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">arg: <span class="built_in">string</span> | <span class="built_in">number</span></span>) </span>&#123;&#125;</span><br><span class="line">fn(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">fn(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>
<p>在使用联合类型的变量时，默认只能使用联合类型中所有类型中的公共属性，因为 TypeScript 编译器并不能确定它的具体类型是什么，所以不能准确的列出它的下面有哪些属性和方法。</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/ts/images/50.png"  align="left"/></p>
<p>在大多数情况下，在使用联合类型的变量时，需要先缩小变量的类型范围，尽量让TypeScript 编译器列出更加准备的属性和方法。</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/ts/images/51.png"  align="left"/></p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/ts/images/52.png"  align="left"/></p>
<h3 id="4-3-交叉类型"><a href="#4-3-交叉类型" class="headerlink" title="4.3 交叉类型"></a>4.3 交叉类型</h3><p>交叉类型是将多个类型叠加合并组成新的类型，新类型包含了所有被合并类型的所有属性。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Draggable = &#123;</span><br><span class="line">  <span class="attr">drag</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Resizable = &#123;</span><br><span class="line">  <span class="attr">resize</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> UIWidget = Draggable &amp; Resizable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> textBox: UIWidget = &#123;</span><br><span class="line">  <span class="attr">drag</span>: <span class="function">() =&gt;</span> &#123;&#125;,</span><br><span class="line">  <span class="attr">resize</span>: <span class="function">() =&gt;</span> &#123;&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="4-4-字面量类型"><a href="#4-4-字面量类型" class="headerlink" title="4.4 字面量类型"></a>4.4 字面量类型</h3><p>字面量类型既可以设置变量的类型，又可以限制变量的取值范围。</p>
<p>字面量值的类型就是变量的类型，字面量值就是变量的取值范围。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Quantity = <span class="number">50</span> | <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TS2322: Type &#x27;54&#x27; is not assignable to type &#x27;Quantity&#x27;.</span></span><br><span class="line"><span class="keyword">let</span> quantity: Quantity = <span class="number">54</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Metric = <span class="string">&quot;cm&quot;</span> | <span class="string">&quot;inch&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TS2322: Type &#x27;&quot;abc&quot;&#x27; is not assignable to type &#x27;Metric&#x27;.</span></span><br><span class="line"><span class="keyword">let</span> metric: Metric = <span class="string">&quot;abc&quot;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="4-5-可空类型"><a href="#4-5-可空类型" class="headerlink" title="4.5 可空类型"></a>4.5 可空类型</h3><p>在 TypeScript 中，undefined 和 null 这两个值本身也可以作为类型使用。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// undefined</span></span><br><span class="line"><span class="keyword">let</span> nothing: <span class="literal">undefined</span> = <span class="literal">undefined</span>;</span><br><span class="line"><span class="comment">// null</span></span><br><span class="line"><span class="keyword">let</span> nothingMuch: <span class="literal">null</span> = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">greet</span>(<span class="params">name: <span class="built_in">string</span> | <span class="literal">null</span> | <span class="literal">undefined</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> name === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name.toLowerCase());</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;something went wrong&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">greet(<span class="literal">undefined</span>);</span><br></pre></td></tr></table></figure>
<h3 id="4-6-可选链操作符"><a href="#4-6-可选链操作符" class="headerlink" title="4.6 可选链操作符"></a>4.6 可选链操作符</h3><p>可选链操作符( <code>?.</code> )允许开发者通过链式的方式访问一个对象上可能为 <code>null</code> 或 <code>undefined</code> 的属性，并且不用检查中间的属性是否为空。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Customer = &#123;</span><br><span class="line">  birthday?: <span class="built_in">Date</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCustomer</span>(<span class="params">id: <span class="built_in">number</span></span>): <span class="title">Customer</span> | <span class="title">undefined</span> | <span class="title">null</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> id === <span class="number">0</span> ? <span class="literal">null</span> : &#123; <span class="attr">birthday</span>: <span class="keyword">new</span> <span class="built_in">Date</span>() &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> customer = getCustomer(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// if (customer !== null &amp;&amp; customer !== undefined) &#123;</span></span><br><span class="line"><span class="comment">//   if (customer.birthday !== undefined) &#123;</span></span><br><span class="line"><span class="comment">//     console.log(customer.birthday);</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(customer?.birthday?.getFullYear());</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> array: <span class="built_in">string</span> | <span class="built_in">number</span>[] | <span class="literal">null</span> = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"><span class="built_in">console</span>.log(array?.[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> log: <span class="built_in">any</span> = <span class="function">(<span class="params">message: <span class="built_in">string</span></span>) =&gt;</span> <span class="built_in">console</span>.log(message);</span><br><span class="line">log = <span class="literal">null</span>;</span><br><span class="line">log?.(<span class="string">&quot;Hello&quot;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="4-7-空值合并运算符"><a href="#4-7-空值合并运算符" class="headerlink" title="4.7 空值合并运算符"></a>4.7 空值合并运算符</h3><p>空值合并操作符 (<code>??</code>) 是一个逻辑操作符，当左侧的操作数为 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/null"><code>null</code></a> 或者 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/undefined"><code>undefined</code></a> 时，返回其右侧操作数，否则返回左侧操作数。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> speed: <span class="built_in">number</span> | <span class="literal">null</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ride = &#123;</span><br><span class="line">  <span class="comment">// speed: speed !== null ? speed : 30,</span></span><br><span class="line">  <span class="attr">speed</span>: speed ?? <span class="number">30</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="4-8-类型断言"><a href="#4-8-类型断言" class="headerlink" title="4.8 类型断言"></a>4.8 类型断言</h3><p>通过类型断言可以覆盖 TypeScript 编译器的推断，当开发者比 TypeScript 更加清楚它的类型时使用。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// const phone: HTMLElement | null</span></span><br><span class="line"><span class="keyword">const</span> phone = <span class="built_in">document</span>.getElementById(<span class="string">&quot;phone&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log((&lt;HTMLInputElement&gt;phone).value);</span><br><span class="line"><span class="built_in">console</span>.log((phone <span class="keyword">as</span> HTMLInputElement).value);</span><br></pre></td></tr></table></figure>
<h3 id="4-9-unknown-类型"><a href="#4-9-unknown-类型" class="headerlink" title="4.9 unknown 类型"></a>4.9 unknown 类型</h3><p>unknow 是更加严格的 any 类型，在对 unknown 类型的变量执行操作之前必须进行先假设它的类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> anything: unknown = <span class="string">&quot;Hello TypeScript&quot;</span>;</span><br><span class="line">anything = <span class="literal">true</span>;            <span class="comment">// ✅</span></span><br><span class="line">anything = <span class="number">3.14</span>;            <span class="comment">// ✅</span></span><br><span class="line">anything = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;  <span class="comment">// ✅</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// TS2571: Object is of type &#x27;unknown&#x27;. ❎</span></span><br><span class="line"><span class="comment">// console.log(anything.length);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> anything === <span class="string">&quot;number&quot;</span>) &#123;</span><br><span class="line">  anything.toFixed();</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> anything === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">  anything.toUpperCase();</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> anything === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">  anything();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-10-never-类型"><a href="#4-10-never-类型" class="headerlink" title="4.10 never 类型"></a>4.10 never 类型</h3><p>如果一个函数永远都不会有返回值，可以指定函数的返回值类型为 never。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> throwError = (message: <span class="built_in">string</span>): <span class="function"><span class="params">never</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// const throwError: (message: string) =&gt; void</span></span><br><span class="line"><span class="keyword">const</span> throwError = <span class="function">(<span class="params">message: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!message) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>注意：如果一个函数永远都不会有返回值，说明函数调用位置后面的代码永远都不会被执行。</p>
<h2 id="5-面向对象编程"><a href="#5-面向对象编程" class="headerlink" title="5. 面向对象编程"></a>5. 面向对象编程</h2><h3 id="5-1-概述"><a href="#5-1-概述" class="headerlink" title="5.1 概述"></a>5.1 概述</h3><p>面向对象和面向过程都属于编写程序的指导思想，指导开发者按照什么样的套路编写代码。</p>
<p>面向过程是侧重于过程的编程，代码的执行过程就是代码的编写过程。在编写程序时要明确知道每一步都要做什么，比如将大象装冰箱一共分为三步，那么程序代码就是这三步。</p>
<p>面向对象是侧重于对象的编程，开发者站在上帝视角，要想什么就创建什么对象，然后为对象赋予响应的能力，要做的事情让对象自己完成。比如将大象装冰箱，我们要创建大象对象，创建冰箱对象，赐予大象进冰箱的能力，然后让大象自己进冰箱。</p>
<p>面向过程的优点是简单，思考简单，编写简单。</p>
<p>面向过程的缺点是代码量越大维护成本越高。当程序出问题后，需要从头到尾将步骤过一遍，在此过程中找问题，修复问题，如果代码中步骤非常多的话，是非常耗时间和精力的。</p>
<p>面向对象的优点的是扩展性强维护成本低，当程序出问题后定位对象即可，哪个对象出问题就找哪个对象修复哪个对象就可以了。</p>
<p>面向对象的缺点是新人上手难度高。</p>
<h3 id="5-2-类与对象"><a href="#5-2-类与对象" class="headerlink" title="5.2 类与对象"></a>5.2 类与对象</h3><p>面向对象的思维方式就是你是上帝，你想要什么你就造什么对象，问题是如何造对象？比如造一辆车。</p>
<p>现实世界中，第一步画造车图纸 ① 定义车的信息，车是什么颜色，有多少座位 @ 定义车的能力，跑。第二步根据图纸造车。</p>
<p>面向对象中，通过类表示图纸，定义类就是画图纸，类中包含两部分，属性和方法，由于通过图纸可以造多个相同的实物，所以属性就是这一类事物拥有的共同特性，方法就是这一类事物拥有的共同的能力。</p>
<p>面向对象中，通过对象表示具体的实物，对象是通过类创建的，对象能干什么完全取决于你的类是如何定义的。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vehicle</span> </span>&#123;</span><br><span class="line">  <span class="attr">color</span>: <span class="built_in">string</span> = <span class="string">&quot;白色&quot;</span>;</span><br><span class="line">  maxSpeed: <span class="built_in">number</span> = <span class="number">220</span>;</span><br><span class="line">  <span class="function"><span class="title">drive</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;run&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">honk</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;didi&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vehicle = <span class="keyword">new</span> Vehicle();</span><br><span class="line"><span class="built_in">console</span>.log(vehicle);</span><br><span class="line"><span class="built_in">console</span>.log(vehicle.color);</span><br><span class="line"><span class="built_in">console</span>.log(vehicle.maxSpeed);</span><br><span class="line">vehicle.drive();</span><br><span class="line">vehicle.honk();</span><br></pre></td></tr></table></figure>
<h3 id="5-3-构造函数"><a href="#5-3-构造函数" class="headerlink" title="5.3 构造函数"></a>5.3 构造函数</h3><p>构造函数用来在创建对象时为对象属性赋初始值，在使用 new 关键字实例化对象时被自动调用。</p>
<p>在 TypeScript 中构造函数使用 constructor 实现，在该方法中可以通过 this 关键字访问当前类中的属性和方法。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vehicle</span> </span>&#123;</span><br><span class="line">  <span class="attr">color</span>: <span class="built_in">string</span>;</span><br><span class="line">  maxSpeed: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">color: <span class="built_in">string</span>, maxSpeed: <span class="built_in">number</span></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.color = color;</span><br><span class="line">    <span class="built_in">this</span>.maxSpeed = maxSpeed;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vehicle = <span class="keyword">new</span> Vehicle(<span class="string">&quot;红色&quot;</span>, <span class="number">240</span>);</span><br></pre></td></tr></table></figure>
<h3 id="5-4-只读属性"><a href="#5-4-只读属性" class="headerlink" title="5.4 只读属性"></a>5.4 只读属性</h3><p>只读属性是指属性一旦被赋值，该值就不能被修改，无论在类的外部还是在类的内部都不能被修改。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vehicle</span> </span>&#123;</span><br><span class="line">  <span class="keyword">readonly</span> maxSpeed: <span class="built_in">number</span>;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">maxSpeed: <span class="built_in">number</span></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.maxSpeed = maxSpeed;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">drive</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">//  TS2540: Cannot assign to &#x27;maxSpeed&#x27; because it is a read-only property.</span></span><br><span class="line">    <span class="built_in">this</span>.maxSpeed = <span class="number">900</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vehicle = <span class="keyword">new</span> Vehicle(<span class="number">240</span>);</span><br><span class="line"><span class="comment">// TS2540: Cannot assign to &#x27;maxSpeed&#x27; because it is a read-only property.</span></span><br><span class="line">vehicle.maxSpeed = <span class="number">300</span>;</span><br></pre></td></tr></table></figure>
<h3 id="5-5-继承"><a href="#5-5-继承" class="headerlink" title="5.5 继承"></a>5.5 继承</h3><p>在为事物进行分类时，通常会对类别进行细化，比如汽车分类，在该分类下还会包含轿车和面包车，这种细化关系在程序世界中应该如何表示呢？</p>
<p>在程序世界中我们会分别创建汽车分类，轿车分类、面包车分类，在汽车分类下描述所有汽车的通用特征，在细化分类下只描述该分类独有的特征。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 汽车分类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vehicle</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">drive</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;run&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">  brand = <span class="string">&quot;BMW&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>虽然我们目前对类别进行了细化，但随之也出现了问题，在使用类创建对象时，比如创建轿车对象，在创建出来的轿车对象中只包含了轿车的独有特征，没有包含汽车的通用特性，就是说创建出来的轿车对象是不完整的对象，完整的对象应该是既包含汽车的通用特征又包含轿车的独有特性。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> car = <span class="keyword">new</span> Car();</span><br><span class="line"><span class="built_in">console</span>.log(car); <span class="comment">// &#123; brand: &quot;BMW&quot;&#125;</span></span><br></pre></td></tr></table></figure>
<p>可以使用继承关系解决上述问题。既然汽车分类包含了细化分类的通用特征，那么汽车分类就被叫做父类，下面的细化分类就被叫做子类，子类通过继承父类就可以拥有汽车分类中的通用特征了，再加上子类中定义了其独有的特征，最终通过子类创建出来的对象就是拥有完整特性的对象了。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> <span class="keyword">extends</span> <span class="title">Vehicle</span> </span>&#123;</span><br><span class="line">  brand = <span class="string">&quot;BMW&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> car = <span class="keyword">new</span> Car(); </span><br><span class="line"><span class="comment">// &#123;brand: &quot;BMW&quot;&#125; </span></span><br><span class="line"><span class="comment">// car.drive() </span></span><br><span class="line"><span class="comment">// 注意: drive 方法被添加到了原型对象中, 所以 log 实例对象时并没有看到它</span></span><br></pre></td></tr></table></figure>
<p>在子类继承父类后，如果父类需要在初始化的时候传递参数，该参数由子类接收，在子类的构造函数中通过 super 调用父类将参数传递给父类。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> studentId: <span class="built_in">number</span>, name: <span class="built_in">string</span></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> Student(<span class="number">1</span>, <span class="string">&quot;张三&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(p1.studentId);</span><br><span class="line"><span class="built_in">console</span>.log(p1.name);</span><br></pre></td></tr></table></figure>
<p>子类在继承父类后，还可以通过重写父类方法对功能进行扩展。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">walk</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;person walk&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="comment">// override 表示该方法是覆盖的父类方法, 仅作为标识提升代码的可阅读性, 不会对代码的实际执行产生任何副作用</span></span><br><span class="line">  override <span class="function"><span class="title">walk</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;student walk&quot;</span>);</span><br><span class="line">    <span class="comment">// 通过 super 调用父类 walk 方法</span></span><br><span class="line">    <span class="built_in">super</span>.walk();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> Student();</span><br><span class="line">p1.walk();</span><br></pre></td></tr></table></figure>
<h3 id="5-6-访问权限修饰符"><a href="#5-6-访问权限修饰符" class="headerlink" title="5.6 访问权限修饰符"></a>5.6 访问权限修饰符</h3><p>通过访问权限修饰符可以指定类中的属性、方法能够在哪些范围内被使用。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>修饰符</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>public</td>
<td>被 public 关键字修饰的类属性和类方法可以在任何地方使用 (当前类、子类、实例)</td>
</tr>
<tr>
<td>private</td>
<td>被 private 关键字修饰的类属性和类方法只能在当前类中使用</td>
</tr>
<tr>
<td>protected</td>
<td>被 protected 关键字修饰的类属性和类方法可以在当前类和子类中使用</td>
</tr>
</tbody>
</table>
</div>
<p><strong>① public 公开的</strong></p>
<p>类属性和类方法在不加任何权限修饰符的情况下，它就是可以在任何地方被访问的，也就是说 public 是默认值，是可以被省略的。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vehicle</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 在本类中的其他方法中使用</span></span><br><span class="line">    <span class="built_in">this</span>.drive();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">drive</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;run&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> <span class="keyword">extends</span> <span class="title">Vehicle</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">drive</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 2. 在子类中使用</span></span><br><span class="line">    <span class="built_in">super</span>.drive();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> car = <span class="keyword">new</span> Car();</span><br><span class="line"><span class="comment">// 3. 在实例对象中使用</span></span><br><span class="line">car.drive();</span><br></pre></td></tr></table></figure>
<p><strong>② private 私有的</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vehicle</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 在本类中的其他方法中使用</span></span><br><span class="line">    <span class="built_in">this</span>.drive();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="title">drive</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;run&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> <span class="keyword">extends</span> <span class="title">Vehicle</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">drive</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 属性&quot;drive&quot;为私有属性，只能在类&quot;Vehicle&quot;中访问</span></span><br><span class="line">    <span class="built_in">super</span>.drive();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vehicle = <span class="keyword">new</span> Vehicle();</span><br><span class="line"><span class="comment">// 属性&quot;drive&quot;为私有属性，只能在类&quot;Vehicle&quot;中访问</span></span><br><span class="line">vehicle.drive();</span><br></pre></td></tr></table></figure>
<p><strong>③ protected 受保护的</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vehicle</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 在本类中的其他方法中使用</span></span><br><span class="line">    <span class="built_in">this</span>.drive();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">protected</span> <span class="function"><span class="title">drive</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;run&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> <span class="keyword">extends</span> <span class="title">Vehicle</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">drive</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 2. 在子类中使用</span></span><br><span class="line">    <span class="built_in">super</span>.drive();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vehicle = <span class="keyword">new</span> Vehicle();</span><br><span class="line"><span class="comment">// 属性&quot;drive&quot;受保护, 只能在类&quot;Vehicle&quot;及其子类中访问</span></span><br><span class="line">vehicle.drive();</span><br></pre></td></tr></table></figure>
<h3 id="5-7-Getter-与-Setter"><a href="#5-7-Getter-与-Setter" class="headerlink" title="5.7 Getter 与 Setter"></a>5.7 Getter 与 Setter</h3><p>Getter 和 Setter 是对属性访问的封装，比如通过类实例对象访问私有属性就需要用到它们，获取属性值时使用Getter，修改属性值时使用 Setter。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> _salary: <span class="built_in">number</span>;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">salary: <span class="built_in">number</span></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>._salary = salary;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> <span class="title">salary</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._salary;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">set</span> <span class="title">salary</span>(<span class="params">salary: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>._salary = salary;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> employee = <span class="keyword">new</span> Employee(<span class="number">4000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(employee.salary);</span><br><span class="line">employee.salary = <span class="number">6000</span>;</span><br><span class="line"><span class="built_in">console</span>.log(employee.salary);</span><br></pre></td></tr></table></figure>
<h3 id="5-8-参数属性"><a href="#5-8-参数属性" class="headerlink" title="5.8 参数属性"></a>5.8 参数属性</h3><p>TypeScript 提供了特殊的语法将构造函数参数转换为具有相同名称的类属性。 这些称为参数属性，是通过在构造函数参数前面加上权限修饰符 public、private、protected 或 readonly 之一来创建的。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Params</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">public</span> <span class="keyword">readonly</span> x: <span class="built_in">number</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">protected</span> y: <span class="built_in">number</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">private</span> z: <span class="built_in">number</span></span></span></span><br><span class="line"><span class="params"><span class="function">  </span>)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">log</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.x);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.y);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.z);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> Params(<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>);</span><br><span class="line">p.log();</span><br></pre></td></tr></table></figure>
<h3 id="5-9-索引签名"><a href="#5-9-索引签名" class="headerlink" title="5.9 索引签名"></a>5.9 索引签名</h3><p>在 JavaScript 中，为对象动态添加属性是被允许的，但是在 TypeScript 中是不行的，因为在 TypeScript 中对象要有严格的数据类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123;&#125;;</span><br><span class="line"><span class="comment">// TS2339: Property &#x27;name&#x27; does not exist on type &#x27;&#123;&#125;&#x27;.</span></span><br><span class="line">person.name = <span class="string">&quot;张三&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>在 TypeScript 中动态为对象添加属性，需要使用索引签名，通过索引签名可以在不确定属性名称的情况下限制对象属性的类型以及对象值的类型。</p>
<p>在不确定属性名称的情况下限制属性的类型意味着我们可以动态的为对象添加任意属性，但属性类型要符合要求。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SeatAssignment</span> </span>&#123;</span><br><span class="line">  <span class="attr">A1</span>: <span class="built_in">string</span>;</span><br><span class="line">  A2: <span class="built_in">string</span>;</span><br><span class="line">  <span class="comment">// ....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SeatAssignment</span> </span>&#123;</span><br><span class="line">  <span class="comment">// seatNumber 只是用来占位的, 实际属性的名称开发者可以自定义，而且 seatNumber 也可以换成其他名称</span></span><br><span class="line">  [seatNumber: <span class="built_in">string</span>]: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> seats = <span class="keyword">new</span> SeatAssignment();</span><br><span class="line"></span><br><span class="line">seats.A1 = <span class="string">&quot;张三&quot;</span>;</span><br><span class="line">seats.A2 = <span class="string">&quot;李四&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ❎ TS2538: Type &#x27;true&#x27; cannot be used as an index type.</span></span><br><span class="line">seats[<span class="literal">true</span>] = <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ❎ TS2322: Type &#x27;number&#x27; is not assignable to type &#x27;string&#x27;.</span></span><br><span class="line">seats.A3 = <span class="number">12</span>;</span><br></pre></td></tr></table></figure>
<h3 id="5-10-静态成员"><a href="#5-10-静态成员" class="headerlink" title="5.10 静态成员"></a>5.10 静态成员</h3><p>在类中被 static 关键字修饰的类属性和类方法被叫做静态成员，静态成员属于类，所以访问静态成员的方式是类名点上静态成员名称。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rich</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> count: <span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 通过 类名 + 静态成员名称 访问静态成员</span></span><br><span class="line">Rich.count;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以下写法错误</span></span><br><span class="line"><span class="comment">// 静态成员不属于类的实例对象, 所以不能通过类的实例对象访问静态成员</span></span><br><span class="line"><span class="keyword">const</span> r = <span class="keyword">new</span> Rich();</span><br><span class="line"><span class="comment">// TS2576: Property &#x27;count&#x27; does not exist on type &#x27;Rich&#x27;. </span></span><br><span class="line"><span class="comment">// Did you mean to access the static member &#x27;Rich.count&#x27; instead?</span></span><br><span class="line">r.count;</span><br></pre></td></tr></table></figure>
<p>对于该类的任何一个对象而言，静态属性就是公共的存储单元，该类的任何对象访问它时，取到的都是相同的值，同样任何一个类的对象去修改它时，也都是在对同一个内存单元做操作，所以静态成员主要用在各个对象都有相同的某项属性的时候。</p>
<p>目标: 获取类的实例对象的数量。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Rich</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> _count: <span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    Rich._count++;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">getCount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Rich._count;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> r1 = <span class="keyword">new</span> Rich();</span><br><span class="line"><span class="keyword">const</span> r2 = <span class="keyword">new</span> Rich();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(r1.getCount());</span><br><span class="line"><span class="built_in">console</span>.log(r2.getCount());</span><br></pre></td></tr></table></figure>
<p>因为静态成员存在于内存，而非静态成员需要实例化才可以分配内存，所以静态成员不能访问非静态成员，非静态成员可以访问类中的静态成员。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rich</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> _count: <span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// 静态成员中不能访问非静态成员</span></span><br><span class="line">  <span class="comment">// 静态方法中的 this 指向了类, 而不是类实例</span></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">fn</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// TS2339: Property &#x27;getCount&#x27; does not exist on type &#x27;typeof Rich&#x27;.</span></span><br><span class="line">    <span class="comment">// this.getCount();</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 非静态成员中可以访问静态成员</span></span><br><span class="line">  <span class="function"><span class="title">getCount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Rich._count;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-11-抽象类"><a href="#5-11-抽象类" class="headerlink" title="5.11 抽象类"></a>5.11 抽象类</h3><p>抽象类因继承而存在，通过抽象类可以约束子类必须实现哪些成员，如果抽象类不被继承，它将毫无意义。</p>
<p>在抽象类中可以只定义成员，具体的成员实现由子类完成且必须完成，所以抽象类不能被直接实例化。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">  <span class="keyword">abstract</span> color: <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">abstract</span> render(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> color: <span class="built_in">string</span></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  override render(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;render&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TS2511: Cannot create an instance of an abstract class.</span></span><br><span class="line"><span class="comment">// new Shape();</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> circle = <span class="keyword">new</span> Circle(<span class="string">&quot;red&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(circle.color);</span><br><span class="line">circle.render();</span><br></pre></td></tr></table></figure>
<h3 id="5-12-接口"><a href="#5-12-接口" class="headerlink" title="5.12 接口"></a>5.12 接口</h3><p>接口用于对复杂的数据结构进行类型描述、定义类型规范，TypeScript 编译器通过接口定义的规范对数据进行类型检查。</p>
<p>先来观察一段 JavaScript 代码，看看代码中存在什么问题。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserInfo</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;user.name&#125;</span> - <span class="subst">$&#123;user.age&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 运行时错误: Uncaught TypeError: Cannot read properties of undefined (reading &#x27;name&#x27;)</span></span><br><span class="line">getUserInfo();</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// undefined - undefined</span></span><br><span class="line">getUserInfo(<span class="string">&quot;张三&quot;</span>, <span class="number">20</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 张三 - undefined</span></span><br><span class="line">getUserInfo(&#123; <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>, <span class="attr">height</span>: <span class="number">178</span> &#125;);</span><br></pre></td></tr></table></figure>
<p>JavaScript 是弱类型的语言，所以并不会对我们传入的代码进行任何的检测。在 TypeScript 中，接口可以解决上述问题。</p>
<p>在 TypeScript 中，使用 interface 关键字定义接口，通过接口可以约束对象的类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> IUser &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  age: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserInfo</span>(<span class="params">user: IUser</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;user.name&#125;</span> - <span class="subst">$&#123;user.age&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TS2554: Expected 1 arguments, but got 0.</span></span><br><span class="line">getUserInfo();</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TS2345: Argument of type &#x27;string&#x27; is not assignable to parameter of type &#x27;IUser&#x27;.</span></span><br><span class="line">getUserInfo(<span class="string">&quot;张三&quot;</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TS2554: Expected 1 arguments, but got 2.</span></span><br><span class="line">getUserInfo(<span class="string">&quot;张三&quot;</span>, <span class="number">20</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TS2345: Argument of type &#x27;&#123; name: string; height: number; &#125;&#x27; is not assignable to parameter of type &#x27;IUser&#x27;.</span></span><br><span class="line"><span class="comment">// Object literal may only specify known properties, and &#x27;height&#x27; does not exist in type &#x27;IUser&#x27;.</span></span><br><span class="line">getUserInfo(&#123; <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>, <span class="attr">height</span>: <span class="number">20</span> &#125;);</span><br></pre></td></tr></table></figure>
<p>接口中定义的规范默认情况下都是必须被实现的，也就是说你定义的变量的值必须符合接口规范，少一个都不行。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Person &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  age: <span class="built_in">number</span>;</span><br><span class="line">  isMarray: <span class="built_in">boolean</span>;</span><br><span class="line">  summary(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printPerson</span>(<span class="params">person: Person</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(person);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">  <span class="attr">isMarray</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型&quot;&#123; name: string; age: number; isMarray: boolean; &#125;&quot;的参数不能赋给类型&quot;Person&quot;的参数</span></span><br><span class="line"><span class="comment">// 类型&quot;&#123; name: string; age: number; isMarray: boolean; &#125;&quot;中缺少属性 &quot;summary&quot;, 但类型&quot;Person&quot;中需要该属性</span></span><br><span class="line">printPerson(person);</span><br></pre></td></tr></table></figure>
<p>在实现了接口规范的情况下，规范以外的值默认是允许存在的。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Reportable &#123;</span><br><span class="line">  summary(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printSummary</span>(<span class="params">item: Reportable</span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item.summary());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">  <span class="function"><span class="title">summary</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`您好, 我的名字叫<span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span>`</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> drink = &#123;</span><br><span class="line">  <span class="attr">color</span>: <span class="string">&quot;棕色&quot;</span>,</span><br><span class="line">  <span class="function"><span class="title">summary</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;我喝的咖啡是$&#123;brow&#125;的&quot;</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">printSummary(person);</span><br><span class="line">printSummary(drink);</span><br></pre></td></tr></table></figure>
<p>接口具有继承特性，即接口与接口之间可以存在继承关系，而且一个接口可以继承多个接口。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接口继承示例</span></span><br><span class="line"><span class="keyword">interface</span> Sizes &#123;</span><br><span class="line">  <span class="attr">sizes</span>: <span class="built_in">string</span>[];</span><br><span class="line">  getAvailableSizes(): <span class="built_in">string</span>[];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Shape &#123;</span><br><span class="line">  <span class="attr">color</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Pizza <span class="keyword">extends</span> Sizes, Shape &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> pizza: Pizza = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">  <span class="attr">color</span>: <span class="string">&quot;skyblue&quot;</span>,</span><br><span class="line">  <span class="attr">sizes</span>: [<span class="string">&quot;large&quot;</span>, <span class="string">&quot;small&quot;</span>],</span><br><span class="line">  <span class="function"><span class="title">getAvailableSizes</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.sizes;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>接口具有声明合并特性，即多个相同名称的接口可以合并。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Box &#123;</span><br><span class="line">  <span class="attr">height</span>: <span class="built_in">number</span>;</span><br><span class="line">  width: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Box &#123;</span><br><span class="line">  <span class="attr">scale</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> box: Box = &#123; <span class="attr">height</span>: <span class="number">5</span>, <span class="attr">width</span>: <span class="number">6</span>, <span class="attr">scale</span>: <span class="number">10</span> &#125;;</span><br></pre></td></tr></table></figure>
<p>接口可以被类实现，约束类中必须要实现的成员。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Calendar &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  addEvent(): <span class="built_in">void</span>;</span><br><span class="line">  removeEvent(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GoogleCalendar</span> <span class="title">implements</span> <span class="title">Calendar</span> </span>&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span> = <span class="string">&quot;test&quot;</span>;</span><br><span class="line">  addEvent(): <span class="built_in">void</span> &#123;&#125;</span><br><span class="line">  removeEvent(): <span class="built_in">void</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用接口可以规范函数的类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Sum &#123;</span><br><span class="line">  (n: <span class="built_in">number</span>, <span class="attr">m</span>: <span class="built_in">number</span>): <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sum: Sum = <span class="function"><span class="keyword">function</span> (<span class="params">a: <span class="built_in">number</span>, b: <span class="built_in">number</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="5-13-接口与类型别名"><a href="#5-13-接口与类型别名" class="headerlink" title="5.13 接口与类型别名"></a>5.13 接口与类型别名</h3><p>在 TypeScript 中，类型别名可以定义合成类型，比如对象和联合类型，类型别名可以定义基本数据类型，而接口只能定义对象类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用类型别名定义联合类型</span></span><br><span class="line"><span class="comment">// ISBN: 国际标准书号</span></span><br><span class="line"><span class="keyword">type</span> ISBN = <span class="built_in">number</span> | <span class="built_in">string</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 使用联合类型定义对象类型</span></span><br><span class="line"><span class="keyword">type</span> PublicationT = &#123;</span><br><span class="line">  <span class="attr">isbn</span>: ISBN;</span><br><span class="line">  author: <span class="built_in">string</span>;</span><br><span class="line">  publisher: <span class="built_in">string</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 接口只能定义对象类型</span></span><br><span class="line"><span class="keyword">interface</span> PublicationI &#123;</span><br><span class="line">  <span class="attr">isbn</span>: ISBN;</span><br><span class="line">  author: <span class="built_in">string</span>;</span><br><span class="line">  publisher: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-11-函数重载"><a href="#4-11-函数重载" class="headerlink" title="4.11 函数重载"></a>4.11 函数重载</h3><p>需求：调用 getMessage 方法获取消息，如果传递的参数是数值类型，则表示根据消息 id 获取消息，返回值为对象类型，表示一条消息，如果传递的参数是字符串类型，则表示根据消息种类获取消息，返回值为数组类型，表示一组消息。</p>
<p>函数重载：根据函数入参类型的不同或入参个数的不同，设置不同的返回值类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 消息种类的类型</span></span><br><span class="line"><span class="keyword">type</span> MessageType = <span class="string">&quot;string&quot;</span> | <span class="string">&quot;image&quot;</span> | <span class="string">&quot;audio&quot;</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 消息对象的类型</span></span><br><span class="line"><span class="keyword">type</span> Message = &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="keyword">type</span>: MessageType;</span><br><span class="line">  content: <span class="built_in">string</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 消息数组</span></span><br><span class="line"><span class="keyword">const</span> data: Message[] = [</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">type</span>: <span class="string">&quot;string&quot;</span>, <span class="attr">content</span>: <span class="string">&quot;hello-1&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">type</span>: <span class="string">&quot;image&quot;</span>, <span class="attr">content</span>: <span class="string">&quot;hello-2&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">type</span>: <span class="string">&quot;audio&quot;</span>, <span class="attr">content</span>: <span class="string">&quot;hello-3&quot;</span> &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMessage</span>(<span class="params">id: <span class="built_in">number</span></span>): <span class="title">Message</span> | <span class="title">undefined</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMessage</span>(<span class="params"><span class="keyword">type</span>: MessageType</span>): <span class="title">Message</span>[]</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMessage</span>(<span class="params">query: <span class="built_in">any</span></span>): <span class="title">any</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> query === <span class="string">&quot;number&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> data.find(<span class="function"><span class="params">message</span> =&gt;</span> message.id === query);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> data.filter(<span class="function"><span class="params">message</span> =&gt;</span> message.type === query);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// const r1: Message | undefined</span></span><br><span class="line"><span class="keyword">const</span> r1 = getMessage(<span class="number">1</span>);</span><br><span class="line"><span class="comment">// const r2: Message[]</span></span><br><span class="line"><span class="keyword">const</span> r2 = getMessage(<span class="string">&quot;image&quot;</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> GetMessage &#123;</span><br><span class="line">  (id: <span class="built_in">number</span>): Message | <span class="literal">undefined</span>;</span><br><span class="line">  (<span class="keyword">type</span>: MessageType): Message[];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getMessage: GetMessage = (query: <span class="built_in">any</span>): <span class="function"><span class="params">any</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> query === <span class="string">&quot;number&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> data.find(<span class="function">(<span class="params">message</span>) =&gt;</span> message.id === query);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> data.filter(<span class="function">(<span class="params">message</span>) =&gt;</span> message.type === query);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="6-其他类型"><a href="#6-其他类型" class="headerlink" title="6. 其他类型"></a>6. 其他类型</h2><h3 id="6-1-泛型"><a href="#6-1-泛型" class="headerlink" title="6.1 泛型"></a>6.1 泛型</h3><p>泛型是指将类型作为参数进行传递，通过参数的传递解决代码复用问题。</p>
<h4 id="1-泛型类"><a href="#1-泛型类" class="headerlink" title="1.  泛型类"></a>1.  泛型类</h4><p>需求：通过类创建对象，对象的属性可以是字符串可以是数值，对象的属性值可以是字符串可以是数值。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringKeyValuePair</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> key: <span class="built_in">string</span>, <span class="keyword">public</span> value: <span class="built_in">string</span></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NumberKeyValuePair</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> key: <span class="built_in">number</span>, <span class="keyword">public</span> value: <span class="built_in">number</span></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringNumberKeyValuePair</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> key: <span class="built_in">string</span>, <span class="keyword">public</span> value: <span class="built_in">number</span></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KeyValuePair</span>&lt;<span class="title">T</span>, <span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> key: T, <span class="keyword">public</span> value: V</span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需求： 创建数组，数组中可以存储字符串也可以存储数值，通过索引可以获取到数组中的值。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArrayOfNumbers</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> collection: <span class="built_in">number</span>[]</span>)</span> &#123;&#125;</span><br><span class="line">  get(index): <span class="built_in">number</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.collection[index];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArrayOfStrings</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> collection: <span class="built_in">string</span>[]</span>)</span> &#123;&#125;</span><br><span class="line">  get(index): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.collection[index];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在以上代码中，数值数组类和字符串数组类所做的事情是一样的，但由于创建的数据类型不同，所以写成了两个类，它们属于重复代码。</p>
<p>在 TypeScript 中使用泛型可以完美解决以上代码复用的问题。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArrayOfAnything</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> collection: T[]</span>)</span> &#123;&#125;</span><br><span class="line">  get(index): T &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.collection[index];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// constructor ArrayOfAnything&lt;number&gt;(collection: number[]): ArrayOfAnything&lt;number&gt;</span></span><br><span class="line"><span class="keyword">new</span> ArrayOfAnything&lt;<span class="built_in">number</span>&gt;([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"><span class="comment">// constructor ArrayOfAnything&lt;string&gt;(collection: string[]): ArrayOfAnything&lt;string&gt;</span></span><br><span class="line"><span class="keyword">new</span> ArrayOfAnything&lt;<span class="built_in">string</span>&gt;([<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>]);</span><br></pre></td></tr></table></figure>
<h4 id="2-泛型函数"><a href="#2-泛型函数" class="headerlink" title="2. 泛型函数"></a>2. 泛型函数</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getString</span>(<span class="params">value: <span class="built_in">string</span></span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getNumber</span>(<span class="params">value: <span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getValue</span>&lt;<span class="title">T</span>&gt;(<span class="params">value: T</span>): <span class="title">T</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getValue&lt;<span class="built_in">string</span>&gt;(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">getValue&lt;<span class="built_in">number</span>&gt;(<span class="number">100</span>);</span><br></pre></td></tr></table></figure>
<h4 id="3-泛型接口"><a href="#3-泛型接口" class="headerlink" title="3. 泛型接口"></a>3. 泛型接口</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http://api.example.com/users</span></span><br><span class="line"><span class="comment">// http://api.example.com/products</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Result&lt;T&gt; &#123;</span><br><span class="line">  <span class="attr">data</span>: T | <span class="literal">null</span>;</span><br><span class="line">  error: <span class="built_in">string</span> | <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> User &#123;</span><br><span class="line">  <span class="attr">username</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Product &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fetch</span>&lt;<span class="title">T</span>&gt;(<span class="params"></span>): <span class="title">Result</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">data</span>: <span class="literal">null</span>, <span class="attr">error</span>: <span class="literal">null</span> &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fetch&lt;User&gt;().data?.username;</span><br><span class="line">fetch&lt;Product&gt;().data?.title;</span><br></pre></td></tr></table></figure>
<h4 id="4-泛型约束"><a href="#4-泛型约束" class="headerlink" title="4. 泛型约束"></a>4. 泛型约束</h4><p>泛型约束是指对泛型参数的范围进行约束，就是说虽然类型可以被当做参数传递，但是传递的类型不能是随意的想传什么就传什么，通过泛型约束可以限制能够传递的类型的范围。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">echo</span>&lt;<span class="title">T</span> <span class="title">extends</span> <span class="title">string</span> | <span class="title">number</span>&gt;(<span class="params">value: T</span>): <span class="title">T</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line">echo(<span class="string">&#x27;Hello&#x27;</span>); <span class="comment">// ✅</span></span><br><span class="line">echo(<span class="number">100</span>);     <span class="comment">// ✅</span></span><br><span class="line">echo(&#123;&#125;);      <span class="comment">// ❎ TS2345: Argument of type &#x27;&#123;&#125;&#x27; is not assignable to parameter of type &#x27;string | number&#x27;.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Person &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">echo</span>&lt;<span class="title">T</span> <span class="title">extends</span> <span class="title">Person</span>&gt;(<span class="params">value: T</span>): <span class="title">T</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">echo(&#123; <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span> &#125;); <span class="comment">// ✅</span></span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> name: <span class="built_in">string</span></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Custom</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">echo</span>&lt;<span class="title">T</span> <span class="title">extends</span> <span class="title">Person</span>&gt;(<span class="params">value: T</span>): <span class="title">T</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">echo(<span class="keyword">new</span> Person(<span class="string">&quot;张三&quot;</span>));</span><br><span class="line">echo(<span class="keyword">new</span> Custom(<span class="string">&quot;李四&quot;</span>));</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">print</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;car&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hourse</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">print</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;Hourse&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Printable &#123;</span><br><span class="line">  print(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printHousesOrCars</span>&lt;<span class="title">T</span> <span class="title">extends</span> <span class="title">Printable</span>&gt;(<span class="params">carOrHouse: T</span>) </span>&#123;</span><br><span class="line">  carOrHouse.print();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">printHousesOrCars&lt;Car&gt;(<span class="keyword">new</span> Car());</span><br><span class="line">printHousesOrCars&lt;Hourse&gt;(<span class="keyword">new</span> Hourse());</span><br></pre></td></tr></table></figure>
<h4 id="5-继承泛型类"><a href="#5-继承泛型类" class="headerlink" title="5. 继承泛型类"></a>5. 继承泛型类</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Product &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  price: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Store</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">protected</span> _objects: T[] = [];</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">add</span>(<span class="params">obj: T</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>._objects.push(obj);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Store&lt;Product&gt;();</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CompressibleStore</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">Store</span>&lt;<span class="title">T</span>&gt; </span>&#123;&#125;</span><br><span class="line"><span class="keyword">new</span> CompressibleStore&lt;Product&gt;();</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SearchableStore</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> </span>&#123; name: <span class="built_in">string</span> &#125;&gt; <span class="keyword">extends</span> Store&lt;T&gt; &#123;</span><br><span class="line">  find(name: <span class="built_in">string</span>): T | <span class="literal">undefined</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._objects.find(<span class="function">(<span class="params">obj</span>) =&gt;</span> obj.name == name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductStore</span> <span class="keyword">extends</span> <span class="title">Store</span>&lt;<span class="title">Product</span>&gt; </span>&#123;</span><br><span class="line">  filterByPrice(price: <span class="built_in">number</span>): Product[] &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._objects.filter(<span class="function">(<span class="params">obj</span>) =&gt;</span> obj.price &gt; <span class="number">100</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-2-keyof-操作符"><a href="#6-2-keyof-操作符" class="headerlink" title="6.2 keyof 操作符"></a>6.2 keyof 操作符</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Product &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  price: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Store</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">protected</span> _objects: T[] = [];</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">add</span>(<span class="params">obj: T</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>._objects.push(obj);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  find(property: keyof T, <span class="attr">value</span>: unknown): T | <span class="literal">undefined</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._objects.find(<span class="function">(<span class="params">obj</span>) =&gt;</span> obj[property] === value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Store&lt;Product&gt;();</span><br><span class="line">store.add(&#123; <span class="attr">name</span>: <span class="string">&quot;Hello&quot;</span>, <span class="attr">price</span>: <span class="number">100</span> &#125;);</span><br><span class="line">store.find(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">store.find(<span class="string">&quot;price&quot;</span>, <span class="number">100</span>);</span><br><span class="line"><span class="comment">// TS2345: Argument of type &#x27;&quot;a&quot;&#x27; is not assignable to parameter of type &#x27;keyof Product&#x27;.</span></span><br><span class="line">store.find(<span class="string">&quot;a&quot;</span>, <span class="number">12</span>);</span><br><span class="line"><span class="comment">// TS2345: Argument of type &#x27;&quot;greet&quot;&#x27; is not assignable to parameter of type &#x27;keyof Product&#x27;.</span></span><br><span class="line">store.find(<span class="string">&quot;greet&quot;</span>, <span class="string">&quot;hi&quot;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="6-3-映射类型"><a href="#6-3-映射类型" class="headerlink" title="6.3 映射类型"></a>6.3 映射类型</h3><p>目标：创建 ReadOnly 类型，接收泛型，得到新的类型，新类型中所有的属性都是只读的。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 最终目标如下</span></span><br><span class="line"><span class="keyword">interface</span> Product &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  price: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ReadOnlyProduct = &#123;</span><br><span class="line">  <span class="keyword">readonly</span> name: <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">readonly</span> price: <span class="built_in">number</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ReadOnlyProduct = &#123;</span><br><span class="line">  <span class="keyword">readonly</span> [K <span class="keyword">in</span> keyof Product]: Product[K];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> product: ReadOnlyProduct = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">  <span class="attr">price</span>: <span class="number">100</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TS2540: Cannot assign to &#x27;name&#x27; because it is a read-only property.</span></span><br><span class="line">product.name = <span class="string">&quot;hello&quot;</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ReadOnly&lt;T&gt; = &#123;</span><br><span class="line">  <span class="keyword">readonly</span> [K <span class="keyword">in</span> keyof T]: T[K];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> product: ReadOnly&lt;Product&gt; = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">  <span class="attr">price</span>: <span class="number">100</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TS2540: Cannot assign to &#x27;name&#x27; because it is a read-only property.</span></span><br><span class="line">product.name = <span class="string">&quot;hello&quot;</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Optional&lt;T&gt; = &#123;</span><br><span class="line">  [K <span class="keyword">in</span> keyof T]?: T[K];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Nullable&lt;T&gt; = &#123;</span><br><span class="line">  [K <span class="keyword">in</span> keyof T]: T[K] | <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="6-4-工具类型"><a href="#6-4-工具类型" class="headerlink" title="6.4 工具类型"></a>6.4 工具类型</h3><h4 id="6-4-1-Partical"><a href="#6-4-1-Partical" class="headerlink" title="6.4.1 Partical"></a>6.4.1 Partical</h4><p>将类型中的属性都变成可选的，接收类型，返回类型。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Partial&lt;Type&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Person &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  age: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> person: Person = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> anothor = Partical&lt;Person&gt;;</span><br><span class="line"><span class="comment">// &#123;name?: string, age?: number&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateObject</span>&lt;<span class="title">T</span>&gt;(<span class="params">obj: T, props: Partial&lt;T&gt;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; ...obj, ...props &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">updateObject&lt;Person&gt;(person, &#123; <span class="attr">name</span>: <span class="string">&quot;李四&quot;</span> &#125;);</span><br></pre></td></tr></table></figure>
<h4 id="6-4-2-Readonly"><a href="#6-4-2-Readonly" class="headerlink" title="6.4.2 Readonly"></a>6.4.2 Readonly</h4><p>将类型中的属性都变成只读的，接收类型，返回类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Readonly&lt;Type&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Person &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  age: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> person: Person = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> anthor: Readonly&lt;Person&gt; = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;李四&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">40</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以修改</span></span><br><span class="line">person.name = <span class="string">&quot;王五&quot;</span>;</span><br><span class="line"><span class="comment">// 不可以修改</span></span><br><span class="line"><span class="comment">// anthor.name = &quot;赵六&quot;;</span></span><br></pre></td></tr></table></figure>
<h4 id="6-4-3-Record"><a href="#6-4-3-Record" class="headerlink" title="6.4.3 Record"></a>6.4.3 Record</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Record&lt;Keys, Type&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> EmployeeType &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">fullname</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">role</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> employees: Record&lt;<span class="built_in">number</span>, EmployeeType&gt; = &#123;</span><br><span class="line">  <span class="number">0</span>: &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">fullname</span>: <span class="string">&quot;John Doe&quot;</span>, <span class="attr">role</span>: <span class="string">&quot;Designer&quot;</span> &#125;,</span><br><span class="line">  <span class="number">1</span>: &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">fullname</span>: <span class="string">&quot;Ibrahima Fall&quot;</span>, <span class="attr">role</span>: <span class="string">&quot;Developer&quot;</span> &#125;,</span><br><span class="line">  <span class="number">2</span>: &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">fullname</span>: <span class="string">&quot;Sara Duckson&quot;</span>, <span class="attr">role</span>: <span class="string">&quot;Developer&quot;</span> &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-4-4-Omit"><a href="#6-4-4-Omit" class="headerlink" title="6.4.4 Omit"></a>6.4.4 Omit</h4><p>接收类型，得到新类型，在新类型中不要包含 keys</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Omit&lt;Type, Keys&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Todo &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">  description: <span class="built_in">string</span>;</span><br><span class="line">  completed: <span class="built_in">boolean</span>;</span><br><span class="line">  createdAt: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  type TodoPreview = &#123;</span></span><br><span class="line"><span class="comment">    title: string;</span></span><br><span class="line"><span class="comment">    completed: boolean;</span></span><br><span class="line"><span class="comment">    createdAt: number;</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TodoPreview = Omit&lt;Todo, <span class="string">&quot;description&quot;</span> | <span class="string">&quot;title&quot;</span>&gt;;</span><br></pre></td></tr></table></figure>
<h4 id="6-4-5-Pick"><a href="#6-4-5-Pick" class="headerlink" title="6.4.5 Pick"></a>6.4.5 Pick</h4><p>接收类型，返回新类型，在新类型中要包含 keys</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Pick&lt;Type, Keys&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Todo &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">  description: <span class="built_in">string</span>;</span><br><span class="line">  completed: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  type TodoPreview = &#123;</span></span><br><span class="line"><span class="comment">    title: string;</span></span><br><span class="line"><span class="comment">    completed: boolean;</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TodoPreview = Pick&lt;Todo, <span class="string">&quot;title&quot;</span> | <span class="string">&quot;completed&quot;</span>&gt;;</span><br></pre></td></tr></table></figure>
<h4 id="6-4-6-Exclude"><a href="#6-4-6-Exclude" class="headerlink" title="6.4.6 Exclude"></a>6.4.6 Exclude</h4><p>接收联合类型，得到新类型，在新类型中排除联合类型中的 ExcludedMembers。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exclude&lt;UnionType, ExcludedMembers&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// type T0 = &quot;b&quot; | &quot;c&quot;</span></span><br><span class="line"><span class="keyword">type</span> T0 = Exclude&lt;<span class="string">&quot;a&quot;</span> | <span class="string">&quot;b&quot;</span> | <span class="string">&quot;c&quot;</span>, <span class="string">&quot;a&quot;</span>&gt;;</span><br><span class="line"><span class="comment">// type T1 = &quot;c&quot;</span></span><br><span class="line"><span class="keyword">type</span> T1 = Exclude&lt;<span class="string">&quot;a&quot;</span> | <span class="string">&quot;b&quot;</span> | <span class="string">&quot;c&quot;</span>, <span class="string">&quot;a&quot;</span> | <span class="string">&quot;b&quot;</span>&gt;;</span><br></pre></td></tr></table></figure>
<h3 id="6-5-is"><a href="#6-5-is" class="headerlink" title="6.5 is"></a>6.5 is</h3><p>is 用于加强 TypeScript 类型推断，可以缩小类型的范围。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// isString 函数的返回值为布尔类型</span></span><br><span class="line"><span class="comment">// 如果 isString 函数的返回值为 true, TypeScript 编译器就认定 s 是字符串类型</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isString</span>(<span class="params">s: <span class="built_in">any</span></span>): <span class="title">s</span> <span class="title">is</span> <span class="title">string</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> s === <span class="string">&quot;string&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toUpperCase</span>(<span class="params">x: <span class="built_in">any</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (isString(x)) &#123;</span><br><span class="line">    <span class="keyword">return</span> x.toUpperCase();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-地图标记案例"><a href="#4-地图标记案例" class="headerlink" title="4. 地图标记案例"></a>4. 地图标记案例</h2><p>需求：随机创建用户和公司，并将他们的位置标注到地图中。</p>
<h3 id="4-1-案例准备"><a href="#4-1-案例准备" class="headerlink" title="4.1 案例准备"></a>4.1 案例准备</h3><h4 id="1-安装依赖"><a href="#1-安装依赖" class="headerlink" title="1. 安装依赖"></a>1. 安装依赖</h4><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://parceljs.org/">parcel</a> 是前端构建工具，类似 webpack，parcel 的最大特点是打包速速非常快而且零配置开箱即用。</p>
<p>什么需求打包工具？</p>
<p>ts -&gt; js -&gt; 代码不能直接运行，浏览器不识别模块。<br>ts -&gt; js -&gt; 模块打包 -&gt; 在浏览器中直接运行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install parcel@2.4.1 -g</span><br></pre></td></tr></table></figure>
<p>使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.npmjs.com/package/@faker-js/faker">@faker-js/faker</a> 可以随机创建模拟数据，当前案例中用于随机生成用户和公司信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @faker-js/faker@6.1.1</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.npmjs.com/package/@types/google.maps">@types/google.maps</a> 是谷歌地图的 TS 类型声明文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @types/google.maps@3.48.3</span><br></pre></td></tr></table></figure>
<h4 id="2-创建应用"><a href="#2-创建应用" class="headerlink" title="2. 创建应用"></a>2. 创建应用</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 maps 目录并切换至 maps 目录</span></span><br><span class="line">mkdir maps &amp;&amp; <span class="built_in">cd</span> maps</span><br><span class="line"><span class="comment"># 创建项目工程文件</span></span><br><span class="line">npm init -y</span><br><span class="line"><span class="comment"># 详见应用源码目录</span></span><br><span class="line">mkdir src</span><br><span class="line"><span class="comment"># 创建应用页面入口</span></span><br><span class="line">touch index.html</span><br><span class="line"><span class="comment"># 切换至应用源码目录并创建应用逻辑入口</span></span><br><span class="line"><span class="built_in">cd</span> src &amp;&amp; touch index.ts</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在应用页面入口文件中导入应用逻辑入口文件 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 当 parcel 检测到引入的是 TS 文件时, parcel 会先将其转换为 JS, 再将 TS 文件替换为转换后的 JS  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./src/index.ts&quot;</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动开发服务器, 运行应用</span></span><br><span class="line">parcel index.html</span><br></pre></td></tr></table></figure>
<h3 id="4-2-创建用户"><a href="#4-2-创建用户" class="headerlink" title="4.2 创建用户"></a>4.2 创建用户</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/User.ts</span></span><br><span class="line"><span class="keyword">import</span> faker <span class="keyword">from</span> <span class="string">&quot;@faker-js/faker&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 姓名</span></span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="comment">// 位置</span></span><br><span class="line">  location: &#123;</span><br><span class="line">    <span class="comment">// 纬度</span></span><br><span class="line">    <span class="attr">lat</span>: <span class="built_in">number</span>;</span><br><span class="line">    <span class="comment">// 经度</span></span><br><span class="line">    lng: <span class="built_in">number</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 随机创建用户姓名</span></span><br><span class="line">    <span class="built_in">this</span>.name = faker.name.firstName();</span><br><span class="line">    <span class="comment">// 随机创建用户位置</span></span><br><span class="line">    <span class="built_in">this</span>.location = &#123;</span><br><span class="line">      <span class="attr">lat</span>: <span class="built_in">parseFloat</span>(faker.address.latitude()),</span><br><span class="line">      <span class="attr">lng</span>: <span class="built_in">parseFloat</span>(faker.address.longitude()),</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="comment">// 导入 User 类</span></span><br><span class="line"><span class="keyword">import</span> &#123; User &#125; <span class="keyword">from</span> <span class="string">&quot;./User&quot;</span>;</span><br><span class="line"><span class="comment">// 创建用户</span></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">new</span> User();</span><br><span class="line"><span class="comment">// 测试:在控制台中输出用户信息</span></span><br><span class="line"><span class="built_in">console</span>.log(user);</span><br></pre></td></tr></table></figure>
<h3 id="4-3-创建公司"><a href="#4-3-创建公司" class="headerlink" title="4.3 创建公司"></a>4.3 创建公司</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Company.ts</span></span><br><span class="line"><span class="keyword">import</span> faker <span class="keyword">from</span> <span class="string">&quot;@faker-js/faker&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Company</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 公司名称</span></span><br><span class="line">  <span class="attr">companyName</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="comment">// 公司口号</span></span><br><span class="line">  catchPhrase: <span class="built_in">string</span>;</span><br><span class="line">  <span class="comment">// 公司位置</span></span><br><span class="line">  location: &#123;</span><br><span class="line">    <span class="comment">// 纬度</span></span><br><span class="line">    <span class="attr">lat</span>: <span class="built_in">number</span>;</span><br><span class="line">    <span class="comment">// 经度</span></span><br><span class="line">    lng: <span class="built_in">number</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 随机创建公司名称</span></span><br><span class="line">    <span class="built_in">this</span>.companyName = faker.company.companyName();</span><br><span class="line">    <span class="comment">// 随机创建公司口号</span></span><br><span class="line">    <span class="built_in">this</span>.catchPhrase = faker.company.catchPhrase();</span><br><span class="line">    <span class="comment">// 随机创建公司位置</span></span><br><span class="line">    <span class="built_in">this</span>.location = &#123;</span><br><span class="line">      <span class="attr">lat</span>: <span class="built_in">parseFloat</span>(faker.address.latitude()),</span><br><span class="line">      <span class="attr">lng</span>: <span class="built_in">parseFloat</span>(faker.address.longitude()),</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="comment">// 导入 Company  类</span></span><br><span class="line"><span class="keyword">import</span> &#123; Company &#125; <span class="keyword">from</span> <span class="string">&quot;./Company&quot;</span>;</span><br><span class="line"><span class="comment">// 创建公司</span></span><br><span class="line"><span class="keyword">const</span> company = <span class="keyword">new</span> Company();</span><br><span class="line"><span class="comment">// 测试: 在控制台中输出公司信息</span></span><br><span class="line"><span class="built_in">console</span>.log(company);</span><br></pre></td></tr></table></figure>
<h3 id="4-4-创建地图"><a href="#4-4-创建地图" class="headerlink" title="4.4 创建地图"></a>4.4 创建地图</h3><p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/ts/images/06.png" /></p>
<p>第一步：在应用页面入口文件中添加 Google Map API。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://maps.googleapis.com/maps/api/js?key=AIzaSyBNLrJhOMz6idD05pzfn5lhA-TAw-mAZCU&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>第二步：在应用入口文件中创建用户放置地图的容器。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">  <span class="selector-tag">html</span>, <span class="selector-tag">body</span>, <span class="selector-id">#map</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">  &#125;</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;map&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>第三步：创建地图</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> google.maps.Map(<span class="built_in">document</span>.getElementById(<span class="string">&quot;map&quot;</span>), &#123;</span><br><span class="line">  <span class="attr">zoom</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">center</span>: &#123;</span><br><span class="line">    <span class="attr">lat</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">lng</span>: <span class="number">0</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="4-5-封装地图类"><a href="#4-5-封装地图类" class="headerlink" title="4.5 封装地图类"></a>4.5 封装地图类</h3><p>目标：创建 Map 类，在类中封装和地图的相关的业务逻辑，以后在创建地图时只需要对该类进行实例化即可。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Map.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Map</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 用于存储地图实例</span></span><br><span class="line">  <span class="keyword">private</span> googleMap: google.maps.Map;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">divId: <span class="built_in">string</span></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 创建地图</span></span><br><span class="line">    <span class="built_in">this</span>.googleMap = <span class="keyword">new</span> google.maps.Map(<span class="built_in">document</span>.getElementById(divId), &#123;</span><br><span class="line">      <span class="attr">zoom</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">center</span>: &#123;</span><br><span class="line">        <span class="attr">lat</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">lng</span>: <span class="number">0</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="built_in">Map</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./Map&quot;</span>;</span><br><span class="line"><span class="comment">// 创建地图</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Map</span>(<span class="string">&quot;map&quot;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="4-6-地图标记"><a href="#4-6-地图标记" class="headerlink" title="4.6 地图标记"></a>4.6 地图标记</h3><p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/ts/images/05.png" /></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Map.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Company &#125; <span class="keyword">from</span> <span class="string">&quot;./Company&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; User &#125; <span class="keyword">from</span> <span class="string">&quot;./User&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Map</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 在地图中标记用户位置</span></span><br><span class="line">  <span class="function"><span class="title">addUserMarker</span>(<span class="params">user: User</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">new</span> google.maps.Marker(&#123;</span><br><span class="line">      <span class="attr">map</span>: <span class="built_in">this</span>.googleMap,</span><br><span class="line">      <span class="attr">position</span>: &#123;</span><br><span class="line">        <span class="attr">lat</span>: user.location.lat,</span><br><span class="line">        <span class="attr">lng</span>: user.location.lng,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 在地图中标记公司位置</span></span><br><span class="line">  <span class="function"><span class="title">addCompanyMarker</span>(<span class="params">company: Company</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">new</span> google.maps.Marker(&#123;</span><br><span class="line">      <span class="attr">map</span>: <span class="built_in">this</span>.googleMap,</span><br><span class="line">      <span class="attr">position</span>: &#123;</span><br><span class="line">        <span class="attr">lat</span>: company.location.lat,</span><br><span class="line">        <span class="attr">lng</span>: company.location.lng,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>(<span class="string">&quot;map&quot;</span>);</span><br><span class="line">map.addUserMarker(user);</span><br><span class="line">map.addCompanyMarker(company);</span><br></pre></td></tr></table></figure>
<h3 id="4-7-消除重复代码"><a href="#4-7-消除重复代码" class="headerlink" title="4.7 消除重复代码"></a>4.7 消除重复代码</h3><p>在目前的代码中，addUserMarker 和 addCompanyMarker 两个方法中的代码是一模一样的，为消除重复代码，现决定将两个方法进行合并，并将参数更改为 User 和 Company 的联合类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Company &#125; <span class="keyword">from</span> <span class="string">&quot;./Company&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; User &#125; <span class="keyword">from</span> <span class="string">&quot;./User&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Map</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 在地图中标记位置</span></span><br><span class="line">  <span class="function"><span class="title">addMarker</span>(<span class="params">mappable: User | Company</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">new</span> google.maps.Marker(&#123;</span><br><span class="line">      <span class="attr">map</span>: <span class="built_in">this</span>.googleMap,</span><br><span class="line">      <span class="attr">position</span>: &#123;</span><br><span class="line">        <span class="attr">lat</span>: mappable.location.lat,</span><br><span class="line">        <span class="attr">lng</span>: mappable.location.lng,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于 location 属性是 User 、Company 类型中的公共属性，所以在addMarker 方法中可以直接调用。</p>
<h3 id="4-8-增加程序扩展性"><a href="#4-8-增加程序扩展性" class="headerlink" title="4.8 增加程序扩展性"></a>4.8 增加程序扩展性</h3><p>虽然重复代码被消除了，但是这不利于程序的扩展性，如果要在地图中标记其他物体的位置信息，那么就只能在参数后面不断的罗列其他物体的类型信息了。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">addMarker</span>(<span class="params">mappable: User | Company | Park | School</span>)</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>解决问题的方式是定义通用的类型接口，不论是什么数据类型只要满足接口中定义的规范即可，从而解决程序扩展性问题。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Mappable &#123;</span><br><span class="line">  <span class="attr">location</span>: &#123;</span><br><span class="line">    <span class="attr">lat</span>: <span class="built_in">number</span>;</span><br><span class="line">    lng: <span class="built_in">number</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">addMarker</span>(<span class="params">mappable: Mappable</span>)</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>在目前的代码中，不论是 User 类的实例还是 Company 类的实例，都是满足 Mappable 接口规范的。</p>
<h3 id="4-9-创建标记弹框"><a href="#4-9-创建标记弹框" class="headerlink" title="4.9 创建标记弹框"></a>4.9 创建标记弹框</h3><p>目标：在点击地图中的标记时，通过弹框展示标记信息。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Map.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Map</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 在地图中标记位置</span></span><br><span class="line">  <span class="function"><span class="title">addMarker</span>(<span class="params">mappable: Mappable</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 创建标记</span></span><br><span class="line">    <span class="keyword">const</span> marker = <span class="keyword">new</span> google.maps.Marker();</span><br><span class="line">    <span class="comment">// 为标记绑定点击事件</span></span><br><span class="line">    marker.addListener(<span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 创建弹窗</span></span><br><span class="line">      <span class="keyword">const</span> infoWindow = <span class="keyword">new</span> google.maps.InfoWindow(&#123;</span><br><span class="line">        <span class="attr">content</span>: <span class="string">&quot;Hello I am marker content&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">// 打开弹框并指定弹框在哪个地图的哪个的标记的位置上弹出</span></span><br><span class="line">      infoWindow.open(<span class="built_in">this</span>.googleMap, marker);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-10-使用接口约束类"><a href="#4-10-使用接口约束类" class="headerlink" title="4.10 使用接口约束类"></a>4.10 使用接口约束类</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Map.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> Mappable &#123;</span><br><span class="line">  markerContent(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Map.ts</span></span><br><span class="line"><span class="keyword">const</span> infoWindow = <span class="keyword">new</span> google.maps.InfoWindow(&#123;</span><br><span class="line">  <span class="attr">content</span>: mappable.markerContent(),</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/User.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Mappable &#125; <span class="keyword">from</span> <span class="string">&quot;./Map&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="title">implements</span> <span class="title">Mappable</span> </span>&#123;</span><br><span class="line">  markerContent(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`用户名: <span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span>`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Company.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Mappable &#125; <span class="keyword">from</span> <span class="string">&quot;./Map&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Company</span> <span class="title">implements</span> <span class="title">Mappable</span> </span>&#123;</span><br><span class="line">  markerContent(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;h2&gt;公司名称: <span class="subst">$&#123;<span class="built_in">this</span>.companyName&#125;</span>&lt;/h2&gt;</span></span><br><span class="line"><span class="string">      &lt;h4&gt;公司口号: <span class="subst">$&#123;<span class="built_in">this</span>.catchPhrase&#125;</span>&lt;/h4&gt;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5-排序案例"><a href="#5-排序案例" class="headerlink" title="5. 排序案例"></a>5. 排序案例</h2><h3 id="5-1-概述-1"><a href="#5-1-概述-1" class="headerlink" title="5.1 概述"></a>5.1 概述</h3><p>目标：实现一个通用的排序算法类，使它能够对数值数组进行排序、能够对字符串进行排序等。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数值数组排序</span></span><br><span class="line">[<span class="number">10</span>, <span class="number">5</span>, <span class="number">18</span>, -<span class="number">3</span>] =&gt; [-<span class="number">3</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">18</span>]</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 字符串排序</span></span><br><span class="line"><span class="string">&quot;PoaJB&quot;</span> =&gt; <span class="string">&quot;aBJoP&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="5-2-配置编译器"><a href="#5-2-配置编译器" class="headerlink" title="5.2 配置编译器"></a>5.2 配置编译器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建项目目录</span></span><br><span class="line">mkdir sort</span><br><span class="line"><span class="comment"># 创建项目源码目录</span></span><br><span class="line"><span class="built_in">cd</span> sort &amp;&amp; mkdir src build</span><br><span class="line"><span class="comment"># 创建 ts 配置文件</span></span><br><span class="line">tsc --init</span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="comment">// 配置应用源码目录</span></span><br><span class="line">    <span class="attr">&quot;rootDir&quot;</span>: <span class="string">&quot;./src&quot;</span>,</span><br><span class="line">    <span class="comment">// 配置编译输出目录</span></span><br><span class="line">    <span class="attr">&quot;outDir&quot;</span>: <span class="string">&quot;./build&quot;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 监控文件变化, 重新编译</span></span><br><span class="line">tsc -w</span><br></pre></td></tr></table></figure>
<h3 id="5-3-并行编译配置"><a href="#5-3-并行编译配置" class="headerlink" title="5.3 并行编译配置"></a>5.3 并行编译配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br><span class="line">npm install nodemon concurrently</span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="attr">&quot;start:build&quot;</span>: <span class="string">&quot;tsc -w&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;start:run&quot;</span>: <span class="string">&quot;nodemon build/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;start&quot;</span>: <span class="string">&quot;concurrently npm:start:*&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure>
<h3 id="5-4-复习冒泡排序-升序"><a href="#5-4-复习冒泡排序-升序" class="headerlink" title="5.4 复习冒泡排序(升序)"></a>5.4 复习冒泡排序(升序)</h3><p>核心思想：数组中的值进行两两比较，如果第一个值比第二个值大，将两个值交换位置。</p>
<p>比较轮数: 数组长度 - 1</p>
<p>每一轮比较次数: 数组长度 - 1 - i</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">原始值 =&gt; [<span class="number">10</span>, <span class="number">5</span>, <span class="number">18</span>, -<span class="number">3</span>]</span><br><span class="line">第一轮 =&gt; [<span class="number">5</span>, <span class="number">10</span>, -<span class="number">3</span>, <span class="number">18</span>] =&gt; <span class="number">3</span>次</span><br><span class="line">第二轮 =&gt; [<span class="number">5</span>, -<span class="number">3</span>, <span class="number">10</span>, <span class="number">18</span>] =&gt; <span class="number">2</span>次</span><br><span class="line">第三轮 =&gt; [-<span class="number">3</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">18</span>] =&gt; <span class="number">1</span>次</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">10</span>, <span class="number">5</span>, <span class="number">18</span>, -<span class="number">3</span>];</span><br><span class="line"><span class="comment">// 外层循环控制比较的轮数</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">  <span class="comment">// 内层循环控制比较的次数</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; arr.length - <span class="number">1</span> - i; j++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (arr[j] &gt; arr[j + <span class="number">1</span>]) &#123;</span><br><span class="line">      <span class="comment">// 交换位置</span></span><br><span class="line">      <span class="keyword">let</span> leftHand = arr[j];</span><br><span class="line">      arr[j] = arr[j + <span class="number">1</span>];</span><br><span class="line">      arr[j + <span class="number">1</span>] = leftHand;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-5-创建排序类"><a href="#5-5-创建排序类" class="headerlink" title="5.5 创建排序类"></a>5.5 创建排序类</h3><p>目标：创建排序类，通过实例化排序类创建排序对象并传递要排序的数据，调用排序对象下的 sort 方法对数据进行排序。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sorter</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 接收排序值</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> collection: <span class="built_in">number</span>[]</span>)</span> &#123;&#125;</span><br><span class="line">  <span class="comment">// 排序方法</span></span><br><span class="line">  sort(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; length &#125; = <span class="built_in">this</span>.collection;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; length - <span class="number">1</span> - i; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.collection[j] &gt; <span class="built_in">this</span>.collection[j + <span class="number">1</span>]) &#123;</span><br><span class="line">          <span class="keyword">var</span> leftHand = <span class="built_in">this</span>.collection[j];</span><br><span class="line">          <span class="built_in">this</span>.collection[j] = <span class="built_in">this</span>.collection[j + <span class="number">1</span>];</span><br><span class="line">          <span class="built_in">this</span>.collection[j + <span class="number">1</span>] = leftHand;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sorter = <span class="keyword">new</span> Sorter([<span class="number">10</span>, <span class="number">5</span>, <span class="number">18</span>, -<span class="number">3</span>]);</span><br><span class="line">sorter.sort();</span><br><span class="line"><span class="built_in">console</span>.log(sorter.collection);</span><br></pre></td></tr></table></figure>
<p>我们已经初步实现了排序，但目前它只能排序数值数组，我们希望如果 collection 是字符串，sort 方法依然可以进行排序。</p>
<p>对于数值数组来说，我们是通过交换元素的位置对其进行排序的，但是字符串是不可变数据结构，字符串中的字符是不能交换位置的, 所以以上排序代码并不适合字符串。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">string</span> = <span class="string">&quot;Xaa&quot;</span>;</span><br><span class="line"><span class="comment">// 编译器提示: 类型 &quot;String&quot; 中的索引签名仅允许读取。</span></span><br><span class="line"><span class="built_in">string</span>[<span class="number">0</span>] = <span class="string">&quot;Y&quot;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="5-6-类型守卫"><a href="#5-6-类型守卫" class="headerlink" title="5.6  类型守卫"></a>5.6  类型守卫</h3><p>目标：通过联合类型和类型守卫对 collection 参数的类型进行区分，针对不同的类型进行不同的排序。</p>
<p>类型守卫是指在操作变量之前先对变量的类型进行判断，针对不同类型的变量进行不同的操作。</p>
<p>将 collection 参数的类型指定为联合类型，即参数既可以数值数组也可以是字符串，然后通过类型守卫针对不同的类型进行不同的处理。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sorter</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> collection: <span class="built_in">number</span>[] | <span class="built_in">string</span></span>)</span> &#123;&#125;</span><br><span class="line">  sort(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// 由于数组和字符串都有 length 属性, 所以此处代码没有问题</span></span><br><span class="line">    <span class="comment">// 就是说在 sort 方法中, 默认情况下只能调用数组和字符串下的公有的属性和方法</span></span><br><span class="line">    <span class="keyword">const</span> &#123; length &#125; = <span class="built_in">this</span>.collection;</span><br><span class="line">    <span class="comment">// 通过类型守卫明确数据类型后再进行处理</span></span><br><span class="line">    <span class="comment">// 如果 collection 是数组类型</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.collection <span class="keyword">instanceof</span> <span class="built_in">Array</span>) &#123;</span><br><span class="line">      <span class="comment">// 针对数组进行处理, 可以调用数组下面的属性和方法</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">this</span>.collection === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 针对字符串进行处理, 可以调用字符串下面的属性和方法</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>虽然通过类型守卫可以让 Sorter 类支持多种数据的排序，但这种方式并不理想。如果以后要想对其它数据类型排序，我们不得不回到 Sorter 类中，在参数中继续添加联合类型，在 sort 方法中继续编写判断数据类型的方法，而且每种数据类型排序中大概率会有重复代码。</p>
<h3 id="5-7-创建数值数组排序类"><a href="#5-7-创建数值数组排序类" class="headerlink" title="5.7 创建数值数组排序类"></a>5.7 创建数值数组排序类</h3><p>通过对排序逻辑进行拆分可以让 Sorter 类支持多种数据结构的排序，那么如何对排序逻辑进行拆分呢？</p>
<p>排序逻辑可以拆分为通用排序逻辑和针对不同数据结构的特定排序逻辑，两种类别的逻辑要被编写在不同的类中。</p>
<p>通用的排序逻辑编写在 Sorter 类中，不同数据结构的特定排序逻辑编写在用于排序特定数据结构的排序类中。</p>
<p>对于数值数组可以为它创建 NumbersCollection 排序类，对于字符串可以为它创建 CharacterCollection 排序类。</p>
<p>冒泡排序的通用逻辑是指控制比较轮数的第一层for循环和控制比较次数的第二层for循环，这些逻辑应该放在 Sorter 类中。</p>
<p>冒泡排序的非通用逻辑是指数据两两比较的逻辑，数据交换位置的逻辑，获取数据长度的逻辑，这是特定数据结构排序类中要编写的代码。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/NumbersCollection.ts</span></span><br><span class="line"><span class="comment">// 创建数值数组排序类, 提供数值数组的两两比较逻辑和数据交互逻辑以及数组长度</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">NumbersCollection</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 接收数值数组</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> data: <span class="built_in">number</span>[]</span>)</span> &#123;&#125;</span><br><span class="line">  <span class="comment">// 返回数值数组的长度</span></span><br><span class="line">  <span class="keyword">get</span> <span class="title">length</span>(): <span class="title">number</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.data.length;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 声明比较方法</span></span><br><span class="line">  compare(leftIndex: <span class="built_in">number</span>, <span class="attr">rightIndex</span>: <span class="built_in">number</span>): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.data[leftIndex] &gt; <span class="built_in">this</span>.data[rightIndex];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 声明交换元素位置的方法</span></span><br><span class="line">  swap(leftIndex: <span class="built_in">number</span>, <span class="attr">rightIndex</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> leftHand = <span class="built_in">this</span>.data[leftIndex];</span><br><span class="line">    <span class="built_in">this</span>.data[leftIndex] = <span class="built_in">this</span>.data[rightIndex];</span><br><span class="line">    <span class="built_in">this</span>.data[rightIndex] = leftHand;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Sorter.ts</span></span><br><span class="line"><span class="comment">// 创建排序类, 提供公共的排序逻辑</span></span><br><span class="line"><span class="keyword">import</span> &#123; NumbersCollection &#125; <span class="keyword">from</span> <span class="string">&quot;./NumbersCollection&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Sorter</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 接收其他数据类的实例对象</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> collection: NumbersCollection</span>)</span> &#123;&#125;</span><br><span class="line">  <span class="comment">// 排序方法</span></span><br><span class="line">  sort(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// 获取数据长度, 根据长度进行遍历</span></span><br><span class="line">    <span class="keyword">const</span> &#123; length &#125; = <span class="built_in">this</span>.collection;</span><br><span class="line">    <span class="comment">// 根据数据长度定义比较轮数</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">      <span class="comment">// 根据数据长度定义比较次数</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; length - <span class="number">1</span> - i; j++) &#123;</span><br><span class="line">        <span class="comment">// 使用数据类实例提供的比较逻辑进行比较</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.collection.compare(j, j + <span class="number">1</span>)) &#123;</span><br><span class="line">          <span class="comment">// 实例数据类实例提供的交换数据位置的方法对数据位置进行交换</span></span><br><span class="line">          <span class="built_in">this</span>.collection.swap(j, j + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="comment">// 导入数值数组排序类</span></span><br><span class="line"><span class="keyword">import</span> &#123; NumbersCollection &#125; <span class="keyword">from</span> <span class="string">&quot;./NumbersCollection&quot;</span>;</span><br><span class="line"><span class="comment">// 导入排序类</span></span><br><span class="line"><span class="keyword">import</span> &#123; Sorter &#125; <span class="keyword">from</span> <span class="string">&quot;./Sorter&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用数值数组排序类创建数值数组排序实例</span></span><br><span class="line"><span class="keyword">var</span> numbersCollection = <span class="keyword">new</span> NumbersCollection([<span class="number">5</span>, <span class="number">10</span>, -<span class="number">3</span>, <span class="number">18</span>]);</span><br><span class="line"><span class="comment">// 创建排序类实例，并传入数值数组排序类实例</span></span><br><span class="line"><span class="keyword">var</span> sorter = <span class="keyword">new</span> Sorter(numbersCollection);</span><br><span class="line"><span class="comment">// 调用排序方法对数值数组进行排序</span></span><br><span class="line">sorter.sort();</span><br><span class="line"><span class="comment">// 输出排序结果</span></span><br><span class="line"><span class="built_in">console</span>.log(numbersCollection.data);</span><br></pre></td></tr></table></figure>
<h3 id="5-8-定义排序接口"><a href="#5-8-定义排序接口" class="headerlink" title="5.8 定义排序接口"></a>5.8 定义排序接口</h3><p>在以上的代码中存在一个问题，就是 Sorter 类中的 collection 参数的类型被固定为了 NumbersCollection，其他数据类型的排序类实例传递不进来了。</p>
<p>解决该问题的方法是定义一个通用接口规范用于约束 collection 参数的类型，只要其他的数据类型符合该接口，就可以使用 Sorter 类进行排序。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Sortable &#123;</span><br><span class="line">  <span class="attr">length</span>: <span class="built_in">number</span>;</span><br><span class="line">  compare(leftIndex: <span class="built_in">number</span>, <span class="attr">rightIndex</span>: <span class="built_in">number</span>): <span class="built_in">boolean</span>;</span><br><span class="line">  swap(leftIndex: <span class="built_in">number</span>, <span class="attr">rightIndex</span>: <span class="built_in">number</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Sorter</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 在实例化 Sorter 类时传递的参数的类型必须符合 Sortable 接口规范</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> collection: Sortable</span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-9-创建字符串排序类"><a href="#5-9-创建字符串排序类" class="headerlink" title="5.9 创建字符串排序类"></a>5.9 创建字符串排序类</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/CharacterCollection.ts</span></span><br><span class="line"><span class="comment">// 创建字符串排序类</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">CharacterCollection</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 接收要排序的字符串</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> data: <span class="built_in">string</span></span>)</span> &#123;&#125;</span><br><span class="line">  <span class="comment">// 返回字符串长度</span></span><br><span class="line">  <span class="keyword">get</span> <span class="title">length</span>(): <span class="title">number</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.data.length;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 比较</span></span><br><span class="line">  compare(leftIndex: <span class="built_in">number</span>, <span class="attr">rightIndex</span>: <span class="built_in">number</span>): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="built_in">this</span>.data[leftIndex].toLocaleLowerCase() &gt;</span><br><span class="line">      <span class="built_in">this</span>.data[rightIndex].toLocaleLowerCase()</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 位置交换</span></span><br><span class="line">  swap(leftIndex: <span class="built_in">number</span>, <span class="attr">rightIndex</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> characters = <span class="built_in">this</span>.data.split(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> leftHand = characters[leftIndex];</span><br><span class="line">    characters[leftIndex] = characters[rightIndex];</span><br><span class="line">    characters[rightIndex] = leftHand;</span><br><span class="line">    <span class="built_in">this</span>.data = characters.join(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>提示：字符串比较内部使用的是 Unicode 编码，根据编码的大小决定排序结果。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">string</span> = <span class="string">&quot;Xaa&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">string</span>.charCodeAt(<span class="number">0</span>)); <span class="comment">// 88</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">string</span>.charCodeAt(<span class="number">1</span>)); <span class="comment">// 97</span></span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CharacterCollection &#125; <span class="keyword">from</span> <span class="string">&quot;./CharacterCollection&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Sorter &#125; <span class="keyword">from</span> <span class="string">&quot;./Sorter&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> characters = <span class="keyword">new</span> CharacterCollection(<span class="string">&quot;zyx&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> sorter = <span class="keyword">new</span> Sorter(characters);</span><br><span class="line">sorter.sort();</span><br><span class="line"><span class="built_in">console</span>.log(characters.data);</span><br></pre></td></tr></table></figure>
<h3 id="5-10-简化排序类使用方式"><a href="#5-10-简化排序类使用方式" class="headerlink" title="5.10 简化排序类使用方式"></a>5.10 简化排序类使用方式</h3><p>目前在对数据进行排序时，需要分别实例化数据排序类和 Sorter 类，不是特别友好。</p>
<p>如果仅实例化数据排序类就可以对数据进行排序就比较理想了，要实现这个目标只需要让数据类继承 Sorter 类即可。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以下代码为最终的调用方式</span></span><br><span class="line"><span class="keyword">var</span> numbersCollection = <span class="keyword">new</span> NumbersCollection([<span class="number">5</span>, <span class="number">10</span>, -<span class="number">3</span>, <span class="number">18</span>]);</span><br><span class="line">numbersCollection.sort();</span><br><span class="line"><span class="built_in">console</span>.log(numbersCollection.data);</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/NumbersCollection.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Sorter &#125; <span class="keyword">from</span> <span class="string">&quot;./Sorter&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数据类继承 Sorter 类, 让数据类型拥有 sort 方法</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">NumbersCollection</span> <span class="keyword">extends</span> <span class="title">Sorter</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 接收数值数组</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> data: <span class="built_in">number</span>[]</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 返回数值数组的长度</span></span><br><span class="line">  <span class="keyword">get</span> <span class="title">length</span>(): <span class="title">number</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.data.length;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 声明比较方法</span></span><br><span class="line">  compare(leftIndex: <span class="built_in">number</span>, <span class="attr">rightIndex</span>: <span class="built_in">number</span>): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.data[leftIndex] &gt; <span class="built_in">this</span>.data[rightIndex];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 声明交换元素位置的方法</span></span><br><span class="line">  swap(leftIndex: <span class="built_in">number</span>, <span class="attr">rightIndex</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> leftHand = <span class="built_in">this</span>.data[leftIndex];</span><br><span class="line">    <span class="built_in">this</span>.data[leftIndex] = <span class="built_in">this</span>.data[rightIndex];</span><br><span class="line">    <span class="built_in">this</span>.data[rightIndex] = leftHand;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当数据排序类继承了 Sorter 类以后，Sorter 类就不需要被直接实例化了，所以也不需要接收 collection 参数了，也不需要 Sortable 接口了。</p>
<p>在去除了 collection 参数以后，在 sort 方法中，通过 this 获取 length、compare、swap。</p>
<p>因为数据排序类继承了 Sorter 类，其实就是将父类中的方法添加到了子类的实例对象中，sort 方法在执行是， this 指向子类实例对象。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Sorter.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Sorter</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 排序方法</span></span><br><span class="line">  sort(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// 获取数据长度, 根据长度进行遍历</span></span><br><span class="line">    <span class="keyword">const</span> &#123; length &#125; = <span class="built_in">this</span>;</span><br><span class="line">    <span class="comment">// 根据数据长度定义比较轮数</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">      <span class="comment">// 根据数据长度定义比较次数</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; length - <span class="number">1</span> - i; j++) &#123;</span><br><span class="line">        <span class="comment">// 使用数据类实例提供的比较逻辑进行比较</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.compare(j, j + <span class="number">1</span>)) &#123;</span><br><span class="line">          <span class="comment">// 实例数据类实例提供的交换数据位置的方法对数据位置进行交换</span></span><br><span class="line">          <span class="built_in">this</span>.swap(j, j + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是对于以上代码 TypeScript 编译器会报错，因为它在解析 Sorter 类时没有找到 length、compare、swap，它是期望本类中有这些属性和方法的。</p>
<p>可以使用抽象类解决编译器报错问题，那么到底什么是抽象类？</p>
<h3 id="5-11-抽象类-1"><a href="#5-11-抽象类-1" class="headerlink" title="5.11 抽象类"></a>5.11 抽象类</h3><p>在抽象类的方法中可以调用本类中不存在的属性或者方法，但是这些不存在的属性或方法需要被定义为抽象方法，通过这种方式告诉 TypeScript 编译器虽然当前类中没有这些方法，但是在继承了抽象类的子类中一定是有这些属性或方法的，这样 TypeScript 编译器就不会报错了。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// abstract 关键字用于定义抽象类和抽象类成员</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Sorter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">abstract</span> compare(leftIndex: <span class="built_in">number</span>, <span class="attr">rightIndex</span>: <span class="built_in">number</span>): <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="keyword">abstract</span> swap(leftIndex: <span class="built_in">number</span>, <span class="attr">rightIndex</span>: <span class="built_in">number</span>): <span class="built_in">void</span>;</span><br><span class="line">  <span class="keyword">abstract</span> length: <span class="built_in">number</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="title">sort</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>抽象类是专供子类继承使用的，继承了抽象类的类必须实现抽象类中定义的属性和方法，通过抽象类可以约束子类中必须实现特定的属性和方法。</p>
<p>如果子类在继承抽象类以后，没有实现抽象类中要求的属性和方法，TypeScript 就会在子类中报错。</p>
<p>抽象类不能被直接实例化，这也是符合我们的场景的，因为 Sorter 类目前不再需要被直接实例化。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/CharacterCollection.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Sorter &#125; <span class="keyword">from</span> <span class="string">&quot;./Sorter&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">CharacterCollection</span> <span class="keyword">extends</span> <span class="title">Sorter</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 接收要排序的字符串</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> data: <span class="built_in">string</span></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="keyword">var</span> characters = <span class="keyword">new</span> CharacterCollection(<span class="string">&quot;zyx&quot;</span>);</span><br><span class="line">characters.sort();</span><br><span class="line"><span class="built_in">console</span>.log(characters.data);</span><br></pre></td></tr></table></figure>
<p>在当前案例中，我们通过继承的方式从父类中获取了公共的 sort 方法，因为 sort 方法在执行后要调用子类的一些特定方法，所有又通过抽象类的方式约束了子类必须实现的一些属性和方法。</p>
<h2 id="6-统计数据案例"><a href="#6-统计数据案例" class="headerlink" title="6. 统计数据案例"></a>6. 统计数据案例</h2><h3 id="6-1-概述"><a href="#6-1-概述" class="headerlink" title="6.1 概述"></a>6.1 概述</h3><p>需求：从 CSV 格式的文件中读取足球比赛信息，并将它转换为程序支持的数据格式，分析数据（比如找出哪支球队赢得最多或者输的最多、每场比赛的平均进球数），生成报告（在控制台或其他地方输出分析结果）。</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/ts/images/07.png" /></p>
<p>H： 表示主队胜利、A：表示客队胜利、D：表示平局</p>
<h3 id="6-2-项目设置"><a href="#6-2-项目设置" class="headerlink" title="6.2 项目设置"></a>6.2 项目设置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir stats &amp;&amp; <span class="built_in">cd</span> stats</span><br><span class="line">mkdir src build</span><br><span class="line">npm init -y</span><br><span class="line">tsc --init</span><br><span class="line">npm install nodemon concurrently @types/node</span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tsconfig.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="comment">// 配置应用源码目录</span></span><br><span class="line">    <span class="attr">&quot;rootDir&quot;</span>: <span class="string">&quot;./src&quot;</span>,</span><br><span class="line">    <span class="comment">// 配置编译输出目录</span></span><br><span class="line">    <span class="attr">&quot;outDir&quot;</span>: <span class="string">&quot;./build&quot;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="attr">&quot;start:build&quot;</span>: <span class="string">&quot;tsc -w&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;start:run&quot;</span>: <span class="string">&quot;nodemon build/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;start&quot;</span>: <span class="string">&quot;concurrently npm:start:*&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-3-需求-gt-CSV-数据解析"><a href="#6-3-需求-gt-CSV-数据解析" class="headerlink" title="6.3 需求 -&gt; CSV 数据解析"></a>6.3 需求 -&gt; CSV 数据解析</h3><p>目标：将 CSV 文件中的内容字符串解析为数组对象。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&quot;fs&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> matches = fs</span><br><span class="line">  .readFileSync(<span class="string">&quot;football.csv&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">encoding</span>: <span class="string">&quot;utf-8&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  .split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">  .map((row: <span class="built_in">string</span>): <span class="built_in">string</span>[] =&gt; row.split(<span class="string">&quot;,&quot;</span>));</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 解析结果</span></span><br><span class="line"><span class="keyword">const</span> matches = [</span><br><span class="line">  [<span class="string">&quot;27/10/2021&quot;</span>, <span class="string">&quot;Watford&quot;</span>, <span class="string">&quot;Huddersfield&quot;</span>, <span class="string">&quot;3&quot;</span>, <span class="string">&quot;0&quot;</span>, <span class="string">&quot;H&quot;</span>, <span class="string">&quot;M Dean&quot;</span>],</span><br><span class="line">  [<span class="string">&quot;28/10/2021&quot;</span>, <span class="string">&quot;Burnley&quot;</span>, <span class="string">&quot;Chelsea&quot;</span>, <span class="string">&quot;0&quot;</span>, <span class="string">&quot;4&quot;</span>, <span class="string">&quot;A&quot;</span>, <span class="string">&quot;C Pawson&quot;</span>],</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<h3 id="6-4-需求-gt-求曼联赢赛的次数"><a href="#6-4-需求-gt-求曼联赢赛的次数" class="headerlink" title="6.4 需求 -&gt; 求曼联赢赛的次数"></a>6.4 需求 -&gt; 求曼联赢赛的次数</h3><p>计算曼联球队(Man United)赢得比赛的次数，无论曼联球队是主场(H)还是客场(A)。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="keyword">let</span> manUnitedWins = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> match <span class="keyword">of</span> matches) &#123;</span><br><span class="line">  <span class="comment">// 曼联球队为主场赢得比赛的情况</span></span><br><span class="line">  <span class="keyword">if</span> (match[<span class="number">1</span>] === <span class="string">&quot;Man United&quot;</span> &amp;&amp; match[<span class="number">5</span>] === <span class="string">&quot;H&quot;</span>) &#123;</span><br><span class="line">    manUnitedWins++;</span><br><span class="line">    <span class="comment">// 曼联球队为客场赢得比赛的情况</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (match[<span class="number">2</span>] === <span class="string">&quot;Man United&quot;</span> &amp;&amp; match[<span class="number">5</span>] === <span class="string">&quot;A&quot;</span>) &#123;</span><br><span class="line">    manUnitedWins++;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-5-提升程序可阅读性"><a href="#6-5-提升程序可阅读性" class="headerlink" title="6.5 提升程序可阅读性"></a>6.5 提升程序可阅读性</h3><h4 id="6-5-1-问题"><a href="#6-5-1-问题" class="headerlink" title="6.5.1 问题"></a>6.5.1 问题</h4><p>在以上代码中，在判断曼联球队是否赢得比赛时，我们使用了 H 和 A 进行判断，这个代码是我们刚刚写完的，我们完全知道它代表什么含义，H 表示主场球队赢得了比赛，A 表示客场球队赢得了比赛。但是，当另外一个程序员来看这个代码的时候，他并不清楚 H 和 A 分别代表什么，或者在将来的某一个时间点，我们自己再回来看这个代码的时候，也不一定清楚的记得它们的含义。所以从代码的可阅读角度来看，直接使用字符串 H 和 A 进行判断是不明智的，它使代码的阅读变得困难。</p>
<p>或许我们可以声明两个变量来存储H和A，让变量的名字变得有含义，通过变量进行判断来提高程序的可阅读性，像下面这样。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> homeWin = <span class="string">&quot;H&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> awayWin = <span class="string">&quot;A&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (match[<span class="number">1</span>] === <span class="string">&quot;Man United&quot;</span> &amp;&amp; match[<span class="number">5</span>] === homeWin) &#123;</span><br><span class="line">  manUnitedWins++;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (match[<span class="number">2</span>] === <span class="string">&quot;Man United&quot;</span> &amp;&amp; match[<span class="number">5</span>] === awayWin) &#123;</span><br><span class="line">  manUnitedWins++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过以上的更改确实提高了代码的可阅读性但还是存在一个问题，比赛结果除了有H、A、还有 D，就是表示平局的D。在以上代码中由于目前没有用到 D，所以就没写，但是没写并不等于没有，当另外一个程序员来看这个代码的时候，他并不知道还有 D 这个比赛结果，这也是不尽人意的地方。那好，那我们就将 D 写在哪里，像下面这样。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> homeWin = <span class="string">&quot;H&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> awayWin = <span class="string">&quot;A&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> draw = <span class="string">&quot;D&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>虽然将 D 写出来，其他人能够猜出比赛结果可能有三个，但由于 draw 变量没有被使用，这时别人可能认为它是无用的代码，很可能随手就把它删掉了，这也是代码中存在的潜在问题。</p>
<h4 id="6-5-2-枚举"><a href="#6-5-2-枚举" class="headerlink" title="6.5.2  枚举"></a>6.5.2  枚举</h4><p>在 JavaScript 中，以上问题的解决方案是将三种比赛结果放在一个对象中，这样既提高了代码的可阅读性，又完整的表述了比赛的三种结果。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> matchResult = &#123;</span><br><span class="line">  <span class="attr">homeWin</span>: <span class="string">&quot;H&quot;</span>,</span><br><span class="line">  <span class="attr">awayWin</span>: <span class="string">&quot;A&quot;</span>,</span><br><span class="line">  <span class="attr">draw</span>: <span class="string">&quot;D&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (match[<span class="number">1</span>] === <span class="string">&quot;Man United&quot;</span> &amp;&amp; match[<span class="number">5</span>] === matchResult.homeWin) &#123;&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (match[<span class="number">2</span>] === <span class="string">&quot;Man United&quot;</span> &amp;&amp; match[<span class="number">5</span>] === matchResult.awayWin) &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>在 TypeScript 中，可以使用枚举解决上述问题。</p>
<p>枚举用于存储一组密切相关且有限的值，可以提升代码的可读性，可以限定值的范围，比如比赛结果，考试成绩，颜色种类，性别等等。</p>
<p>所以从代码可阅读的角度出发，以上问题的最佳解决方案就是使用枚举， 对象并没有明确的限定值的范围的含义。</p>
<p>枚举在编译后本质上仍然是 JavaScript 对象，但是在源码中它提升了代码的可阅读性。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">enum</span> MatchResult &#123;</span><br><span class="line">  homeWin = <span class="string">&quot;H&quot;</span>,</span><br><span class="line">  awayWin = <span class="string">&quot;A&quot;</span>,</span><br><span class="line">  draw = <span class="string">&quot;D&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (match[<span class="number">1</span>] === <span class="string">&quot;Man United&quot;</span> &amp;&amp; match[<span class="number">5</span>] === MatchResult.homeWin) &#123;&#125; </span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (match[<span class="number">2</span>] === <span class="string">&quot;Man United&quot;</span> &amp;&amp; match[<span class="number">5</span>] === MatchResult.awayWin) &#123;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-6-提升程序可复用性"><a href="#6-6-提升程序可复用性" class="headerlink" title="6.6 提升程序可复用性"></a>6.6 提升程序可复用性</h3><h4 id="6-6-1-概述"><a href="#6-6-1-概述" class="headerlink" title="6.6.1 概述"></a>6.6.1 概述</h4><p>在当前代码中仍然存在的问题是，数据的来源代码是硬编码的，是读取的本地CSV文件，如果将来代码中的数据来源发生变化，比如更改为向服务器发送请求获取足球比赛数据，此时我们应该怎么办呢？删除旧代码重新编写新的数据来源代码？如果真的这样做，对于代码的重用是非常不利的，也许将来我们仍然要读取本地的CSV文件呢，难道要重写再写一遍吗？</p>
<p>解决上述问题的方法是将不同的获取数据来源的代码编写到不同的类中，比如读取本地 CSV 文件的类，向服务端发送请求获取数据的类，使用什么数据源就实例化对应的类就可以了，就算更改数据源也仅仅是删除少量的和实例化相关的代码，所有的核心代码都还在，将来要重新使用该数据源，只需要重新实例化就行了。</p>
<h4 id="6-6-2-创建读取本地CSV文件的类"><a href="#6-6-2-创建读取本地CSV文件的类" class="headerlink" title="6.6.2 创建读取本地CSV文件的类"></a>6.6.2 创建读取本地CSV文件的类</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CsvFileReader.ts</span></span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&quot;fs&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">CsvFileReader</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 用于存储 CSV 文件读取结果</span></span><br><span class="line">  <span class="attr">data</span>: <span class="built_in">string</span>[][] = [];</span><br><span class="line">  <span class="comment">// 接收要读取的 CSV 文件路径</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> filename: <span class="built_in">string</span></span>)</span> &#123;&#125;</span><br><span class="line">  <span class="comment">// 读取 CSV 文件内容并对内容进行转换</span></span><br><span class="line">  read(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.data = fs</span><br><span class="line">      .readFileSync(<span class="built_in">this</span>.filename, &#123; <span class="attr">encoding</span>: <span class="string">&quot;utf-8&quot;</span> &#125;)</span><br><span class="line">      .split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">      .map((row: <span class="built_in">string</span>): <span class="built_in">string</span>[] =&gt; row.split(<span class="string">&quot;,&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; CsvFileReader &#125; <span class="keyword">from</span> <span class="string">&quot;./CSVFileReader&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reader = <span class="keyword">new</span> CsvFileReader(<span class="string">&quot;football.csv&quot;</span>);</span><br><span class="line">reader.read();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> match <span class="keyword">of</span> reader.data) &#123;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-7-需求-gt-行数据类型转换"><a href="#6-7-需求-gt-行数据类型转换" class="headerlink" title="6.7  需求 -&gt; 行数据类型转换"></a>6.7  需求 -&gt; 行数据类型转换</h3><p>在目前的代码中，比赛信息中的每一个字段的类型都是字符串，接下来我们要做的事情就是将比赛信息的每一个字段转换为它应是的类型。</p>
<p>第一步：定义一个辅助方法，用于将日期字符串转换为日期对象。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/utils.ts</span></span><br><span class="line"><span class="comment">// 将日期字符串转换为日期对象</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">dateStringToDate</span>(<span class="params">dateString: <span class="built_in">string</span></span>): <span class="title">Date</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> dateParts = dateString</span><br><span class="line">    .split(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">    .map((value: <span class="built_in">string</span>): <span class="function"><span class="params">number</span> =&gt;</span> <span class="built_in">parseInt</span>(value));</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>(dateParts[<span class="number">2</span>], dateParts[<span class="number">1</span>] - <span class="number">1</span>, dateParts[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第二步：将比赛结果枚举定义在单独的模块文件中，用于复用。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/matchResult.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="built_in">enum</span> MatchResult &#123;</span><br><span class="line">  homeWin = <span class="string">&quot;H&quot;</span>,</span><br><span class="line">  awayWin = <span class="string">&quot;A&quot;</span>,</span><br><span class="line">  draw = <span class="string">&quot;D&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; MatchResult &#125; <span class="keyword">from</span> <span class="string">&quot;./matchResult&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>第三步：通过元组约束比赛信息中的每一个字段的类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MatchData = [<span class="built_in">Date</span>, <span class="built_in">string</span>, <span class="built_in">string</span>, <span class="built_in">number</span>, <span class="built_in">number</span>, MatchResult, <span class="built_in">string</span>];</span><br></pre></td></tr></table></figure>
<p>第四步：将比赛信息中的每一个字段转换为它应有的类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/CsvFileReader.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; MatchResult &#125; <span class="keyword">from</span> <span class="string">&quot;./matchResult&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; dateStringToDate &#125; <span class="keyword">from</span> <span class="string">&quot;./utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">CsvFileReader</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 用于存储 CSV 文件读取结果</span></span><br><span class="line">  <span class="attr">data</span>: MatchData[] = [];</span><br><span class="line">  <span class="comment">// 读取 CSV 文件内容并对内容进行转换</span></span><br><span class="line">  read(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.data = fs</span><br><span class="line">      .readFileSync(<span class="built_in">this</span>.filename, &#123; <span class="attr">encoding</span>: <span class="string">&quot;utf-8&quot;</span> &#125;)</span><br><span class="line">      .split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">      .map((row: <span class="built_in">string</span>): <span class="built_in">string</span>[] =&gt; row.split(<span class="string">&quot;,&quot;</span>))</span><br><span class="line">      .map((row: <span class="built_in">string</span>[]): <span class="function"><span class="params">MatchData</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">          dateStringToDate(row[<span class="number">0</span>]),</span><br><span class="line">          row[<span class="number">1</span>],</span><br><span class="line">          row[<span class="number">2</span>],</span><br><span class="line">          <span class="built_in">parseInt</span>(row[<span class="number">3</span>]),</span><br><span class="line">          <span class="built_in">parseInt</span>(row[<span class="number">4</span>]),</span><br><span class="line">          row[<span class="number">5</span>] <span class="keyword">as</span> MatchResult,</span><br><span class="line">          row[<span class="number">6</span>],</span><br><span class="line">        ];</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过元组限定了类型以后，从二维数组中获取的值，TypeScript 编译器可以自动推断出它的类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// (property) 0: Date</span></span><br><span class="line">reader.data[<span class="number">0</span>][<span class="number">0</span>];</span><br></pre></td></tr></table></figure>
<h3 id="6-8-CsvFileReader-类重构"><a href="#6-8-CsvFileReader-类重构" class="headerlink" title="6.8  CsvFileReader 类重构"></a>6.8  CsvFileReader 类重构</h3><h4 id="6-8-1-概述"><a href="#6-8-1-概述" class="headerlink" title="6.8.1  概述"></a>6.8.1  概述</h4><p>现在我们继续看 CsvFileReader 这个类，它目前存在的问题是不可复用，因为在这个类中 data 属性的数据类型被固定了，这个数据类型是针对 football 这个 CSV 文件的，也就是说 CsvFileReader 类目前只能读取 football.csv 文件，换一个文件程序将会运行失败，因为会产生类型不匹配的问题。所以接下来我们要做的事情就是重构这个类，使它变得可复用，让它可以读取任何 CSV 文件。</p>
<h4 id="6-8-2-①-基于继承的重构"><a href="#6-8-2-①-基于继承的重构" class="headerlink" title="6.8.2 ① 基于继承的重构"></a>6.8.2 ① 基于继承的重构</h4><p>通过逻辑拆分可以使 CsvFileReader 类变得可复用。</p>
<h5 id="1-抽象类"><a href="#1-抽象类" class="headerlink" title="1. 抽象类"></a>1. 抽象类</h5><p>为不同的 CSV 文件创建不同的读取类，在特定类中放置特定逻辑，然后让它继承 CsvFileReader 类，父类调用子类提供了特定逻辑。</p>
<p>将 CsvFileReader 变成抽象类，在抽象类中创建抽象方法 mapRow，其他类在继承该类时必须实现该方法，用于实现各自的数据格式转换的逻辑。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/CsvFileReader.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">CsvFileReader</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 用于存储 CSV 文件读取结果</span></span><br><span class="line">  <span class="attr">data</span>: <span class="built_in">any</span>[] = [];</span><br><span class="line">  <span class="comment">// 接收 CSV 文件名称</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> filename: <span class="built_in">string</span></span>)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">abstract</span> mapRow(row: <span class="built_in">string</span>[]): <span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 读取 CSV 文件内容并对内容进行转换</span></span><br><span class="line">  read(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.data = fs</span><br><span class="line">      .readFileSync(<span class="built_in">this</span>.filename, &#123; <span class="attr">encoding</span>: <span class="string">&quot;utf-8&quot;</span> &#125;)</span><br><span class="line">      .split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">      .map((row: <span class="built_in">string</span>): <span class="built_in">string</span>[] =&gt; row.split(<span class="string">&quot;,&quot;</span>))</span><br><span class="line">      .map(<span class="built_in">this</span>.mapRow);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/MatchReader.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; CsvFileReader &#125; <span class="keyword">from</span> <span class="string">&quot;./CsvFileReader&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; MatchResult &#125; <span class="keyword">from</span> <span class="string">&quot;./matchResult&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; dateStringToDate &#125; <span class="keyword">from</span> <span class="string">&quot;./utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MatchData = [<span class="built_in">Date</span>, <span class="built_in">string</span>, <span class="built_in">string</span>, <span class="built_in">number</span>, <span class="built_in">number</span>, MatchResult, <span class="built_in">string</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">MatchReader</span> <span class="keyword">extends</span> <span class="title">CsvFileReader</span> </span>&#123;</span><br><span class="line">  mapRow(row: <span class="built_in">string</span>[]): MatchData &#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">      dateStringToDate(row[<span class="number">0</span>]),</span><br><span class="line">      row[<span class="number">1</span>],</span><br><span class="line">      row[<span class="number">2</span>],</span><br><span class="line">      <span class="built_in">parseInt</span>(row[<span class="number">3</span>]),</span><br><span class="line">      <span class="built_in">parseInt</span>(row[<span class="number">4</span>]),</span><br><span class="line">      row[<span class="number">5</span>] <span class="keyword">as</span> matchResult,</span><br><span class="line">      row[<span class="number">6</span>],</span><br><span class="line">    ];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-泛型"><a href="#2-泛型" class="headerlink" title="2. 泛型"></a>2. 泛型</h5><p>在以上代码中我们又遇到了一个问题，CsvFileReader 类中的 data 属性的类型以及 mapRow 方法的返回值的类型都无法指定了，因为在定义 CsvFileReader 类时，我们并不知道将来它会读取具有什么数据类型的 Csv 文件。</p>
<p>以上问题可以通过 TypeScript 中的泛型进行解决，那么什么是泛型呢？</p>
<p>泛型是指将类型作为参数进行传递，用于解决代码复用问题。泛型可以应用于函数，可以应用于类。</p>
<p>在定义函数时，函数参数的类型可暂不指定，参数的具体类型可以在调用函数时决定，在调用函数时可以将类型传递进函数以达到类型约束的目的。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HoldString</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> data: <span class="built_in">string</span></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HoldNumber</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> data: <span class="built_in">number</span></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> HoldString(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line"><span class="keyword">new</span> HoldNumber(<span class="number">123</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HoldAnything</span>&lt;<span class="title">TypeOfData</span>&gt; </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> anything: TypeOfData</span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> HoldAnything&lt;<span class="built_in">string</span>&gt;(<span class="string">&quot;string&quot;</span>);</span><br><span class="line"><span class="keyword">new</span> HoldAnything&lt;<span class="built_in">number</span>&gt;(<span class="number">123</span>);</span><br></pre></td></tr></table></figure>
<p>通过泛型解决 CsvFileReader 类中的 data 属性类型的设置问题。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/CsvFileReader.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">CsvFileReader</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// 用于存储 CSV 文件读取结果</span></span><br><span class="line">  <span class="attr">data</span>: T[] = [];</span><br><span class="line">  <span class="keyword">abstract</span> mapRow(row: <span class="built_in">string</span>[]): T;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/MatchReader.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">MatchReader</span> <span class="keyword">extends</span> <span class="title">CsvFileReader</span>&lt;<span class="title">MatchData</span>&gt; </span>&#123;</span><br><span class="line">  mapRow(row: <span class="built_in">string</span>[]): MatchData &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="keyword">const</span> reader = <span class="keyword">new</span> MatchReader(<span class="string">&quot;football.csv&quot;</span>);</span><br><span class="line">reader.read();</span><br><span class="line"><span class="comment">// (property) 0: Date</span></span><br><span class="line"><span class="comment">// reader.data[0][0]</span></span><br></pre></td></tr></table></figure>
<h4 id="6-8-3-②-基于组合的重构"><a href="#6-8-3-②-基于组合的重构" class="headerlink" title="6.8.3 ② 基于组合的重构"></a>6.8.3 ② 基于组合的重构</h4><p>在 CsvFileReader 类中，data 属性负责存储文件读取结果，read 方法负责读取文件。</p>
<p>在 MatchReader 类中，接收 CsvFileReader 实例对象，load 方法负责调用 CsvFileReader 对象中的 read 方法读取文件内容，文件内容读取完成后调用 CsvFileReader 对象中的 data 属性获取读取结果，读取结果获取完成后执行自定义处理逻辑，处理完成后使用 matches 属性存储最终处理结果。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&quot;fs&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">CsvFileReader</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 用于存储 CSV 文件读取结果</span></span><br><span class="line">  <span class="attr">data</span>: <span class="built_in">string</span>[][] = [];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 接收 CSV 文件名称</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> filename: <span class="built_in">string</span></span>)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 读取 CSV 文件内容</span></span><br><span class="line">  read(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.data = fs</span><br><span class="line">      .readFileSync(<span class="built_in">this</span>.filename, &#123; <span class="attr">encoding</span>: <span class="string">&quot;utf-8&quot;</span> &#125;)</span><br><span class="line">      .split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">      .map((row: <span class="built_in">string</span>): <span class="built_in">string</span>[] =&gt; row.split(<span class="string">&quot;,&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; MatchResult &#125; <span class="keyword">from</span> <span class="string">&quot;./matchResult&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; dateStringToDate &#125; <span class="keyword">from</span> <span class="string">&quot;./utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MatchData = [<span class="built_in">Date</span>, <span class="built_in">string</span>, <span class="built_in">string</span>, <span class="built_in">number</span>, <span class="built_in">number</span>, MatchResult, <span class="built_in">string</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> DataReader &#123;</span><br><span class="line">  read(): <span class="built_in">void</span>;</span><br><span class="line">  data: <span class="built_in">string</span>[][];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">MatchReader</span> </span>&#123;</span><br><span class="line">  <span class="attr">matches</span>: MatchData[] = [];</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> reader: DataReader</span>)</span> &#123;&#125;</span><br><span class="line">  <span class="function"><span class="title">load</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.reader.read();</span><br><span class="line">    <span class="built_in">this</span>.matches = <span class="built_in">this</span>.reader.data.map((row: <span class="built_in">string</span>[]): <span class="function"><span class="params">MatchData</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> [</span><br><span class="line">        dateStringToDate(row[<span class="number">0</span>]),</span><br><span class="line">        row[<span class="number">1</span>],</span><br><span class="line">        row[<span class="number">2</span>],</span><br><span class="line">        <span class="built_in">parseInt</span>(row[<span class="number">3</span>]),</span><br><span class="line">        <span class="built_in">parseInt</span>(row[<span class="number">4</span>]),</span><br><span class="line">        row[<span class="number">5</span>] <span class="keyword">as</span> MatchResult,</span><br><span class="line">        row[<span class="number">6</span>],</span><br><span class="line">      ];</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> csvFileReader = <span class="keyword">new</span> CsvFileReader(<span class="string">&quot;football.csv&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> matchReader = <span class="keyword">new</span> MatchReader(csvFileReader);</span><br><span class="line">matchReader.load();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> match <span class="keyword">of</span> matchReader.matches) &#123;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-9-比赛结果的分析与输出"><a href="#6-9-比赛结果的分析与输出" class="headerlink" title="6.9 比赛结果的分析与输出"></a>6.9 比赛结果的分析与输出</h3><h4 id="6-9-1-概述"><a href="#6-9-1-概述" class="headerlink" title="6.9.1 概述"></a>6.9.1 概述</h4><p>在目前的代码中，我们仅仅是分析了曼联球队赢得比赛的次数并在控制台中打印了分析结果。试想一下，如果我们想分析其他球队赢得比赛的次数或者其他球队输得比赛的次数，代码该怎么写？如果我们不想在控制台中输出分析结果，想在 HTML 文件中存储分析结果代码又该怎么写？</p>
<ol>
<li>为使代码更具扩展性、复用性，我们会为不同的分析行为创建不同的类，为不同的输出行为创建不同的类，然后再创建一个用于组合分析行为和输出行为的类。</li>
<li>为使组合类能够正常工作，我们需要创建约束分析行为类的接口规范，创建约束输出行为类的接口规范。</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> summary = <span class="keyword">new</span> Summary(</span><br><span class="line">  <span class="keyword">new</span> WinsAnalysis(<span class="string">&quot;Man United&quot;</span>),</span><br><span class="line">  <span class="keyword">new</span> ConsoleReport()</span><br><span class="line">);</span><br><span class="line">summary.buildAndPrintReport(matchReader.matches);</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> summary = <span class="keyword">new</span> Summary(</span><br><span class="line">  <span class="keyword">new</span> AverageGoalsAnalysis(<span class="string">&quot;Man United&quot;</span>),</span><br><span class="line">  <span class="keyword">new</span> HtmlReport()</span><br><span class="line">);</span><br><span class="line">summary.buildAndPrintReport(matchReader.matches);</span><br></pre></td></tr></table></figure>
<h4 id="6-9-2-创建分析接口和输出接口"><a href="#6-9-2-创建分析接口和输出接口" class="headerlink" title="6.9.2 创建分析接口和输出接口"></a>6.9.2 创建分析接口和输出接口</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Summary.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; MatchData &#125; <span class="keyword">from</span> <span class="string">&quot;./MatchData&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用于约束分析行为的接口</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> Analyzer &#123;</span><br><span class="line">  <span class="comment">// 用于实现分析过程的方法, 接收比赛结果列表作为参数, 返回分析结果</span></span><br><span class="line">  run(matches: MatchData[]): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用于约束输出行为的接口</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> OutputTarget &#123;</span><br><span class="line">  <span class="comment">// 用于实现打印分析结果的方法, 接收分析结果作为参数, 没有返回值</span></span><br><span class="line">  print(report: <span class="built_in">string</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用于组合分析行为和输出行为的类</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Summary</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 接收满足分析行为接口的类实例</span></span><br><span class="line"> 	<span class="comment">// 接收满足输出行为接口的类实例</span></span><br><span class="line">  <span class="comment">// 只有满足接口要求, 在 Summary 类中才能安全统一的的调用相关方法实现功能</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> analyzer: Analyzer, <span class="keyword">public</span> outputTarget: OutputTarget</span>)</span> &#123;&#125;</span><br><span class="line">  <span class="comment">// 分析并打印分析结果</span></span><br><span class="line">  <span class="function"><span class="title">buildAndPrintReport</span>(<span class="params">matches: MatchData[]</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 调用分析类实例中的 run 方法进行分析</span></span><br><span class="line">    <span class="keyword">const</span> output = <span class="built_in">this</span>.analyzer.run(matches);</span><br><span class="line">    <span class="comment">// 打印分析结果</span></span><br><span class="line">    <span class="built_in">this</span>.outputTarget.print(output);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-9-3-创建分析类"><a href="#6-9-3-创建分析类" class="headerlink" title="6.9.3 创建分析类"></a>6.9.3 创建分析类</h4><p>需求：分析球队赢得比赛的次数。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Analyzers/WinsAnalysis.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; MatchData &#125; <span class="keyword">from</span> <span class="string">&quot;../MatchData&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; MatchResult &#125; <span class="keyword">from</span> <span class="string">&quot;../matchResult&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Analyzer &#125; <span class="keyword">from</span> <span class="string">&quot;../Summary&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">WinsAnalysis</span> <span class="title">implements</span> <span class="title">Analyzer</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 接收球队名称</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> team: <span class="built_in">string</span></span>)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  run(matches: MatchData[]): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="comment">// 记录赢得比赛的次数</span></span><br><span class="line">    <span class="keyword">let</span> wins = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 开始分析</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> match <span class="keyword">of</span> matches) &#123;</span><br><span class="line">      <span class="comment">// 记录球队为主场赢得比赛的情况</span></span><br><span class="line">      <span class="keyword">if</span> (match[<span class="number">1</span>] === <span class="built_in">this</span>.team &amp;&amp; match[<span class="number">5</span>] === MatchResult.homeWin) &#123;</span><br><span class="line">        wins++;</span><br><span class="line">        <span class="comment">// 记录球队为客场赢得比赛的情况</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (match[<span class="number">2</span>] === <span class="built_in">this</span>.team &amp;&amp; match[<span class="number">5</span>] === MatchResult.awayWin) &#123;</span><br><span class="line">        wins++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.team&#125;</span> 球队赢得了 <span class="subst">$&#123;wins&#125;</span> 场球赛`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-9-4-创建输出类"><a href="#6-9-4-创建输出类" class="headerlink" title="6.9.4 创建输出类"></a>6.9.4 创建输出类</h4><p>需求：在控制台中打印分析结果。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/ReportTargets/ConsoleReport.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; OutputTarget &#125; <span class="keyword">from</span> <span class="string">&quot;../Summary&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsoleReport</span> <span class="title">implements</span> <span class="title">OutputTarget</span> </span>&#123;</span><br><span class="line">  print(report: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(report);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需求：在 HTMl 文件中输出分析结果。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; OutputTarget &#125; <span class="keyword">from</span> <span class="string">&quot;../Summary&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&quot;fs&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">HtmlReport</span> <span class="title">implements</span> <span class="title">OutputTarget</span> </span>&#123;</span><br><span class="line">  print(report: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> html = <span class="string">`&lt;h1&gt;分析结果&lt;/h1&gt;&lt;div&gt;<span class="subst">$&#123;report&#125;</span>&lt;/div&gt;`</span>;</span><br><span class="line">    fs.writeFileSync(<span class="string">&quot;report.html&quot;</span>, html);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-9-5-简化调用逻辑"><a href="#6-9-5-简化调用逻辑" class="headerlink" title="6.9.5 简化调用逻辑"></a>6.9.5 简化调用逻辑</h4><p>在创建 Summary 类实例时需要同时创建分析行为实例和输出行为实例，该逻辑可以被静态方法进行简化。</p>
<p>静态方法主要是用于存放逻辑性的代码，逻辑上属于类但是和类本身没有关系，也就是说在静态方法中，不会涉及到类中的属性和方法的操作。</p>
<p>调用静态方法不需要对类进行实例化，可以通过类名直接进行调用。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Summary.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Summary</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 用于分析球队赢得比赛的信息并使用HTML的方式输出结果</span></span><br><span class="line">  <span class="keyword">static</span> winsAnalysisWithHtmlReport(team: <span class="built_in">string</span>): Summary &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Summary(<span class="keyword">new</span> WinsAnalysis(team), <span class="keyword">new</span> HtmlReport());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="keyword">const</span> summary = Summary.winsAnalysisWithHtmlReport(<span class="string">&quot;Man United&quot;</span>);</span><br><span class="line">summary.buildAndPrintReport(matchReader.matches);</span><br></pre></td></tr></table></figure>
<p>读取 CSV 文件的逻辑也可以使用相同的方式进行简化。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/MatchReader.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">MatchReader</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> fromCSVFile(filename: <span class="built_in">string</span>): MatchReader &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MatchReader(<span class="keyword">new</span> CsvFileReader(filename));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> matchReader = MatchReader.fromCSVFile(<span class="string">&quot;football.csv&quot;</span>);</span><br><span class="line">matchReader.load();</span><br></pre></td></tr></table></figure>
<h2 id="8-数据驱动视图案例"><a href="#8-数据驱动视图案例" class="headerlink" title="8. 数据驱动视图案例"></a>8. 数据驱动视图案例</h2><h3 id="8-1-概述"><a href="#8-1-概述" class="headerlink" title="8.1 概述"></a>8.1 概述</h3><h4 id="8-1-1-目标"><a href="#8-1-1-目标" class="headerlink" title="8.1.1 目标"></a>8.1.1 目标</h4><p>目标：使用 TypeScript 创建一个小型框架，在框架内部实现数据驱动视图更新的功能。</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/ts/images/08.png" /></p>
<h4 id="8-1-2-创建应用"><a href="#8-1-2-创建应用" class="headerlink" title="8.1.2 创建应用"></a>8.1.2 创建应用</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局安装 parcel 构建工具</span></span><br><span class="line">npm install parcel@2.4.1 -g</span><br><span class="line"><span class="comment"># 创建应用目录并进入</span></span><br><span class="line">mkdir web &amp;&amp; <span class="built_in">cd</span> web</span><br><span class="line"><span class="comment"># 创建应用工程文件</span></span><br><span class="line">npm init -y</span><br><span class="line"><span class="comment"># 创建源码目录并进入</span></span><br><span class="line">mkdir src &amp;&amp; <span class="built_in">cd</span> src</span><br><span class="line"><span class="comment"># 创建应用逻辑入口文件</span></span><br><span class="line">touch index.ts</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 应用逻辑入口文件测试代码</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;Hello&quot;</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 回到应用根目录创建应用视图入口文件</span></span><br><span class="line"><span class="built_in">cd</span> ../ &amp;&amp; touch index.html</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在应用视图入口文件中引入应用逻辑入口文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span> <span class="attr">src</span>=<span class="string">&quot;./src/index.ts&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动开发服务器</span></span><br><span class="line">parcel index.html</span><br></pre></td></tr></table></figure>
<h3 id="8-2-功能完善"><a href="#8-2-功能完善" class="headerlink" title="8.2 功能完善"></a>8.2 功能完善</h3><h4 id="8-2-1-创建模型类-User"><a href="#8-2-1-创建模型类-User" class="headerlink" title="8.2.1 创建模型类 User"></a>8.2.1 创建模型类 User</h4><p>目标：创建 User 模型类，通过私有属性 data 存储用户信息，创建 get 方法用于获取用户信息，创建 UserProps 接口用于定义用户信息规范。</p>
<p>说明：用户信息被设计为私有的原因是我们不希望开发者直接操作用户信息，因为用户信息被修改时程序需要监控到，以实现视图更新逻辑。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/User.ts</span></span><br><span class="line"><span class="keyword">interface</span> UserProps &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  age: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">private</span> data: UserProps</span>)</span> &#123;&#125;</span><br><span class="line">  </span><br><span class="line">  get(propName: <span class="built_in">string</span>): <span class="built_in">string</span> | <span class="built_in">number</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.data[propName];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; User &#125; <span class="keyword">from</span> <span class="string">&quot;./models/User&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">new</span> User(&#123; <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 属性&quot;data&quot;为私有属性, 只能在类&quot;User&quot;中访问。ts(2341)</span></span><br><span class="line"><span class="comment">// console.log(user.data);</span></span><br><span class="line"><span class="built_in">console</span>.log(user.get(<span class="string">&quot;name&quot;</span>));</span><br><span class="line"><span class="built_in">console</span>.log(user.get(<span class="string">&quot;age&quot;</span>));</span><br></pre></td></tr></table></figure>
<h4 id="8-2-2-创建-set-方法更新用户信息"><a href="#8-2-2-创建-set-方法更新用户信息" class="headerlink" title="8.2.2 创建 set 方法更新用户信息"></a>8.2.2 创建 set 方法更新用户信息</h4><p>目标：在 User 类中创建 set 方法，用于更新用户信息。</p>
<p>目前在用户信息中只有 name 属性和 age 属性，所以按照逻辑要求，在更改用户信息时只能更改这两个属性，但是在 JavaScript 中, 通过[对象.属性]的方式可以随意添加属性或修改属性值，如何确保在调用 set 方法时只更改符合要求的用户信息呢? 如何确保用户修改的值符合类型上的要求呢?</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/User.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 通过 UserProps 接口规范可以要求开发者在修改信息时, 只能修改规范中定义的属性, 而且值也必须要符合要求的类型</span></span><br><span class="line">  <span class="function"><span class="title">set</span>(<span class="params">update: UserProps</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// Object.assign(this.data, update);</span></span><br><span class="line">    <span class="built_in">this</span>.data = &#123;...this.data, ...update&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">new</span> User(&#123; <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;);</span><br><span class="line">user.set(&#123; <span class="attr">name</span>: <span class="string">&quot;李四&quot;</span>, <span class="attr">age</span>: <span class="number">30</span> &#125;);</span><br></pre></td></tr></table></figure>
<p>虽然在以上代码中实现了用户信息的修改，但是在更改用户信息时必须同时修改用户的所有信息，因为 update 参数的类型是 UserProps，如果只更改其中的某一个属性，将不满足 UserProps 接口规范。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类型&quot;&#123; name: string; &#125;&quot;的参数不能赋给类型&quot;UserProps&quot;的参数。</span></span><br><span class="line"><span class="comment">// 类型&quot;&#123; name: string; &#125;&quot;中缺少属性&quot;age&quot;, 但类型&quot;UserProps&quot;中需要该属性. ts(2345)</span></span><br><span class="line">user.set(&#123; <span class="attr">name</span>: <span class="string">&quot;李四&quot;</span> &#125;);</span><br></pre></td></tr></table></figure>
<p>可以将 UserProps 接口中的属性更改为可选的，即对象中可以有该属性也可以没有该属性，这样在修改用户信息时就可以实现只修改某些属性了。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> UserProps &#123;</span><br><span class="line">  name?: <span class="built_in">string</span>;</span><br><span class="line">  age?: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而且这样做还有另一个好处，就是在创建用户时可以创建一个没有任何属性的空对象，这是非常有用的。例如在注册用户时，我们要向用户提供表单，让用户填写姓名和年龄。在这个场景下，就可以先创建一个空的用户，然后在用户提交表单时再设置用户信息。</p>
<h4 id="8-2-3-小型事件系统"><a href="#8-2-3-小型事件系统" class="headerlink" title="8.2.3 小型事件系统"></a>8.2.3 小型事件系统</h4><p>目标：创建小型事件系统，包含事件监听器和事件触发器，当用户信息被修改时可以通过事件侦听器通知到应用程序的其他部分。</p>
<p>第一步：创建事件监听器，用于绑定事件。</p>
<p>说明：事件监听器可以有不同的类型，每个类型下可以有多个事件处理程序。</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/ts/images/09.png"/></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/User.ts</span></span><br><span class="line"><span class="comment">// 定义类型, 回调函数的类型</span></span><br><span class="line"><span class="keyword">type</span> Callback = <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 用于保存事件名称和对应的事件处理程序</span></span><br><span class="line">  <span class="attr">events</span>: &#123; [key: <span class="built_in">string</span>]: Callback[] &#125; = &#123;&#125;;</span><br><span class="line">	<span class="comment">// 事件侦听器, 用于绑定事件</span></span><br><span class="line">  on(eventName: <span class="built_in">string</span>, <span class="attr">callback</span>: Callback): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// 通过事件名称获取已有事件监听程序</span></span><br><span class="line">    <span class="comment">// 如果不是第一次绑定事件, 得到的是 Callback 数组, 直接使用</span></span><br><span class="line">    <span class="comment">// 如果是第一次绑定, 得到的是 undefined, 利用逻辑短路思想, 放弃 undefined, 返回空数组</span></span><br><span class="line">    <span class="keyword">const</span> handlers = <span class="built_in">this</span>.events[eventName] || [];</span><br><span class="line">    <span class="comment">// 将此次要绑定的事件处理程序添加到数组中</span></span><br><span class="line">    handlers.push(callback);</span><br><span class="line">    <span class="comment">// 将拥有新结果的数组重新赋值给对应的时间</span></span><br><span class="line">    <span class="built_in">this</span>.events[eventName] = handlers;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line">user.on(<span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span> &#123;&#125;);</span><br><span class="line">user.on(<span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span> &#123;&#125;);</span><br><span class="line">user.on(<span class="string">&quot;change&quot;</span>, <span class="function">() =&gt;</span> &#123;&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(user);</span><br></pre></td></tr></table></figure>
<p>第二步：创建事件触发器，用于触发事件。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/User.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 事件触发器, 用于触发事件</span></span><br><span class="line">  trigger(eventName: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// 获取事件名称对应的事件处理程序</span></span><br><span class="line">    <span class="keyword">const</span> handlers = <span class="built_in">this</span>.events[eventName];</span><br><span class="line">    <span class="comment">// 1) 触发了一个没有绑定的事件</span></span><br><span class="line">    <span class="comment">// 2) 触发的事件曾经绑定过, 但目前已经解绑了</span></span><br><span class="line">    <span class="comment">// 判断是否是以上两种情况, 如果是阻止程序向下运行, 防止报错</span></span><br><span class="line">    <span class="keyword">if</span> (!handlers || handlers.length === <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">// 依次调用该事件对应的事件处理程序</span></span><br><span class="line">    handlers.forEach(<span class="function">(<span class="params">callback</span>) =&gt;</span> callback());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line">user.on(<span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;click #1&quot;</span>));</span><br><span class="line">user.on(<span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;click #2&quot;</span>));</span><br><span class="line">user.on(<span class="string">&quot;change&quot;</span>, <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;change #1&quot;</span>));</span><br><span class="line"></span><br><span class="line">user.trigger(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">user.trigger(<span class="string">&quot;change&quot;</span>);</span><br></pre></td></tr></table></figure>
<h4 id="8-2-4-状态同步"><a href="#8-2-4-状态同步" class="headerlink" title="8.2.4 状态同步"></a>8.2.4 状态同步</h4><p>目标：在模型类中创建 save 方法与 fetch 方法，用于与服务端进行数据交互。</p>
<p>第一步：使用 JSON Server 作为服务端，与客户端进行数据交互。</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/ts/images/10.png" /></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install json-server -g</span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;users&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;age&quot;</span>: <span class="number">20</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install axios</span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="attr">&quot;start:db&quot;</span>: <span class="string">&quot;json-server -w db.json&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;start:parcel&quot;</span>: <span class="string">&quot;parcel index.html&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm run start:db</span><br><span class="line">npm run start:parcel</span><br></pre></td></tr></table></figure>
<p>第二步：创建 fetch 方法用于向服务端发送请求获取数据</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/User.ts</span></span><br><span class="line"><span class="keyword">import</span> axios, &#123; AxiosResponse &#125; <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> UserProps &#123;</span><br><span class="line">  id?: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">fetch</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> axios</span><br><span class="line">      .get(<span class="string">`http://localhost:3000/users/<span class="subst">$&#123;<span class="built_in">this</span>.get(<span class="string">&quot;id&quot;</span>)&#125;</span>`</span>)</span><br><span class="line">      .then(<span class="function">(<span class="params">response: AxiosResponse</span>) =&gt;</span> <span class="built_in">this</span>.set(response.data));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第三步：创建 save 方法，用于创建用户和修改用户。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/User.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">save</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> id = <span class="built_in">this</span>.get(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (id) &#123;</span><br><span class="line">      <span class="comment">// 修改</span></span><br><span class="line">      <span class="keyword">return</span> axios.patch(<span class="string">`http://localhost:3000/users/<span class="subst">$&#123;id&#125;</span>`</span>, <span class="built_in">this</span>.data);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 添加</span></span><br><span class="line">      <span class="keyword">return</span> axios.post(<span class="string">&quot;http://localhost:3000/users&quot;</span>, <span class="built_in">this</span>.data);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="comment">// 创建用户</span></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">new</span> User(&#123; <span class="attr">name</span>: <span class="string">&quot;李四&quot;</span>, <span class="attr">age</span>: <span class="number">30</span> &#125;);</span><br><span class="line">user.save();</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修改用户</span></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">new</span> User(&#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;王五&quot;</span> &#125;);</span><br><span class="line">user.save();</span><br></pre></td></tr></table></figure>
<h3 id="8-3-重构-提取复用代码"><a href="#8-3-重构-提取复用代码" class="headerlink" title="8.3 重构-提取复用代码"></a>8.3 重构-提取复用代码</h3><h4 id="8-3-1-概述"><a href="#8-3-1-概述" class="headerlink" title="8.3.1 概述"></a>8.3.1 概述</h4><p>目前代码中存在的问题是所有功能都写在了 User 类中，包括一些可以在不同模型类中复用的代码。</p>
<p>比如获取设置数据的方法、事件系统、与服务器端同步状态的代码在其他的模型类中也会使用。</p>
<p>而我们要做的事情就是将这些可以复用的代码抽取到不同的类中，然后再通过组合的方式将它们进行重组。</p>
<h4 id="8-3-2-提取事件系统"><a href="#8-3-2-提取事件系统" class="headerlink" title="8.3.2 提取事件系统"></a>8.3.2 提取事件系统</h4><p>目标：将事件系统相关的代码从 User 类中拆分出去。</p>
<p>第一步：创建 Eventing 类，用于放置所有和事件相关的代码。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/Eventing.ts</span></span><br><span class="line"><span class="keyword">type</span> Callback = <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Eventing</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 用于保存事件名称和对应的事件处理程序</span></span><br><span class="line">  <span class="attr">events</span>: &#123; [key: <span class="built_in">string</span>]: Callback[] &#125; = &#123;&#125;;</span><br><span class="line">  <span class="comment">// 事件侦听器, 用于绑定事件</span></span><br><span class="line">  on(eventName: <span class="built_in">string</span>, <span class="attr">callback</span>: Callback): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// 通过事件名称获取已有事件监听程序</span></span><br><span class="line">    <span class="comment">// 如果不是第一次绑定事件, 得到的是 Callback 数组, 直接使用</span></span><br><span class="line">    <span class="comment">// 如果是第一次绑定, 得到的是 undefined, 利用逻辑短路思想, 放弃 undefined, 返回空数组</span></span><br><span class="line">    <span class="keyword">const</span> handlers = <span class="built_in">this</span>.events[eventName] || [];</span><br><span class="line">    <span class="comment">// 将此次要绑定的事件处理程序添加到数组中</span></span><br><span class="line">    handlers.push(callback);</span><br><span class="line">    <span class="comment">// 将拥有新结果的数组重新赋值给对应的时间</span></span><br><span class="line">    <span class="built_in">this</span>.events[eventName] = handlers;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 事件触发器, 用于触发事件</span></span><br><span class="line">  trigger(eventName: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// 获取事件名称对应的事件处理程序</span></span><br><span class="line">    <span class="keyword">const</span> handlers = <span class="built_in">this</span>.events[eventName];</span><br><span class="line">    <span class="comment">// 1) 触发了一个没有绑定的事件</span></span><br><span class="line">    <span class="comment">// 2) 触发的事件曾经绑定过, 但目前已经解绑了</span></span><br><span class="line">    <span class="comment">// 判断是否是以上两种情况, 如果是阻止程序向下运行, 防止报错</span></span><br><span class="line">    <span class="keyword">if</span> (!handlers || handlers.length === <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">// 依次调用该事件对应的事件处理程序</span></span><br><span class="line">    handlers.forEach(<span class="function">(<span class="params">callback</span>) =&gt;</span> callback());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第二步：为 User 模型类添加事件系统。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/User.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Eventing &#125; <span class="keyword">from</span> <span class="string">&quot;./Eventing&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 为当前模型类中添加事件系统</span></span><br><span class="line">  <span class="keyword">public</span> events: Eventing = <span class="keyword">new</span> Eventing();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="8-3-3-提取状态同步"><a href="#8-3-3-提取状态同步" class="headerlink" title="8.3.3 提取状态同步"></a>8.3.3 提取状态同步</h4><p>第一步：创建 Sync 类，用于放置和状态同步相关的代码。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/Sync.ts</span></span><br><span class="line"><span class="keyword">import</span> axios, &#123; AxiosPromise &#125; <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; UserProps &#125; <span class="keyword">from</span> <span class="string">&quot;./User&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Sync</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> rootUrl: <span class="built_in">string</span></span>)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  fetch(id: <span class="built_in">number</span>): AxiosPromise &#123;</span><br><span class="line">    <span class="keyword">return</span> axios.get(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.rootUrl&#125;</span>/<span class="subst">$&#123;id&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  save(data: UserProps): AxiosPromise &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; id &#125; = data;</span><br><span class="line">    <span class="keyword">if</span> (id) &#123;</span><br><span class="line">      <span class="comment">// 修改</span></span><br><span class="line">      <span class="keyword">return</span> axios.patch(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.rootUrl&#125;</span>/<span class="subst">$&#123;id&#125;</span>`</span>, data);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 添加</span></span><br><span class="line">      <span class="keyword">return</span> axios.post(<span class="built_in">this</span>.rootUrl, data);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第二步：通过泛型将要同步的数据的类型传递到 Sync 类中，使用泛型约束 save 方法的参数，使 Sync 类可重用。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/Sync.ts</span></span><br><span class="line"><span class="keyword">interface</span> HasId &#123;</span><br><span class="line">  id?: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Sync</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">HasId</span>&gt; </span>&#123;</span><br><span class="line">  save(data: T): AxiosPromise &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; id &#125; = data;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意：在以上代码中，泛型 T 对应的实际类型中要有一个可选属性 id，在 save 方法中从 data 中解构 id 时，由于 id 可能有也可能没有，所以它的类型应该是 number | undefined，但实际上 TypeScript 编译器推断出的 id 的类型就是 number，这是为什么呢？</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// const id: number</span></span><br><span class="line"><span class="keyword">const</span> &#123; id &#125; = data;</span><br></pre></td></tr></table></figure>
<p>这是因为在应用中目前没有开启 TypeScript 类型的严格检查模式，通过 tsconfig.json 中的 strict: true 可开启。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;strict&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// const id: number | undefined</span></span><br><span class="line"><span class="keyword">const</span> &#123; id &#125; = data;</span><br></pre></td></tr></table></figure>
<p>所以通过 if 判断 id 是否为真是不严谨的，如果 id 为 0 的话，代码便会走到 else，就走向了错误的逻辑。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (id) &#123;&#125; <span class="keyword">else</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>严谨的判断应该是检测 id 是否不为 undefined 类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> id != <span class="string">&quot;undefined&quot;</span>) &#123;&#125; <span class="keyword">else</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>第三步：为 User 类添加同步状态功能。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/User.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Sync &#125; <span class="keyword">from</span> <span class="string">&quot;./Sync&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 基准请求地址</span></span><br><span class="line"><span class="keyword">const</span> rootUrl = <span class="string">&quot;http://localhost:3000/users&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 为当前模型类中添加同步状态功能</span></span><br><span class="line">  <span class="keyword">public</span> sync: Sync&lt;UserProps&gt; = <span class="keyword">new</span> Sync&lt;UserProps&gt;(rootUrl);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="8-3-4-提取对象属性"><a href="#8-3-4-提取对象属性" class="headerlink" title="8.3.4 提取对象属性"></a>8.3.4 提取对象属性</h4><p>目标：提取 User 类中的 data 属性、get、set 方法，使用这部分代码在任何其他模型类中可以被复用。</p>
<p>第一步：创建 Attributes 类，用于存储 data 属性、get、set 方法。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/Attributes.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Attributes</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">private</span> data: T</span>)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  get(propName: <span class="built_in">string</span>): <span class="built_in">string</span> | <span class="built_in">number</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.data[propName];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">set</span>(<span class="params">update: T</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">Object</span>.assign(<span class="built_in">this</span>.data, update);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第二步：优化 get 方法参数的类型。</p>
<p>在以上代码中存在的问题是 get 方法的参数的取值范围并没有被限制，就是说在调用 get 方法时可以传递任何参数，但实际上应该是 data 对象中存在什么属性 get 方法中才允许被传递什么参数。比如在 user 对象中，它只有三个属性，id、name、age，那么当 user 对象调用 get 方法时它就应该只允许传递这三个参数。</p>
<p>要解决以上问题，我们需要先学习两个前置知识点。</p>
<p>① 在 TypeScript 中，字面量也可以作为类型使用。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义类型 BestName</span></span><br><span class="line"><span class="keyword">type</span> BestName = <span class="string">&quot;张三&quot;</span> | <span class="string">&quot;李四&quot;</span>;</span><br><span class="line"><span class="comment">// 参数 name 的类型为字面量的类型, 参数 name 的取值范围为字面量的值</span></span><br><span class="line"><span class="comment">// 即参数 name 的类型为字符串, 参数 name 的取值范围为张三和李四</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printName</span>(<span class="params">name: BestName</span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">printName(<span class="string">&quot;李四&quot;</span>);</span><br><span class="line">printName(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line"><span class="comment">// 类型&quot;王五&quot;的参数不能赋给类型&quot;BestName&quot;的参数</span></span><br><span class="line">printName(<span class="string">&quot;王五&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>② 在 JavaScript 中，所有对象的键都是字符串类型，TypeScript 中也是一样。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> colors = &#123;&#125;;</span><br><span class="line">colors[<span class="number">0</span>] = <span class="string">&quot;red&quot;</span>;</span><br><span class="line">colors[<span class="number">0</span>] <span class="comment">// &quot;red&quot;</span></span><br><span class="line"><span class="comment">// 在这段代码中，虽然看起来我们使用了数值作为了对象的键, 但仅仅是看起来是这样</span></span><br><span class="line"><span class="comment">// 当我们使用数值键取值时, 内部会将数值转换为字符串再进行取值</span></span><br><span class="line"><span class="comment">// 所以以下代码也是可以取到值的</span></span><br><span class="line">colors[<span class="string">&quot;0&quot;</span>] <span class="comment">// &quot;red&quot;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> color = &#123;&#125;;</span><br><span class="line">color[<span class="number">0</span>] = <span class="string">&quot;a&quot;</span>;</span><br><span class="line">color[&#123;&#125;] = <span class="string">&quot;b&quot;</span>;</span><br><span class="line"><span class="comment">// Colors &#123; &#x27;0&#x27;: &#x27;a&#x27;, &#x27;[object Object]&#x27;: &#x27;b&#x27; &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(color);</span><br></pre></td></tr></table></figure>
<p><strong>在 TypeScript 中字符串字面量可以作为类型使用，对象的键又都是字符串类型，由此我们能够想到对象的键也可以作为类型使用。</strong></p>
<p>对于 user 对象来说，它的 get 方法的取值范围为 id、name、age，也就是说我们可以通过以下方式限制 user 对象的 get 方法的参数类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">get</span>(<span class="params">key: <span class="string">&quot;id&quot;</span> | <span class="string">&quot;name&quot;</span> | <span class="string">&quot;age&quot;</span></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.data[key];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/ts/images/11.png" /></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以下为测试代码</span></span><br><span class="line"><span class="comment">// src/models/Attributes.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; UserProps &#125; <span class="keyword">from</span> <span class="string">&quot;./User&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userAttributes = <span class="keyword">new</span> Attributes&lt;UserProps&gt;(&#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;);</span><br><span class="line"><span class="comment">// 类型 &quot;sex&quot; 的参数不能赋给类型 &quot;id&quot; | &quot;name&quot; | &quot;age&quot; 的参数</span></span><br><span class="line">userAttributes.get(<span class="string">&quot;sex&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>虽然以上代码解决了 get 方法的参数类型问题，但是代码如果这样写的话就不能复用了，因为不同的数据拥有的属性是不一样的。</p>
<p>在 TypeScript 中通过 keyof 运算符可以得到类型属性字面量联合类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> UserProps &#123;</span><br><span class="line">  id?: <span class="built_in">number</span>;</span><br><span class="line">  name?: <span class="built_in">string</span>;</span><br><span class="line">  age?: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// &quot;id&quot; | &quot;name&quot; | &quot;age&quot;</span></span><br><span class="line"><span class="keyword">type</span> UserPropsKeys = keyof UserProps;</span><br></pre></td></tr></table></figure>
<p>所以最终 get 方法参数的类型可以通过以下方式进行限制。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Attributes</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">private</span> data: T</span>)</span> &#123;&#125;</span><br><span class="line">	<span class="comment">// 使用 keyof 运算符获取 T 类型中的属性名称字符串联合类型</span></span><br><span class="line">  <span class="comment">// 通过泛型及泛型约束限制 key 参数的类型及取值范围</span></span><br><span class="line">  <span class="comment">// 泛型 K 的类型被 keyof 运算符得到的类型进行约束</span></span><br><span class="line">  <span class="comment">// 虽然此处 K 为泛型, 但是在调用 get 方法时可以不传递具体类型, TypeScript 编译器可以自己推断</span></span><br><span class="line">  get&lt;K <span class="keyword">extends</span> keyof T&gt;(key: K) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.data[key];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/ts/images/11.png" /></p>
<p>第三步：优化 get 方法的返回值类型。</p>
<p>通过 get 方法获取到属性值后，属性值是什么类型 get 方法的返回值就应该是什么类型。</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/ts/images/12.png"/></p>
<p>但是在以上代码中 get 方法的返回值被写死了，被写成了联合类型 string | number，这是不对的。</p>
<p><strong>特别注意: 在演示测试代码时, 先临时删除 get 方法的参数的类型。</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/Attributes.ts</span></span><br><span class="line"><span class="comment">// 以下为测试代码</span></span><br><span class="line"><span class="keyword">import</span> &#123; UserProps &#125; <span class="keyword">from</span> <span class="string">&quot;./User&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userAttributes = <span class="keyword">new</span> Attributes&lt;UserProps&gt;(&#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// const id: string | number</span></span><br><span class="line"><span class="keyword">const</span> id = userAttributes.get(<span class="string">&quot;id&quot;</span>);</span><br><span class="line"><span class="comment">// const name: string | number</span></span><br><span class="line"><span class="keyword">const</span> name = userAttributes.get(<span class="string">&quot;name&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>而我们期望返回值类型是唯一的，这样在使用时编辑器就可以提示确切的提示出该类型下面有哪些属性和方法了。</p>
<p>解决方法一就是在使用返回值前先使用类型守卫对其进行验证。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> name === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">  <span class="comment">// const name: string</span></span><br><span class="line">  name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解决办法二是使用类型断言，告诉 TypeScript 编译器它的确切类型是什么。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// const id: number</span></span><br><span class="line"><span class="keyword">const</span> id = userAttributes.get(<span class="string">&quot;id&quot;</span>) <span class="keyword">as</span> <span class="built_in">number</span>;</span><br></pre></td></tr></table></figure>
<p>解决办法三是根据类型的属性获取属性值的类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以下为测试代码</span></span><br><span class="line"><span class="comment">// type nameType = string;</span></span><br><span class="line"><span class="keyword">type</span> nameType = UserProps[<span class="string">&quot;name&quot;</span>];</span><br><span class="line"><span class="comment">// type ageType = number</span></span><br><span class="line"><span class="keyword">type</span> ageType = UserProps[<span class="string">&quot;age&quot;</span>];</span><br></pre></td></tr></table></figure>
<p>所以最终 get 方法的返回值类型可以通过以下方式进行设置。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/Attributes.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Attributes</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">private</span> data: T</span>)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  get&lt;K <span class="keyword">extends</span> keyof T&gt;(key: K): T[K] &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.data[key];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/Attributes.ts</span></span><br><span class="line"><span class="comment">// 以下为测试代码</span></span><br><span class="line"><span class="keyword">const</span> userAttributes = <span class="keyword">new</span> Attributes&lt;UserProps&gt;(&#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;);</span><br><span class="line"><span class="comment">// const name: string</span></span><br><span class="line"><span class="keyword">const</span> name = userAttributes.get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line"><span class="comment">// const age: number</span></span><br><span class="line"><span class="keyword">const</span> age = userAttributes.get(<span class="string">&quot;age&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>第四步：在 User 模型类中添加模型数据。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/User.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Attributes &#125; <span class="keyword">from</span> <span class="string">&quot;./Attributes&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 为当前模型类添加模型</span></span><br><span class="line">  <span class="keyword">public</span> attributes: Attributes&lt;UserProps&gt;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">user: UserProps</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.attributes = <span class="keyword">new</span> Attributes&lt;UserProps&gt;(user);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="8-3-5-减少调用属性层级"><a href="#8-3-5-减少调用属性层级" class="headerlink" title="8.3.5 减少调用属性层级"></a>8.3.5 减少调用属性层级</h4><p>经过以上优化以后，解决了内部代码复用的问题，但是新的问题也产生了，就是在调用数据模型类内部的方法时代码变得冗长。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = <span class="keyword">new</span> User(&#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;王五&quot;</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上一轮优化后</span></span><br><span class="line">user.attributes.get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">user.sync.fetch(<span class="number">1</span>);</span><br><span class="line">user.events.trigger(<span class="string">&quot;click&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上一轮优化前</span></span><br><span class="line">user.get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">user.fetch();</span><br><span class="line">user.trigger(<span class="string">&quot;click&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>目标：通过类中的 getter 属性实现调用时属性层级的缩减。</p>
<p>先来看一段我们能够想到的最直接的缩减调用属性层级的办法。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/User.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">on</span>(<span class="params">eventName: <span class="built_in">string</span>, callback: Callback</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.events.on(eventName, callback);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user.on(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;&#125;);</span><br></pre></td></tr></table></figure>
<p>以上代码中虽然可以缩减调用属性的层级，但是代码过于啰嗦。</p>
<p>可以利用类的 getter 属性优化以上代码。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/User.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="keyword">get</span> <span class="title">on</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.events.on;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">get</span> <span class="title">trigger</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.events.trigger;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">get</span> <span class="title">get</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.attributes.get;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user.on(<span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;clicked&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>但是在以上代码中还隐藏着一个错误，尝试运行以下代码。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user.get(<span class="string">&quot;name&quot;</span>);</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/ts/images/13.png" /></p>
<p>产生以上错误的原因在于代码运行时 Attributes 类中 get 方法中的 this 指向出现了问题，它本应该指向 Attributes 类实例，现在指向了 User 类实例。User 类中没有 data 属性，访问 data 属性时返回 undefined，再通过 undefined 访问 name，自然就报错了。</p>
<p>解决以上问题的办法是将 Attributes 类中的 get 方法更改为箭头函数，因为箭头函数不绑定 this，所以外部无论怎样调用都不会更改 this 指向。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/Attributes.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Attributes</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  get = <span class="xml"><span class="tag">&lt;<span class="name">K</span> <span class="attr">extends</span> <span class="attr">keyof</span> <span class="attr">T</span>&gt;</span>(key: K): T[K] =&gt; &#123;</span></span><br><span class="line"><span class="xml">    return this.data[key];</span></span><br><span class="line"><span class="xml">  &#125;;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/Eventing.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Eventing</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 事件侦听器, 用于绑定事件</span></span><br><span class="line">  on = (eventName: <span class="built_in">string</span>, <span class="attr">callback</span>: Callback): <span class="function"><span class="params">void</span> =&gt;</span> &#123; &#125;;</span><br><span class="line">  <span class="comment">// 事件触发器, 用于触发事件</span></span><br><span class="line">  trigger = (eventName: <span class="built_in">string</span>): <span class="function"><span class="params">void</span> =&gt;</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="comment">// 以下为测试代码</span></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">new</span> User(&#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;王五&quot;</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(user.get(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">user.on(<span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;clicked&quot;</span>));</span><br><span class="line">user.trigger(<span class="string">&quot;click&quot;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="8-4-功能完善"><a href="#8-4-功能完善" class="headerlink" title="8.4 功能完善"></a>8.4 功能完善</h3><h4 id="8-4-1-添加-set-方法-User"><a href="#8-4-1-添加-set-方法-User" class="headerlink" title="8.4.1 添加 set 方法 (User)"></a>8.4.1 添加 set 方法 (User)</h4><p>目标：在 User 模型类中添加 set 方法，目的一的减少属性调用层级，目的二是在更改数据时要自动触发 change 事件。</p>
<p>自动触发 change 事件的原因是将来当数据发生更改时应用程序的其他部分要随之更新。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/User.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">set</span>(<span class="params">update: UserProps</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.attributes.set(update);</span><br><span class="line">    <span class="built_in">this</span>.events.trigger(<span class="string">&quot;change&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="comment">// 以下为测试代码</span></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">new</span> User(&#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;王五&quot;</span> &#125;);</span><br><span class="line">user.on(<span class="string">&quot;change&quot;</span>, <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;changed&quot;</span>));</span><br><span class="line">user.set(&#123; <span class="attr">name</span>: <span class="string">&quot;李四&quot;</span> &#125;);</span><br></pre></td></tr></table></figure>
<h4 id="8-4-2-添加-fetch-方法-User"><a href="#8-4-2-添加-fetch-方法-User" class="headerlink" title="8.4.2  添加 fetch 方法 (User)"></a>8.4.2  添加 fetch 方法 (User)</h4><p>目标：在 User 类中添加 fetch 方法用于与服务端通讯，根据 id 获取数据、数据获取完成后更新本地数据。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  fetch(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// 获取数据id</span></span><br><span class="line">    <span class="keyword">const</span> id = <span class="built_in">this</span>.get(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">    <span class="comment">// 如果没有id或者类型错误</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> id !== <span class="string">&quot;number&quot;</span>) &#123;</span><br><span class="line">      <span class="comment">// 报错: 输出错误信息</span></span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;没有id不能获取数据&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 根据id发送请求获取数据</span></span><br><span class="line">    <span class="built_in">this</span>.sync.fetch(id).then((response: AxiosResponse): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 更新本地数据</span></span><br><span class="line">      <span class="built_in">this</span>.set(response.data);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建用户实例</span></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">new</span> User(&#123; <span class="attr">id</span>: <span class="number">1</span> &#125;);</span><br><span class="line"><span class="comment">// 监听用户数据发生变化</span></span><br><span class="line">user.on(<span class="string">&quot;change&quot;</span>, <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(user));</span><br><span class="line"><span class="comment">// 根据 id 获取用户数据</span></span><br><span class="line">user.fetch();</span><br></pre></td></tr></table></figure>
<h4 id="8-4-3-添加-save-方法-User"><a href="#8-4-3-添加-save-方法-User" class="headerlink" title="8.4.3 添加 save 方法 (User)"></a>8.4.3 添加 save 方法 (User)</h4><p>目标：在 User 类中添加 save 方法，用于与服务端通讯，添加用户、修改用户，成功后触发 save 事件，失败后触发 error 事件。</p>
<p>由于在执行创建和修改操作时，需要将模型实例整体传入到 Sync 类的 save 方法中，所以在 Model 中添要加一个用于获取实例的方法。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/Attributes.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Attributes</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  getAll(): T &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.data;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 User 中添加 save 方法供实例使用。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/User.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  save(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.sync</span><br><span class="line">      .save(<span class="built_in">this</span>.attributes.getAll())</span><br><span class="line">      .then(<span class="function">() =&gt;</span> <span class="built_in">this</span>.trigger(<span class="string">&quot;save&quot;</span>))</span><br><span class="line">      .catch(<span class="function">() =&gt;</span> <span class="built_in">this</span>.trigger(<span class="string">&quot;error&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="comment">// 以下为测试代码</span></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">new</span> User(&#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;赵六&quot;</span> &#125;);</span><br><span class="line">user.on(<span class="string">&quot;save&quot;</span>, <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(user));</span><br><span class="line">user.save();</span><br></pre></td></tr></table></figure>
<h3 id="8-5-重构-提取复用代码"><a href="#8-5-重构-提取复用代码" class="headerlink" title="8.5 重构-提取复用代码"></a>8.5 重构-提取复用代码</h3><h4 id="8-5-1-提取模型类公用逻辑"><a href="#8-5-1-提取模型类公用逻辑" class="headerlink" title="8.5.1 提取模型类公用逻辑"></a>8.5.1 提取模型类公用逻辑</h4><p>目前在表示用户的 User 模型类中，所有的属性和方法都可以被看做是数据模型类之间的可以复用的代码，比如表示文章的 Post 模型类，表示订单的 Order 模型类，都会有 get、set、fetch、save、on、trigger 等方法，而我们肯定不想在每个数据模型类中都将这些方法实现一遍。</p>
<p>所以接下来我们要做的事情就是创建一个 Model 类，用于存放数据模型类中可以复用的属性和方法，其他数据模型类通过继承的方式获取他们。</p>
<p><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/ts/images/46.png" /></p>
<p>第一步：创建 Model 类，让 User 数据模型类继承 Model 类，从而获取数据模型类中的可以复用的属性和方法。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/Model.ts</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Model</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/User.ts</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>第二步：将 User 类中的通用模型类方法拷贝到 Model 模型类中。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; AxiosPromise, AxiosResponse &#125; <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> HasId &#123;</span><br><span class="line">  id?: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Model</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">HasId</span>&gt; </span>&#123;  </span><br><span class="line">  <span class="keyword">public</span> events: Eventing = <span class="keyword">new</span> Eventing();</span><br><span class="line">  <span class="keyword">public</span> attributes: Attributes&lt;T&gt;;</span><br><span class="line">  <span class="keyword">public</span> sync: Sync&lt;T&gt; = <span class="keyword">new</span> Sync&lt;T&gt;(rootUrl);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">get</span> <span class="title">on</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.events.on;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> <span class="title">trigger</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.events.trigger;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> <span class="title">get</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.attributes.get;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">set</span>(<span class="params">update: T</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.attributes.set(update);</span><br><span class="line">    <span class="built_in">this</span>.events.trigger(<span class="string">&quot;change&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  fetch(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// 获取数据id</span></span><br><span class="line">    <span class="keyword">const</span> id = <span class="built_in">this</span>.get(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">    <span class="comment">// 如果没有id或者类型错误</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> id !== <span class="string">&quot;number&quot;</span>) &#123;</span><br><span class="line">      <span class="comment">// 报错: 输出错误信息</span></span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;没有id不能获取数据&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 根据id发送请求获取数据</span></span><br><span class="line">    <span class="built_in">this</span>.sync.fetch(id).then((response: AxiosResponse): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 更新本地数据</span></span><br><span class="line">      <span class="built_in">this</span>.set(response.data);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  save(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.sync</span><br><span class="line">      .save(<span class="built_in">this</span>.attributes.getAll())</span><br><span class="line">      .then(<span class="function">() =&gt;</span> <span class="built_in">this</span>.trigger(<span class="string">&quot;save&quot;</span>))</span><br><span class="line">      .catch(<span class="function">() =&gt;</span> <span class="built_in">this</span>.trigger(<span class="string">&quot;error&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第三步：通过参数的方式接收类实例，而不是直接在 Model 类中创建实例。</p>
<p>在以上代码中仍然存在的问题是在 Model 类中直接实例化了 Eventing、Attributes、Sync 等类，这样做并不好，以 Sync 举例，目前代码中 Sync 类用于与服务端交互，获取和保存模型数据，但如果将来数据源发生变化，比如变成了和本地存储进行交互，那么此处的代码就不太合适了，所以在 Model 类中，应该通过参数的方式接收这几个类的实例，至于接收的是 ApiSync 还是 LocalSync 就交给数据模型类，它根据需求决定。</p>
<p>既然现在要通过参数的方式接收类的实例，那么参数就需要被接口进行约束，约束在类中必须实现的属性和方法，这样才能确保拷贝到 Model 类中的其他属性和方法是可用的。所以接下来我们要先创建接口，约束 attributes、sync、events  参数的类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> ModelAttributes&lt;T&gt; &#123;</span><br><span class="line">  get&lt;K <span class="keyword">extends</span> keyof T&gt;(key: K): T[K];</span><br><span class="line">  set(value: T): <span class="built_in">void</span>;</span><br><span class="line">  getAll(): T;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Sync&lt;T&gt; &#123;</span><br><span class="line">  fetch(id: <span class="built_in">number</span>): AxiosPromise;</span><br><span class="line">  save(data: T): AxiosPromise;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Events &#123;</span><br><span class="line">  on(eventName: <span class="built_in">string</span>, <span class="attr">callback</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span>): <span class="built_in">void</span>;</span><br><span class="line">  trigger(eventName: <span class="built_in">string</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Model</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">HasId</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// 为什么 attributes、sync、events 属性是私有的呢?</span></span><br><span class="line">  <span class="comment">// 我们不想让开发者在类的外部直接操作这些属性，</span></span><br><span class="line">  <span class="comment">// 开发者没有必要在类的外部直接调用并操作这些属性, 他只可以调用类中的公共方法</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">private</span> attributes: ModelAttributes&lt;T&gt;,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">private</span> sync: Sync&lt;T&gt;,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">private</span> events: Events</span></span></span><br><span class="line"><span class="params"><span class="function">  </span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第四步：在 User 类中创建静态方法 buildUser，用于创建 User 类的实例。</p>
<p>由于 User 类继承了 Model 类，在实例化 User 类时需要传递 Model 类需要的参数，Model 类需要传递 attributes、sync、events 属性。</p>
<p>在创建 User 类的实例时，我只想关心 User 类中可以设置哪些属性，也就是 attributes 参数。如果每次创建用户还需要传递其他参数比如 sync、events，这对于创建用户来说就太麻烦了，所以接下来我们要做的事情就是在 User 类中创建 BuildUser 方法，通过该方法对创建用户的逻辑进行进一步的封装。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/User.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Attributes &#125; <span class="keyword">from</span> <span class="string">&quot;./Attributes&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Eventing &#125; <span class="keyword">from</span> <span class="string">&quot;./Eventing&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Model &#125; <span class="keyword">from</span> <span class="string">&quot;./Model&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ApiSync &#125; <span class="keyword">from</span> <span class="string">&quot;./ApiSync&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> UserProps &#123;</span><br><span class="line">  id?: <span class="built_in">number</span>;</span><br><span class="line">  name?: <span class="built_in">string</span>;</span><br><span class="line">  age?: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootUrl = <span class="string">&quot;http://localhost:3000/users&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span>&lt;<span class="title">UserProps</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> buildUser(attrs: UserProps): User &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> User(</span><br><span class="line">      <span class="keyword">new</span> Attributes&lt;UserProps&gt;(attrs),</span><br><span class="line">      <span class="keyword">new</span> ApiSync&lt;UserProps&gt;(rootUrl),</span><br><span class="line">      <span class="keyword">new</span> Eventing()</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以下为测试代码</span></span><br><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; User &#125; <span class="keyword">from</span> <span class="string">&quot;./models/User&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = User.buildUser(&#123; <span class="attr">id</span>: <span class="number">1</span> &#125;);</span><br><span class="line"></span><br><span class="line">user.on(<span class="string">&quot;change&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(user);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">user.fetch();</span><br></pre></td></tr></table></figure>
<h4 id="8-5-2-进一步减少调用属性层级"><a href="#8-5-2-进一步减少调用属性层级" class="headerlink" title="8.5.2 进一步减少调用属性层级"></a>8.5.2 进一步减少调用属性层级</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/Model.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Model</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">HasId</span>&gt; </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">private</span> attributes: ModelAttributes&lt;T&gt;,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">private</span> sync: Sync&lt;T&gt;,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">private</span> events: Events</span></span></span><br><span class="line"><span class="params"><span class="function">  </span>)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  on = <span class="built_in">this</span>.events.on;</span><br><span class="line">  trigger = <span class="built_in">this</span>.events.trigger;</span><br><span class="line">  get = <span class="built_in">this</span>.attributes.get;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Model</span>(<span class="params">attributes</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.attributes = attributes;</span><br><span class="line">  <span class="built_in">this</span>.get = <span class="built_in">this</span>.attributes.get;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>特别注意：以下属于错误写法。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Model</span> </span>&#123;</span><br><span class="line">  attributes;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">attributes</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.attributes = attributes;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// error: 属性&quot;attributes&quot;在其初始化前已被使用。</span></span><br><span class="line">  get = <span class="built_in">this</span>.attributes.get;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Model</span>(<span class="params">attributes</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.get = <span class="built_in">this</span>.attributes.get;</span><br><span class="line">  <span class="built_in">this</span>.attributes = attributes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-6-完善功能"><a href="#8-6-完善功能" class="headerlink" title="8.6 完善功能"></a>8.6 完善功能</h3><h4 id="8-6-1-创建用户集合"><a href="#8-6-1-创建用户集合" class="headerlink" title="8.6.1   创建用户集合"></a>8.6.1   创建用户集合</h4><p>目标：创建用户集合类，用于保存用户列表数据。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/Collection.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; User, UserProps &#125; <span class="keyword">from</span> <span class="string">&quot;./User&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Eventing &#125; <span class="keyword">from</span> <span class="string">&quot;./Eventing&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> axios, &#123; AxiosResponse &#125; <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Collection</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 用于存储集合的属性</span></span><br><span class="line">  <span class="attr">models</span>: User[] = [];</span><br><span class="line">  <span class="comment">// 组装事件系统</span></span><br><span class="line">  events: Eventing = <span class="keyword">new</span> Eventing();</span><br><span class="line">  <span class="comment">// 缩短方法调用</span></span><br><span class="line">  on = <span class="built_in">this</span>.events.on;</span><br><span class="line">  trigger = <span class="built_in">this</span>.events.trigger;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 接收请求地址</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> rootUrl: <span class="built_in">string</span></span>)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 用于发送请求获取集合数据</span></span><br><span class="line">  <span class="function"><span class="title">fetch</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    axios.get(<span class="built_in">this</span>.rootUrl).then(<span class="function">(<span class="params">response: AxiosResponse&lt;UserProps[]&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 遍历集合</span></span><br><span class="line">      response.data.forEach(<span class="function">(<span class="params">value: UserProps</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 将网络数据转换成 User 类实例</span></span><br><span class="line">        <span class="keyword">const</span> user = User.buildUser(value);</span><br><span class="line">        <span class="comment">// 使用 models 数组存储 User 类实例</span></span><br><span class="line">        <span class="built_in">this</span>.models.push(user);</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">// 数据获取完成后触发 change 事件</span></span><br><span class="line">      <span class="built_in">this</span>.trigger(<span class="string">&quot;change&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以下为测试代码</span></span><br><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Collection &#125; <span class="keyword">from</span> <span class="string">&quot;./models/Collection&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userCollection = <span class="keyword">new</span> Collection(<span class="string">&quot;http://localhost:3000/users&quot;</span>);</span><br><span class="line"></span><br><span class="line">userCollection.on(<span class="string">&quot;change&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(userCollection.models);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">userCollection.fetch();</span><br></pre></td></tr></table></figure>
<h3 id="8-7-重构-提取复用代码"><a href="#8-7-重构-提取复用代码" class="headerlink" title="8.7  重构-提取复用代码"></a>8.7  重构-提取复用代码</h3><h4 id="8-7-1-创建通用集合类"><a href="#8-7-1-创建通用集合类" class="headerlink" title="8.7.1-创建通用集合类"></a>8.7.1-创建通用集合类</h4><p>在刚刚创建的用户集合类中，它的问题就在于只能获取用户集合数据，接下来我们要将它改造成能够获取任何集合数据的通用集合类。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/Collection.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; User, UserProps &#125; <span class="keyword">from</span> <span class="string">&quot;./User&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Eventing &#125; <span class="keyword">from</span> <span class="string">&quot;./Eventing&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> axios, &#123; AxiosResponse &#125; <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Collection</span>&lt;<span class="title">T</span>, <span class="title">K</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// 用于存储集合的属性</span></span><br><span class="line">  <span class="attr">models</span>: T[] = [];</span><br><span class="line">  <span class="comment">// 组装事件系统</span></span><br><span class="line">  events: Eventing = <span class="keyword">new</span> Eventing();</span><br><span class="line">  <span class="comment">// 缩短方法调用</span></span><br><span class="line">  on = <span class="built_in">this</span>.events.on;</span><br><span class="line">  trigger = <span class="built_in">this</span>.events.trigger;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 接收请求地址</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> rootUrl: <span class="built_in">string</span>, <span class="keyword">public</span> deserialize: (value: K) =&gt; T</span>)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 用于发送请求获取集合数据</span></span><br><span class="line">  <span class="function"><span class="title">fetch</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    axios.get(<span class="built_in">this</span>.rootUrl).then(<span class="function">(<span class="params">response: AxiosResponse&lt;K[]&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 遍历集合</span></span><br><span class="line">      response.data.forEach(<span class="function">(<span class="params">value: K</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 将网络数据转换成模型数据并存储</span></span><br><span class="line">        <span class="built_in">this</span>.models.push(<span class="built_in">this</span>.deserialize(value));</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">// 数据获取完成后触发 change 事件</span></span><br><span class="line">      <span class="built_in">this</span>.trigger(<span class="string">&quot;change&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以下为测试代码</span></span><br><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Collection &#125; <span class="keyword">from</span> <span class="string">&quot;./models/Collection&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; User, UserProps &#125; <span class="keyword">from</span> <span class="string">&quot;./models/User&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userCollection = <span class="keyword">new</span> Collection&lt;User, UserProps&gt;(</span><br><span class="line">  <span class="string">&quot;http://localhost:3000/users&quot;</span>,</span><br><span class="line">  <span class="function">(<span class="params">value: UserProps</span>) =&gt;</span> User.buildUser(value)</span><br><span class="line">);</span><br><span class="line">userCollection.on(<span class="string">&quot;change&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(userCollection.models);</span><br><span class="line">&#125;);</span><br><span class="line">userCollection.fetch();</span><br></pre></td></tr></table></figure>
<h4 id="8-7-2-创建获取集合的静态方法"><a href="#8-7-2-创建获取集合的静态方法" class="headerlink" title="8.7.2 创建获取集合的静态方法"></a>8.7.2 创建获取集合的静态方法</h4><p>目前代码中存在的问题是创建集合时泛型参数的传递还是比较麻烦的，我们可以在 User 类中暴露一个用于创建用户集合的静态方法，以简化创建用户集合的相关逻辑代码。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/User.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Collection &#125; <span class="keyword">from</span> <span class="string">&quot;./Collection&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span>&lt;<span class="title">UserProps</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// 创建用户集合</span></span><br><span class="line">  <span class="keyword">static</span> buildCollection(): Collection&lt;User, UserProps&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Collection&lt;User, UserProps&gt;(rootUrl, <span class="function">(<span class="params">value: UserProps</span>) =&gt;</span></span><br><span class="line">      User.buildUser(value)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以下为测试代码</span></span><br><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; User &#125; <span class="keyword">from</span> <span class="string">&quot;./models/User&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userCollection = User.buildCollection();</span><br></pre></td></tr></table></figure>
<h3 id="8-8-功能完善"><a href="#8-8-功能完善" class="headerlink" title="8.8 功能完善"></a>8.8 功能完善</h3><h4 id="8-8-1-创建用户表单视图类"><a href="#8-8-1-创建用户表单视图类" class="headerlink" title="8.8.1 创建用户表单视图类"></a>8.8.1 创建用户表单视图类</h4><p>目标：创建用于渲染用户表单的视图类，并将用户表单渲染到页面中。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/views/UserForm.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">UserForm</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 模板父级</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> parent: Element</span>)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 用于返回模板字符串的方法</span></span><br><span class="line">  template(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;div&gt;</span></span><br><span class="line"><span class="string">        &lt;h1&gt;用户表单&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;input type=&quot;text&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 渲染方法</span></span><br><span class="line">  <span class="comment">// 1. 获取模板 2. 将模板内容渲染至 parent</span></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> templateElement = <span class="built_in">document</span>.createElement(<span class="string">&quot;template&quot;</span>);</span><br><span class="line">    templateElement.innerHTML = <span class="built_in">this</span>.template();</span><br><span class="line">    <span class="built_in">this</span>.parent.append(templateElement.content);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; UserForm &#125; <span class="keyword">from</span> <span class="string">&quot;./views/UserForm&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userForm = <span class="keyword">new</span> UserForm(<span class="built_in">document</span>.querySelector(<span class="string">&quot;#root&quot;</span>));</span><br><span class="line">userForm.render();</span><br></pre></td></tr></table></figure>
<h4 id="8-8-2-为模板元素附加事件"><a href="#8-8-2-为模板元素附加事件" class="headerlink" title="8.8.2 为模板元素附加事件"></a>8.8.2 为模板元素附加事件</h4><p>目标：为模板中的任意元素附加任意事件。</p>
<p>第一步：创建事件关系映射表。</p>
<p>第二步：在渲染模板时为元素绑定事件。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">UserForm</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 返回[元素][事件名称][事件处理函数]映射表</span></span><br><span class="line">  eventsMap(): &#123; [key: <span class="built_in">string</span>]: <span class="function">() =&gt;</span> <span class="built_in">void</span> &#125; &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="string">&quot;click:button&quot;</span>: <span class="built_in">this</span>.onButtonClick,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">onButtonClick</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;clicked&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.bindEvents(templateElement.content);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 事件绑定</span></span><br><span class="line">  bindEvents(fragment: DocumentFragment): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// 获取元素事件映射表</span></span><br><span class="line">    <span class="keyword">const</span> eventsMap = <span class="built_in">this</span>.eventsMap();</span><br><span class="line">    <span class="comment">// 遍历映射表</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> eventKey <span class="keyword">in</span> eventsMap) &#123;</span><br><span class="line">      <span class="comment">// 获取事件名称、元素选择器</span></span><br><span class="line">      <span class="keyword">const</span> [eventName, selector] = eventKey.split(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">      <span class="comment">// 从模板代码片段中找出要添加事件的元素们</span></span><br><span class="line">      fragment.querySelectorAll(selector).forEach(<span class="function">(<span class="params">element</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 为元素绑定事件</span></span><br><span class="line">        element.addEventListener(eventName, eventsMap[eventKey]);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="8-8-3-绑定模型数据"><a href="#8-8-3-绑定模型数据" class="headerlink" title="8.8.3 绑定模型数据"></a>8.8.3 绑定模型数据</h4><p>目标：在视图模板中渲染模型数据，渲染用户的姓名和年龄。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/views/UserForm.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; User &#125; <span class="keyword">from</span> <span class="string">&quot;../models/User&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">UserForm</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 接收模型数据</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> parent: Element, <span class="keyword">public</span> model: User</span>)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  template(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="comment">// 渲染模型数据</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;div&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;姓名: <span class="subst">$&#123;<span class="built_in">this</span>.model.get(<span class="string">&quot;name&quot;</span>)&#125;</span>&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;年龄: <span class="subst">$&#123;<span class="built_in">this</span>.model.get(<span class="string">&quot;age&quot;</span>)&#125;</span>&lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以下为测试代码</span></span><br><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; UserForm &#125; <span class="keyword">from</span> <span class="string">&quot;./views/UserForm&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; User &#125; <span class="keyword">from</span> <span class="string">&quot;./models/User&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = User.buildUser(&#123; <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> userForm = <span class="keyword">new</span> UserForm(<span class="built_in">document</span>.querySelector(<span class="string">&quot;#root&quot;</span>), user);</span><br><span class="line">userForm.render();</span><br></pre></td></tr></table></figure>
<h4 id="8-8-4-随机年龄"><a href="#8-8-4-随机年龄" class="headerlink" title="8.8.4  随机年龄"></a>8.8.4  随机年龄</h4><p>目标：点击按钮生成随机年龄，年龄数据被更改后重新渲染视图。</p>
<p>第一步：创建用于生成随机年龄的方法。</p>
<p>由于生成随机年龄的逻辑是和 User 模型相关的，所以该方法应该写在 User 模型类中。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/models/User.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 随机设置年龄</span></span><br><span class="line">  <span class="function"><span class="title">setRandomAge</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.set(&#123; <span class="attr">age</span>: <span class="built_in">Math</span>.round(<span class="built_in">Math</span>.random() * <span class="number">100</span>) &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第二步：为按钮绑定事件，事件触发后调用 setRandomAge 方法设置随机年龄。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/views/UserForm.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">UserForm</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 返回[元素][事件名称][事件处理函数]映射表</span></span><br><span class="line">  eventsMap(): &#123; [key: <span class="built_in">string</span>]: <span class="function">() =&gt;</span> <span class="built_in">void</span> &#125; &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="string">&quot;click:.set-age&quot;</span>: <span class="built_in">this</span>.onSetAgeClick,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">	</span><br><span class="line">  <span class="comment">// 特别注意: 此处要使用箭头函数, 否则 this 指向错误</span></span><br><span class="line">  onSetAgeClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.model.setRandomAge();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 用于返回模板字符串的方法</span></span><br><span class="line">  template(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`&lt;button class=&quot;set-age&quot;&gt;设置随机年龄&lt;/button&gt;`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第三步：随机年龄设置成功后，重新渲染视图。</p>
<p>由于模型数据更改后会自动触发 change 事件，所以此处需要监听 change 事件，事件触发后调用 render 方法重新渲染视图即可。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/views/UserForm.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">UserForm</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.bindModel();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.parent.innerHTML = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">bindModel</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.model.on(<span class="string">&quot;change&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.render();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="8-8-5-设置姓名"><a href="#8-8-5-设置姓名" class="headerlink" title="8.8.5 设置姓名"></a>8.8.5 设置姓名</h4><p>目标：在文本框中输入姓名，点击按钮更新姓名。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/views/UserForm.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">UserForm</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 返回[元素][事件名称][事件处理函数]映射表</span></span><br><span class="line">  eventsMap(): &#123; [key: <span class="built_in">string</span>]: <span class="function">() =&gt;</span> <span class="built_in">void</span> &#125; &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="string">&quot;click:.set-name&quot;</span>: <span class="built_in">this</span>.onSetNameClick,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onSetNameClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> input = <span class="built_in">this</span>.parent.querySelector(<span class="string">&quot;input&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> name = input.value;</span><br><span class="line">    <span class="built_in">this</span>.model.set(&#123; name &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  template(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;input type=&quot;text&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;button class=&quot;set-name&quot;&gt;设置姓名&lt;/button&gt;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="8-8-6-严格空检查"><a href="#8-8-6-严格空检查" class="headerlink" title="8.8.6 严格空检查"></a>8.8.6 严格空检查</h4><p>目标：创建 tsconfig 配置文件，开启严格检查模式。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tsc --init</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/views/UserForm.ts</span></span><br><span class="line">onSetNameClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// const input: HTMLInputElement | null</span></span><br><span class="line">  <span class="keyword">const</span> input = <span class="built_in">this</span>.parent.querySelector(<span class="string">&quot;input&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (input) &#123;</span><br><span class="line">    <span class="keyword">const</span> name = input.value;</span><br><span class="line">    <span class="built_in">this</span>.model.set(&#123; name &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="keyword">const</span> root = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#root&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (root) &#123;</span><br><span class="line">  <span class="keyword">const</span> userForm = <span class="keyword">new</span> UserForm(root, user);</span><br><span class="line">  userForm.render();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;Root element not found&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-9-重构-提取复用代码"><a href="#8-9-重构-提取复用代码" class="headerlink" title="8.9 重构-提取复用代码"></a>8.9 重构-提取复用代码</h3><h4 id="8-9-1-创建通用视图类"><a href="#8-9-1-创建通用视图类" class="headerlink" title="8.9.1 创建通用视图类"></a>8.9.1 创建通用视图类</h4><p>目标：创建 View 类，包含和视图相关的通用逻辑，其他具体的视图类通过继承该类拥有一些特定功能。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/views/View.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; User &#125; <span class="keyword">from</span> <span class="string">&quot;../models/User&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">View</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 模板父级</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> parent: Element, <span class="keyword">public</span> model: User</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.bindModel();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">abstract</span> template(): <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">abstract</span> eventsMap(): &#123; [key: <span class="built_in">string</span>]: <span class="function">() =&gt;</span> <span class="built_in">void</span> &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 渲染方法</span></span><br><span class="line">  <span class="comment">// 1. 获取模板 2. 将模板内容渲染至 parent</span></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.parent.innerHTML = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">const</span> templateElement = <span class="built_in">document</span>.createElement(<span class="string">&quot;template&quot;</span>);</span><br><span class="line">    templateElement.innerHTML = <span class="built_in">this</span>.template();</span><br><span class="line">    <span class="built_in">this</span>.bindEvents(templateElement.content);</span><br><span class="line">    <span class="built_in">this</span>.parent.append(templateElement.content);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 事件绑定</span></span><br><span class="line">  bindEvents(fragment: DocumentFragment): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// 获取元素事件映射表</span></span><br><span class="line">    <span class="keyword">const</span> eventsMap = <span class="built_in">this</span>.eventsMap();</span><br><span class="line">    <span class="comment">// 遍历映射表</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> eventKey <span class="keyword">in</span> eventsMap) &#123;</span><br><span class="line">      <span class="comment">// 获取事件名称、元素选择器</span></span><br><span class="line">      <span class="keyword">const</span> [eventName, selector] = eventKey.split(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">      <span class="comment">// 从模板代码片段中找出要添加事件的元素们</span></span><br><span class="line">      fragment.querySelectorAll(selector).forEach(<span class="function">(<span class="params">element</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 为元素绑定事件</span></span><br><span class="line">        element.addEventListener(eventName, eventsMap[eventKey]);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">bindModel</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.model.on(<span class="string">&quot;change&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.render();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/views/UserForm.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; View &#125; <span class="keyword">from</span> <span class="string">&quot;./View&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">UserForm</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 返回[元素][事件名称][事件处理函数]映射表</span></span><br><span class="line">  eventsMap(): &#123; [key: <span class="built_in">string</span>]: <span class="function">() =&gt;</span> <span class="built_in">void</span> &#125; &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="string">&quot;click:.set-age&quot;</span>: <span class="built_in">this</span>.onSetAgeClick,</span><br><span class="line">      <span class="string">&quot;click:.set-name&quot;</span>: <span class="built_in">this</span>.onSetNameClick,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onSetAgeClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.model.setRandomAge();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  onSetNameClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> input = <span class="built_in">this</span>.parent.querySelector(<span class="string">&quot;input&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (input) &#123;</span><br><span class="line">      <span class="keyword">const</span> name = input.value;</span><br><span class="line">      <span class="built_in">this</span>.model.set(&#123; name &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 用于返回模板字符串的方法</span></span><br><span class="line">  template(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;div&gt;</span></span><br><span class="line"><span class="string">        &lt;h1&gt;用户表单&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;姓名: <span class="subst">$&#123;<span class="built_in">this</span>.model.get(<span class="string">&quot;name&quot;</span>)&#125;</span>&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;年龄: <span class="subst">$&#123;<span class="built_in">this</span>.model.get(<span class="string">&quot;age&quot;</span>)&#125;</span>&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;input type=&quot;text&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;button class=&quot;set-name&quot;&gt;设置姓名&lt;/button&gt;</span></span><br><span class="line"><span class="string">        &lt;button class=&quot;set-age&quot;&gt;设置随机年龄&lt;/button&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="8-9-2-通过泛型指定模型参数类型"><a href="#8-9-2-通过泛型指定模型参数类型" class="headerlink" title="8.9.2  通过泛型指定模型参数类型"></a>8.9.2  通过泛型指定模型参数类型</h4><p>目标：通过泛型的方式指定视图类中接收的模型数据参数的类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/views/View.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">View</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Model</span>&lt;<span class="title">K</span>&gt;, <span class="title">K</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// 模板父级</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> model: T</span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/views/UserForm.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; User, UserProps &#125; <span class="keyword">from</span> <span class="string">&quot;../models/User&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">UserForm</span> <span class="keyword">extends</span> <span class="title">View</span>&lt;<span class="title">User</span>, <span class="title">UserProps</span>&gt; </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-10-完善功能"><a href="#8-10-完善功能" class="headerlink" title="8.10 完善功能"></a>8.10 完善功能</h3><h4 id="8-10-1-保存用户"><a href="#8-10-1-保存用户" class="headerlink" title="8.10.1 保存用户"></a>8.10.1 保存用户</h4><p>目标：在用户表单类中，实现点击按钮创建用户，将用户信息同步到服务端。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/views/UserForm.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">UserForm</span> <span class="keyword">extends</span> <span class="title">View</span>&lt;<span class="title">User</span>, <span class="title">UserProps</span>&gt; </span>&#123;</span><br><span class="line">  eventsMap(): &#123; [key: <span class="built_in">string</span>]: <span class="function">() =&gt;</span> <span class="built_in">void</span> &#125; &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="string">&quot;click:.save-user&quot;</span>: <span class="built_in">this</span>.onSaveUserClick,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onSaveUserClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.model.save();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  template(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;input type=&quot;text&quot; placeholder=&quot;<span class="subst">$&#123;<span class="built_in">this</span>.model.get(<span class="string">&quot;name&quot;</span>)&#125;</span>&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;button class=&quot;save-user&quot;&gt;保存用户&lt;/button&gt;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="8-10-2-创建-UserShow-视图类"><a href="#8-10-2-创建-UserShow-视图类" class="headerlink" title="8.10.2 创建 UserShow 视图类"></a>8.10.2 创建 UserShow 视图类</h4><p>目标：创建用于展示用户信息的视图类。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; View &#125; <span class="keyword">from</span> <span class="string">&quot;./View&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; User, UserProps &#125; <span class="keyword">from</span> <span class="string">&quot;../models/User&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">UserShow</span> <span class="keyword">extends</span> <span class="title">View</span>&lt;<span class="title">User</span>, <span class="title">UserProps</span>&gt; </span>&#123;</span><br><span class="line">  template(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;div&gt;</span></span><br><span class="line"><span class="string">        &lt;h1&gt;用户信息&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;div&gt;姓名: <span class="subst">$&#123;<span class="built_in">this</span>.model.get(<span class="string">&quot;name&quot;</span>)&#125;</span>&lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意：由于 UserShow 视图类继承了 View 通用视图类，View 视图类要求子类实现 template 方法和 eventsMap 方法，但是在 UserShow 视图类中并不打算为元素绑定事件，所以仍然要写一个返回空对象的 eventsMap 方法，这显然是代码中考虑不周的地方。</p>
<p>要解决上述问题，我们只需要在 View 类中实现一个默认的返回空对象的 eventsMap 方法即可。如果子类要绑定事件，可以覆盖父类中的该方法。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/views/View.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">View</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Model</span>&lt;<span class="title">K</span>&gt;, <span class="title">K</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// 子类如果有相同方法, 会覆盖父类的方法</span></span><br><span class="line">  eventsMap(): &#123; [key: <span class="built_in">string</span>]: <span class="function">() =&gt;</span> <span class="built_in">void</span> &#125; &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="8-10-3-创建-UserEdit-视图类"><a href="#8-10-3-创建-UserEdit-视图类" class="headerlink" title="8.10.3 创建 UserEdit 视图类"></a>8.10.3 创建 UserEdit 视图类</h4><p>目标：创建 UserEdit 视图类，即将在该类中调用 UserShow 视图类和 UserForm 视图类。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/views/UserEdit.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; View &#125; <span class="keyword">from</span> <span class="string">&quot;./View&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; User, UserProps &#125; <span class="keyword">from</span> <span class="string">&quot;../models/User&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">UserEdit</span> <span class="keyword">extends</span> <span class="title">View</span>&lt;<span class="title">User</span>, <span class="title">UserProps</span>&gt; </span>&#123;</span><br><span class="line">  template(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;div class=&quot;user-show&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;div class=&quot;user-form&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="8-10-4-视图嵌套"><a href="#8-10-4-视图嵌套" class="headerlink" title="8.10.4  视图嵌套"></a>8.10.4  视图嵌套</h4><p>目标：在 UserEdit 视图中渲染 UserShow 视图和 userForm 视图。</p>
<p>实现思路：由于在渲染其他视图时需要传递该视图的渲染位置，即渲染视图的目标父级元素，而目标父级元素的获取属于渲染视图中的公共逻辑，所以该逻辑要写在 View 视图类中，但是对于 View 类来说，它并不知道目标父级元素是谁，所以目标父级信息由子类提供，View 类通过子类提供的信息进行父级元素的获取和存储，子类再根根据获取结果渲染其他视图。</p>
<p>子类提供父类信息 -&gt; 父类获取元素 -&gt; 子类使用元素渲染其他视图</p>
<p>第一步：在 UserEdit 视图类中提供要渲染的其他视图需要的父类信息。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/views/UserEdit.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">UserEdit</span> <span class="keyword">extends</span> <span class="title">View</span>&lt;<span class="title">User</span>, <span class="title">UserProps</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// 要渲染的其他视图的父级信息映射表</span></span><br><span class="line">  regionsMap(): &#123; [key: <span class="built_in">string</span>]: <span class="built_in">string</span> &#125; &#123;</span><br><span class="line">    <span class="comment">// key: 标识</span></span><br><span class="line">    <span class="comment">// value: 父类元素选择器</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">userShow</span>: <span class="string">&quot;.user-show&quot;</span>,</span><br><span class="line">      <span class="attr">userForm</span>: <span class="string">&quot;.user-form&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第二步：父级在获取到模板元素以后，根据父级信息映射表从模板元素中获取父级元素</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Model &#125; <span class="keyword">from</span> <span class="string">&quot;../models/Model&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">View</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Model</span>&lt;<span class="title">K</span>&gt;, <span class="title">K</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// 用于存储获取到的目标父级元素</span></span><br><span class="line">  <span class="attr">regions</span>: &#123; [key: <span class="built_in">string</span>]: Element &#125; = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  mapRegions(fragment: DocumentFragment): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// 获取子类提供的父级信息映射表</span></span><br><span class="line">    <span class="keyword">const</span> regionsMap = <span class="built_in">this</span>.regionsMap();</span><br><span class="line">    <span class="comment">// 遍历父级信息映射表</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> regionsMap) &#123;</span><br><span class="line">      <span class="comment">// 从映射表中获取父级元素选择器</span></span><br><span class="line">      <span class="keyword">const</span> selector = regionsMap[key];</span><br><span class="line">      <span class="comment">// 在模板中获取目标父级元素</span></span><br><span class="line">      <span class="keyword">const</span> element = fragment.querySelector(selector);</span><br><span class="line">      <span class="comment">// 如果目标父级存在</span></span><br><span class="line">      <span class="keyword">if</span> (element) &#123;</span><br><span class="line">        <span class="comment">// 存储目标父级元素</span></span><br><span class="line">        <span class="built_in">this</span>.regions[key] = element;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 获取到组件模板以后根据组件模板获取目标父级元素</span></span><br><span class="line">    <span class="built_in">this</span>.mapRegions(templateElement.content);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第三步：子类根据父类获取到的父级元素渲染其他视图。</p>
<p>① 父类在获取到父级元素以后，调用子类提供的 onRender 方法开始渲染其他视图</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/views/View.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">View</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Model</span>&lt;<span class="title">K</span>&gt;, <span class="title">K</span>&gt; </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.onRender();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>② 子类通过 onRender 方法进行其他视图的渲染</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/views/UserEdit.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; UserShow &#125; <span class="keyword">from</span> <span class="string">&quot;./UserShow&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; UserForm &#125; <span class="keyword">from</span> <span class="string">&quot;./UserForm&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">UserEdit</span> <span class="keyword">extends</span> <span class="title">View</span>&lt;<span class="title">User</span>, <span class="title">UserProps</span>&gt; </span>&#123;</span><br><span class="line">  onRender(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">new</span> UserShow(<span class="built_in">this</span>.regions.userShow, <span class="built_in">this</span>.model).render();</span><br><span class="line">    <span class="keyword">new</span> UserForm(<span class="built_in">this</span>.regions.userForm, <span class="built_in">this</span>.model).render();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第四步：在父类中定义默认的 onRender 方法和 regionsMap 方法，防止在子类不提供该方法时程序运行出错。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/views/View.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">View</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Model</span>&lt;<span class="title">K</span>&gt;, <span class="title">K</span>&gt; </span>&#123;</span><br><span class="line">  regionsMap(): &#123; [key: <span class="built_in">string</span>]: <span class="built_in">string</span> &#125; &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  onRender(): <span class="built_in">void</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以下为测试代码</span></span><br><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; User &#125; <span class="keyword">from</span> <span class="string">&quot;./models/User&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; UserEdit &#125; <span class="keyword">from</span> <span class="string">&quot;./views/UserEdit&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = User.buildUser(&#123; <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> root = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#root&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (root) &#123;</span><br><span class="line">  <span class="keyword">const</span> userEdit = <span class="keyword">new</span> UserEdit(root, user);</span><br><span class="line">  userEdit.render();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;Root element not found&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="8-10-5-创建通用集合视图类"><a href="#8-10-5-创建通用集合视图类" class="headerlink" title="8.10.5 创建通用集合视图类"></a>8.10.5 创建通用集合视图类</h4><p>目标：创建一个用于渲染集合模型数据的通用视图类。</p>
<p>第一步：创建通用的渲染集合模型数据的视图类。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/views/CollectionView.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Collection &#125; <span class="keyword">from</span> <span class="string">&quot;../models/Collection&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用于渲染集合数据的视图类</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">CollectionView</span>&lt;<span class="title">T</span>, <span class="title">K</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// parent: 集合数据渲染的目标父级元素</span></span><br><span class="line">  <span class="comment">// collection: 即将要渲染的集合数据</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> parent: Element, <span class="keyword">public</span> collection: Collection&lt;T, K&gt;</span>)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 子类需要实现的渲染模型数据的方法</span></span><br><span class="line">  <span class="comment">// model: 要渲染的模型数据</span></span><br><span class="line">  <span class="comment">// itemParent: 模型数据渲染的目标父级</span></span><br><span class="line">  <span class="keyword">abstract</span> renderItem(model: T, <span class="attr">itemParent</span>: Element): <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">  render(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// 清空父级内容</span></span><br><span class="line">    <span class="built_in">this</span>.parent.innerHTML = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">// 创建 template 模板元素, 临时存放即将渲染的模型列表数据</span></span><br><span class="line">    <span class="keyword">const</span> templateElement = <span class="built_in">document</span>.createElement(<span class="string">&quot;template&quot;</span>);</span><br><span class="line">    <span class="comment">// 遍历模型列表数据</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> model <span class="keyword">of</span> <span class="built_in">this</span>.collection.models) &#123;</span><br><span class="line">      <span class="comment">// 创建当前模型列表数据的渲染目标父级</span></span><br><span class="line">      <span class="keyword">const</span> itemParent = <span class="built_in">document</span>.createElement(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">      <span class="comment">// 调用子类实现的 renderItem 方法将模型数据渲染到 itemParent 父级中</span></span><br><span class="line">      <span class="built_in">this</span>.renderItem(model, itemParent);</span><br><span class="line">      <span class="comment">// 将当前渲染好的模型数据临时存放在 template 模板元素中</span></span><br><span class="line">      templateElement.content.append(itemParent);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 将模型列表数据整体追加到它的父级</span></span><br><span class="line">    <span class="built_in">this</span>.parent.append(templateElement.content);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第二步：创建用户列表视图类，用于渲染用户列表视图。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/views/UserList.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; User, UserProps &#125; <span class="keyword">from</span> <span class="string">&quot;../models/User&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; CollectionView &#125; <span class="keyword">from</span> <span class="string">&quot;./CollectionView&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; UserShow &#125; <span class="keyword">from</span> <span class="string">&quot;./UserShow&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">UserList</span> <span class="keyword">extends</span> <span class="title">CollectionView</span>&lt;<span class="title">User</span>, <span class="title">UserProps</span>&gt; </span>&#123;</span><br><span class="line">  renderItem(model: User, <span class="attr">itemParent</span>: Element): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">new</span> UserShow(itemParent, model).render();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以下为测试代码</span></span><br><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Collection &#125; <span class="keyword">from</span> <span class="string">&quot;./models/Collection&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; User, UserProps &#125; <span class="keyword">from</span> <span class="string">&quot;./models/User&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; UserList &#125; <span class="keyword">from</span> <span class="string">&quot;./views/UserList&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> users = <span class="keyword">new</span> Collection&lt;User, UserProps&gt;(</span><br><span class="line">  <span class="string">&quot;http://localhost:3000/users&quot;</span>,</span><br><span class="line">  <span class="function">(<span class="params">value: UserProps</span>) =&gt;</span> User.buildUser(value)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">users.on(<span class="string">&quot;change&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> root = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#root&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (root) &#123;</span><br><span class="line">    <span class="keyword">new</span> UserList(root, users).render();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">users.fetch();</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined" rel="external nofollow noreferrer">freelaeder</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://mail.freelaeder.cn/archives/ae4c07b8.html">http://mail.freelaeder.cn/archives/ae4c07b8.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener external nofollow noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/typeScript%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">typeScript基础知识</a><a class="post-meta__tags" href="/tags/typeScript/">typeScript</a></div><div class="post_share"><div class="social-share" data-image="/img/wallseven/wallseven27.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/archives/36044e1a.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://s1.ax1x.com/2022/05/20/OOImdK.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Dynamic list</div></div></a></div><div class="next-post pull-right"><a href="/archives/77971af0.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/wallseven/wallseven26.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">ts报错解决持续更新</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> Related Articles</span></div><div class="relatedPosts-list"><div><a href="/archives/77971af0.html" title="ts报错解决持续更新"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/wallseven/wallseven26.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-01</div><div class="title">ts报错解决持续更新</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/header.svg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">freelaeder</div><div class="author-info__description">我打碎了夕阳,散做漫天的星光</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">100</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">103</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">16</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">你我裹挟韶光 , 流沔星河万丈</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#TypeScript-%E6%95%99%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text">TypeScript 教程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-TypeScript-%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">1. TypeScript 概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-TypeScript-%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 TypeScript 是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%E5%B8%A6%E6%9D%A5%E7%9A%84%E5%A5%BD%E5%A4%84"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2 类型系统带来的好处</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-TypeScript-%E5%88%9D%E4%BD%93%E9%AA%8C"><span class="toc-number">1.2.</span> <span class="toc-text">2. TypeScript 初体验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E7%AC%AC%E4%B8%80%E4%B8%AA-TypeScript-%E5%BA%94%E7%94%A8"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 第一个 TypeScript 应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E4%BC%98%E5%8C%96%E5%B7%A5%E4%BD%9C%E6%B5%81"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 优化工作流</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E4%BD%93%E9%AA%8C%E7%B1%BB%E5%9E%8B%E5%B8%A6%E6%9D%A5%E7%9A%84%E5%A5%BD%E5%A4%84"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.3 体验类型带来的好处</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-TypeScript-%E5%9F%BA%E7%A1%80%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.3.</span> <span class="toc-text">3. TypeScript 基础类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E6%A6%82%E8%BF%B0"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1 概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2 基本数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-any-%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.3 any 类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E6%95%B0%E7%BB%84-Array"><span class="toc-number">1.3.4.</span> <span class="toc-text">3.4 数组 Array</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-%E5%85%83%E7%BB%84-Tuples"><span class="toc-number">1.3.5.</span> <span class="toc-text">3.5 元组 Tuples</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-%E6%9E%9A%E4%B8%BE-Enum"><span class="toc-number">1.3.6.</span> <span class="toc-text">3.6 枚举 Enum</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-%E5%87%BD%E6%95%B0-Function"><span class="toc-number">1.3.7.</span> <span class="toc-text">3.7 函数 Function</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-%E5%AF%B9%E8%B1%A1-Object"><span class="toc-number">1.3.8.</span> <span class="toc-text">3.8 对象 Object</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-9-%E7%B1%BB%E5%9E%8B%E6%8E%A8%E6%96%AD"><span class="toc-number">1.3.9.</span> <span class="toc-text">3.9 类型推断</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-TypeScript-%E9%AB%98%E7%BA%A7%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.4.</span> <span class="toc-text">4. TypeScript 高级类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E7%B1%BB%E5%9E%8B%E5%88%AB%E5%90%8D"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 类型别名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E8%81%94%E5%90%88%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 联合类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E4%BA%A4%E5%8F%89%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.4.3.</span> <span class="toc-text">4.3 交叉类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E5%AD%97%E9%9D%A2%E9%87%8F%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.4.4.</span> <span class="toc-text">4.4 字面量类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-%E5%8F%AF%E7%A9%BA%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.4.5.</span> <span class="toc-text">4.5 可空类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-%E5%8F%AF%E9%80%89%E9%93%BE%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">1.4.6.</span> <span class="toc-text">4.6 可选链操作符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-%E7%A9%BA%E5%80%BC%E5%90%88%E5%B9%B6%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">1.4.7.</span> <span class="toc-text">4.7 空值合并运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-8-%E7%B1%BB%E5%9E%8B%E6%96%AD%E8%A8%80"><span class="toc-number">1.4.8.</span> <span class="toc-text">4.8 类型断言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-9-unknown-%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.4.9.</span> <span class="toc-text">4.9 unknown 类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-10-never-%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.4.10.</span> <span class="toc-text">4.10 never 类型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B"><span class="toc-number">1.5.</span> <span class="toc-text">5. 面向对象编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E6%A6%82%E8%BF%B0"><span class="toc-number">1.5.1.</span> <span class="toc-text">5.1 概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.5.2.</span> <span class="toc-text">5.2 类与对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-number">1.5.3.</span> <span class="toc-text">5.3 构造函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E5%8F%AA%E8%AF%BB%E5%B1%9E%E6%80%A7"><span class="toc-number">1.5.4.</span> <span class="toc-text">5.4 只读属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-%E7%BB%A7%E6%89%BF"><span class="toc-number">1.5.5.</span> <span class="toc-text">5.5 继承</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="toc-number">1.5.6.</span> <span class="toc-text">5.6 访问权限修饰符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-7-Getter-%E4%B8%8E-Setter"><span class="toc-number">1.5.7.</span> <span class="toc-text">5.7 Getter 与 Setter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-8-%E5%8F%82%E6%95%B0%E5%B1%9E%E6%80%A7"><span class="toc-number">1.5.8.</span> <span class="toc-text">5.8 参数属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-9-%E7%B4%A2%E5%BC%95%E7%AD%BE%E5%90%8D"><span class="toc-number">1.5.9.</span> <span class="toc-text">5.9 索引签名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-10-%E9%9D%99%E6%80%81%E6%88%90%E5%91%98"><span class="toc-number">1.5.10.</span> <span class="toc-text">5.10 静态成员</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-11-%E6%8A%BD%E8%B1%A1%E7%B1%BB"><span class="toc-number">1.5.11.</span> <span class="toc-text">5.11 抽象类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-12-%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.5.12.</span> <span class="toc-text">5.12 接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-13-%E6%8E%A5%E5%8F%A3%E4%B8%8E%E7%B1%BB%E5%9E%8B%E5%88%AB%E5%90%8D"><span class="toc-number">1.5.13.</span> <span class="toc-text">5.13 接口与类型别名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-11-%E5%87%BD%E6%95%B0%E9%87%8D%E8%BD%BD"><span class="toc-number">1.5.14.</span> <span class="toc-text">4.11 函数重载</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%85%B6%E4%BB%96%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.6.</span> <span class="toc-text">6. 其他类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E6%B3%9B%E5%9E%8B"><span class="toc-number">1.6.1.</span> <span class="toc-text">6.1 泛型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%B3%9B%E5%9E%8B%E7%B1%BB"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">1.  泛型类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%B3%9B%E5%9E%8B%E5%87%BD%E6%95%B0"><span class="toc-number">1.6.1.2.</span> <span class="toc-text">2. 泛型函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%B3%9B%E5%9E%8B%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.6.1.3.</span> <span class="toc-text">3. 泛型接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E6%B3%9B%E5%9E%8B%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.6.1.4.</span> <span class="toc-text">4. 泛型约束</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E7%BB%A7%E6%89%BF%E6%B3%9B%E5%9E%8B%E7%B1%BB"><span class="toc-number">1.6.1.5.</span> <span class="toc-text">5. 继承泛型类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-keyof-%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">1.6.2.</span> <span class="toc-text">6.2 keyof 操作符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E6%98%A0%E5%B0%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.6.3.</span> <span class="toc-text">6.3 映射类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-%E5%B7%A5%E5%85%B7%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.6.4.</span> <span class="toc-text">6.4 工具类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-1-Partical"><span class="toc-number">1.6.4.1.</span> <span class="toc-text">6.4.1 Partical</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-2-Readonly"><span class="toc-number">1.6.4.2.</span> <span class="toc-text">6.4.2 Readonly</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-3-Record"><span class="toc-number">1.6.4.3.</span> <span class="toc-text">6.4.3 Record</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-4-Omit"><span class="toc-number">1.6.4.4.</span> <span class="toc-text">6.4.4 Omit</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-5-Pick"><span class="toc-number">1.6.4.5.</span> <span class="toc-text">6.4.5 Pick</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-6-Exclude"><span class="toc-number">1.6.4.6.</span> <span class="toc-text">6.4.6 Exclude</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-5-is"><span class="toc-number">1.6.5.</span> <span class="toc-text">6.5 is</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%9C%B0%E5%9B%BE%E6%A0%87%E8%AE%B0%E6%A1%88%E4%BE%8B"><span class="toc-number">1.7.</span> <span class="toc-text">4. 地图标记案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E6%A1%88%E4%BE%8B%E5%87%86%E5%A4%87"><span class="toc-number">1.7.1.</span> <span class="toc-text">4.1 案例准备</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96"><span class="toc-number">1.7.1.1.</span> <span class="toc-text">1. 安装依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E5%BA%94%E7%94%A8"><span class="toc-number">1.7.1.2.</span> <span class="toc-text">2. 创建应用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7"><span class="toc-number">1.7.2.</span> <span class="toc-text">4.2 创建用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E5%88%9B%E5%BB%BA%E5%85%AC%E5%8F%B8"><span class="toc-number">1.7.3.</span> <span class="toc-text">4.3 创建公司</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E5%88%9B%E5%BB%BA%E5%9C%B0%E5%9B%BE"><span class="toc-number">1.7.4.</span> <span class="toc-text">4.4 创建地图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-%E5%B0%81%E8%A3%85%E5%9C%B0%E5%9B%BE%E7%B1%BB"><span class="toc-number">1.7.5.</span> <span class="toc-text">4.5 封装地图类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-%E5%9C%B0%E5%9B%BE%E6%A0%87%E8%AE%B0"><span class="toc-number">1.7.6.</span> <span class="toc-text">4.6 地图标记</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-%E6%B6%88%E9%99%A4%E9%87%8D%E5%A4%8D%E4%BB%A3%E7%A0%81"><span class="toc-number">1.7.7.</span> <span class="toc-text">4.7 消除重复代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-8-%E5%A2%9E%E5%8A%A0%E7%A8%8B%E5%BA%8F%E6%89%A9%E5%B1%95%E6%80%A7"><span class="toc-number">1.7.8.</span> <span class="toc-text">4.8 增加程序扩展性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-9-%E5%88%9B%E5%BB%BA%E6%A0%87%E8%AE%B0%E5%BC%B9%E6%A1%86"><span class="toc-number">1.7.9.</span> <span class="toc-text">4.9 创建标记弹框</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-10-%E4%BD%BF%E7%94%A8%E6%8E%A5%E5%8F%A3%E7%BA%A6%E6%9D%9F%E7%B1%BB"><span class="toc-number">1.7.10.</span> <span class="toc-text">4.10 使用接口约束类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%8E%92%E5%BA%8F%E6%A1%88%E4%BE%8B"><span class="toc-number">1.8.</span> <span class="toc-text">5. 排序案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E6%A6%82%E8%BF%B0-1"><span class="toc-number">1.8.1.</span> <span class="toc-text">5.1 概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E9%85%8D%E7%BD%AE%E7%BC%96%E8%AF%91%E5%99%A8"><span class="toc-number">1.8.2.</span> <span class="toc-text">5.2 配置编译器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E5%B9%B6%E8%A1%8C%E7%BC%96%E8%AF%91%E9%85%8D%E7%BD%AE"><span class="toc-number">1.8.3.</span> <span class="toc-text">5.3 并行编译配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E5%A4%8D%E4%B9%A0%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F-%E5%8D%87%E5%BA%8F"><span class="toc-number">1.8.4.</span> <span class="toc-text">5.4 复习冒泡排序(升序)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-%E5%88%9B%E5%BB%BA%E6%8E%92%E5%BA%8F%E7%B1%BB"><span class="toc-number">1.8.5.</span> <span class="toc-text">5.5 创建排序类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-%E7%B1%BB%E5%9E%8B%E5%AE%88%E5%8D%AB"><span class="toc-number">1.8.6.</span> <span class="toc-text">5.6  类型守卫</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-7-%E5%88%9B%E5%BB%BA%E6%95%B0%E5%80%BC%E6%95%B0%E7%BB%84%E6%8E%92%E5%BA%8F%E7%B1%BB"><span class="toc-number">1.8.7.</span> <span class="toc-text">5.7 创建数值数组排序类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-8-%E5%AE%9A%E4%B9%89%E6%8E%92%E5%BA%8F%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.8.8.</span> <span class="toc-text">5.8 定义排序接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-9-%E5%88%9B%E5%BB%BA%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8E%92%E5%BA%8F%E7%B1%BB"><span class="toc-number">1.8.9.</span> <span class="toc-text">5.9 创建字符串排序类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-10-%E7%AE%80%E5%8C%96%E6%8E%92%E5%BA%8F%E7%B1%BB%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">1.8.10.</span> <span class="toc-text">5.10 简化排序类使用方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-11-%E6%8A%BD%E8%B1%A1%E7%B1%BB-1"><span class="toc-number">1.8.11.</span> <span class="toc-text">5.11 抽象类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE%E6%A1%88%E4%BE%8B"><span class="toc-number">1.9.</span> <span class="toc-text">6. 统计数据案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E6%A6%82%E8%BF%B0"><span class="toc-number">1.9.1.</span> <span class="toc-text">6.1 概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E9%A1%B9%E7%9B%AE%E8%AE%BE%E7%BD%AE"><span class="toc-number">1.9.2.</span> <span class="toc-text">6.2 项目设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E9%9C%80%E6%B1%82-gt-CSV-%E6%95%B0%E6%8D%AE%E8%A7%A3%E6%9E%90"><span class="toc-number">1.9.3.</span> <span class="toc-text">6.3 需求 -&gt; CSV 数据解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-%E9%9C%80%E6%B1%82-gt-%E6%B1%82%E6%9B%BC%E8%81%94%E8%B5%A2%E8%B5%9B%E7%9A%84%E6%AC%A1%E6%95%B0"><span class="toc-number">1.9.4.</span> <span class="toc-text">6.4 需求 -&gt; 求曼联赢赛的次数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-5-%E6%8F%90%E5%8D%87%E7%A8%8B%E5%BA%8F%E5%8F%AF%E9%98%85%E8%AF%BB%E6%80%A7"><span class="toc-number">1.9.5.</span> <span class="toc-text">6.5 提升程序可阅读性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-5-1-%E9%97%AE%E9%A2%98"><span class="toc-number">1.9.5.1.</span> <span class="toc-text">6.5.1 问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-5-2-%E6%9E%9A%E4%B8%BE"><span class="toc-number">1.9.5.2.</span> <span class="toc-text">6.5.2  枚举</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-6-%E6%8F%90%E5%8D%87%E7%A8%8B%E5%BA%8F%E5%8F%AF%E5%A4%8D%E7%94%A8%E6%80%A7"><span class="toc-number">1.9.6.</span> <span class="toc-text">6.6 提升程序可复用性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-6-1-%E6%A6%82%E8%BF%B0"><span class="toc-number">1.9.6.1.</span> <span class="toc-text">6.6.1 概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-6-2-%E5%88%9B%E5%BB%BA%E8%AF%BB%E5%8F%96%E6%9C%AC%E5%9C%B0CSV%E6%96%87%E4%BB%B6%E7%9A%84%E7%B1%BB"><span class="toc-number">1.9.6.2.</span> <span class="toc-text">6.6.2 创建读取本地CSV文件的类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-7-%E9%9C%80%E6%B1%82-gt-%E8%A1%8C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.9.7.</span> <span class="toc-text">6.7  需求 -&gt; 行数据类型转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-8-CsvFileReader-%E7%B1%BB%E9%87%8D%E6%9E%84"><span class="toc-number">1.9.8.</span> <span class="toc-text">6.8  CsvFileReader 类重构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-8-1-%E6%A6%82%E8%BF%B0"><span class="toc-number">1.9.8.1.</span> <span class="toc-text">6.8.1  概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-8-2-%E2%91%A0-%E5%9F%BA%E4%BA%8E%E7%BB%A7%E6%89%BF%E7%9A%84%E9%87%8D%E6%9E%84"><span class="toc-number">1.9.8.2.</span> <span class="toc-text">6.8.2 ① 基于继承的重构</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%8A%BD%E8%B1%A1%E7%B1%BB"><span class="toc-number">1.9.8.2.1.</span> <span class="toc-text">1. 抽象类</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%B3%9B%E5%9E%8B"><span class="toc-number">1.9.8.2.2.</span> <span class="toc-text">2. 泛型</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-8-3-%E2%91%A1-%E5%9F%BA%E4%BA%8E%E7%BB%84%E5%90%88%E7%9A%84%E9%87%8D%E6%9E%84"><span class="toc-number">1.9.8.3.</span> <span class="toc-text">6.8.3 ② 基于组合的重构</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-9-%E6%AF%94%E8%B5%9B%E7%BB%93%E6%9E%9C%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E8%BE%93%E5%87%BA"><span class="toc-number">1.9.9.</span> <span class="toc-text">6.9 比赛结果的分析与输出</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-9-1-%E6%A6%82%E8%BF%B0"><span class="toc-number">1.9.9.1.</span> <span class="toc-text">6.9.1 概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-9-2-%E5%88%9B%E5%BB%BA%E5%88%86%E6%9E%90%E6%8E%A5%E5%8F%A3%E5%92%8C%E8%BE%93%E5%87%BA%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.9.9.2.</span> <span class="toc-text">6.9.2 创建分析接口和输出接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-9-3-%E5%88%9B%E5%BB%BA%E5%88%86%E6%9E%90%E7%B1%BB"><span class="toc-number">1.9.9.3.</span> <span class="toc-text">6.9.3 创建分析类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-9-4-%E5%88%9B%E5%BB%BA%E8%BE%93%E5%87%BA%E7%B1%BB"><span class="toc-number">1.9.9.4.</span> <span class="toc-text">6.9.4 创建输出类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-9-5-%E7%AE%80%E5%8C%96%E8%B0%83%E7%94%A8%E9%80%BB%E8%BE%91"><span class="toc-number">1.9.9.5.</span> <span class="toc-text">6.9.5 简化调用逻辑</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E6%95%B0%E6%8D%AE%E9%A9%B1%E5%8A%A8%E8%A7%86%E5%9B%BE%E6%A1%88%E4%BE%8B"><span class="toc-number">1.10.</span> <span class="toc-text">8. 数据驱动视图案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-%E6%A6%82%E8%BF%B0"><span class="toc-number">1.10.1.</span> <span class="toc-text">8.1 概述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-1-%E7%9B%AE%E6%A0%87"><span class="toc-number">1.10.1.1.</span> <span class="toc-text">8.1.1 目标</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-2-%E5%88%9B%E5%BB%BA%E5%BA%94%E7%94%A8"><span class="toc-number">1.10.1.2.</span> <span class="toc-text">8.1.2 创建应用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-%E5%8A%9F%E8%83%BD%E5%AE%8C%E5%96%84"><span class="toc-number">1.10.2.</span> <span class="toc-text">8.2 功能完善</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-1-%E5%88%9B%E5%BB%BA%E6%A8%A1%E5%9E%8B%E7%B1%BB-User"><span class="toc-number">1.10.2.1.</span> <span class="toc-text">8.2.1 创建模型类 User</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-2-%E5%88%9B%E5%BB%BA-set-%E6%96%B9%E6%B3%95%E6%9B%B4%E6%96%B0%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">1.10.2.2.</span> <span class="toc-text">8.2.2 创建 set 方法更新用户信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-3-%E5%B0%8F%E5%9E%8B%E4%BA%8B%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.10.2.3.</span> <span class="toc-text">8.2.3 小型事件系统</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-4-%E7%8A%B6%E6%80%81%E5%90%8C%E6%AD%A5"><span class="toc-number">1.10.2.4.</span> <span class="toc-text">8.2.4 状态同步</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-%E9%87%8D%E6%9E%84-%E6%8F%90%E5%8F%96%E5%A4%8D%E7%94%A8%E4%BB%A3%E7%A0%81"><span class="toc-number">1.10.3.</span> <span class="toc-text">8.3 重构-提取复用代码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-1-%E6%A6%82%E8%BF%B0"><span class="toc-number">1.10.3.1.</span> <span class="toc-text">8.3.1 概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-2-%E6%8F%90%E5%8F%96%E4%BA%8B%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.10.3.2.</span> <span class="toc-text">8.3.2 提取事件系统</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-3-%E6%8F%90%E5%8F%96%E7%8A%B6%E6%80%81%E5%90%8C%E6%AD%A5"><span class="toc-number">1.10.3.3.</span> <span class="toc-text">8.3.3 提取状态同步</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-4-%E6%8F%90%E5%8F%96%E5%AF%B9%E8%B1%A1%E5%B1%9E%E6%80%A7"><span class="toc-number">1.10.3.4.</span> <span class="toc-text">8.3.4 提取对象属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-5-%E5%87%8F%E5%B0%91%E8%B0%83%E7%94%A8%E5%B1%9E%E6%80%A7%E5%B1%82%E7%BA%A7"><span class="toc-number">1.10.3.5.</span> <span class="toc-text">8.3.5 减少调用属性层级</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-%E5%8A%9F%E8%83%BD%E5%AE%8C%E5%96%84"><span class="toc-number">1.10.4.</span> <span class="toc-text">8.4 功能完善</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-4-1-%E6%B7%BB%E5%8A%A0-set-%E6%96%B9%E6%B3%95-User"><span class="toc-number">1.10.4.1.</span> <span class="toc-text">8.4.1 添加 set 方法 (User)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-4-2-%E6%B7%BB%E5%8A%A0-fetch-%E6%96%B9%E6%B3%95-User"><span class="toc-number">1.10.4.2.</span> <span class="toc-text">8.4.2  添加 fetch 方法 (User)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-4-3-%E6%B7%BB%E5%8A%A0-save-%E6%96%B9%E6%B3%95-User"><span class="toc-number">1.10.4.3.</span> <span class="toc-text">8.4.3 添加 save 方法 (User)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-5-%E9%87%8D%E6%9E%84-%E6%8F%90%E5%8F%96%E5%A4%8D%E7%94%A8%E4%BB%A3%E7%A0%81"><span class="toc-number">1.10.5.</span> <span class="toc-text">8.5 重构-提取复用代码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5-1-%E6%8F%90%E5%8F%96%E6%A8%A1%E5%9E%8B%E7%B1%BB%E5%85%AC%E7%94%A8%E9%80%BB%E8%BE%91"><span class="toc-number">1.10.5.1.</span> <span class="toc-text">8.5.1 提取模型类公用逻辑</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5-2-%E8%BF%9B%E4%B8%80%E6%AD%A5%E5%87%8F%E5%B0%91%E8%B0%83%E7%94%A8%E5%B1%9E%E6%80%A7%E5%B1%82%E7%BA%A7"><span class="toc-number">1.10.5.2.</span> <span class="toc-text">8.5.2 进一步减少调用属性层级</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-6-%E5%AE%8C%E5%96%84%E5%8A%9F%E8%83%BD"><span class="toc-number">1.10.6.</span> <span class="toc-text">8.6 完善功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-6-1-%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E9%9B%86%E5%90%88"><span class="toc-number">1.10.6.1.</span> <span class="toc-text">8.6.1   创建用户集合</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-7-%E9%87%8D%E6%9E%84-%E6%8F%90%E5%8F%96%E5%A4%8D%E7%94%A8%E4%BB%A3%E7%A0%81"><span class="toc-number">1.10.7.</span> <span class="toc-text">8.7  重构-提取复用代码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-7-1-%E5%88%9B%E5%BB%BA%E9%80%9A%E7%94%A8%E9%9B%86%E5%90%88%E7%B1%BB"><span class="toc-number">1.10.7.1.</span> <span class="toc-text">8.7.1-创建通用集合类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-7-2-%E5%88%9B%E5%BB%BA%E8%8E%B7%E5%8F%96%E9%9B%86%E5%90%88%E7%9A%84%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95"><span class="toc-number">1.10.7.2.</span> <span class="toc-text">8.7.2 创建获取集合的静态方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-8-%E5%8A%9F%E8%83%BD%E5%AE%8C%E5%96%84"><span class="toc-number">1.10.8.</span> <span class="toc-text">8.8 功能完善</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-8-1-%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E8%A1%A8%E5%8D%95%E8%A7%86%E5%9B%BE%E7%B1%BB"><span class="toc-number">1.10.8.1.</span> <span class="toc-text">8.8.1 创建用户表单视图类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-8-2-%E4%B8%BA%E6%A8%A1%E6%9D%BF%E5%85%83%E7%B4%A0%E9%99%84%E5%8A%A0%E4%BA%8B%E4%BB%B6"><span class="toc-number">1.10.8.2.</span> <span class="toc-text">8.8.2 为模板元素附加事件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-8-3-%E7%BB%91%E5%AE%9A%E6%A8%A1%E5%9E%8B%E6%95%B0%E6%8D%AE"><span class="toc-number">1.10.8.3.</span> <span class="toc-text">8.8.3 绑定模型数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-8-4-%E9%9A%8F%E6%9C%BA%E5%B9%B4%E9%BE%84"><span class="toc-number">1.10.8.4.</span> <span class="toc-text">8.8.4  随机年龄</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-8-5-%E8%AE%BE%E7%BD%AE%E5%A7%93%E5%90%8D"><span class="toc-number">1.10.8.5.</span> <span class="toc-text">8.8.5 设置姓名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-8-6-%E4%B8%A5%E6%A0%BC%E7%A9%BA%E6%A3%80%E6%9F%A5"><span class="toc-number">1.10.8.6.</span> <span class="toc-text">8.8.6 严格空检查</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-9-%E9%87%8D%E6%9E%84-%E6%8F%90%E5%8F%96%E5%A4%8D%E7%94%A8%E4%BB%A3%E7%A0%81"><span class="toc-number">1.10.9.</span> <span class="toc-text">8.9 重构-提取复用代码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-9-1-%E5%88%9B%E5%BB%BA%E9%80%9A%E7%94%A8%E8%A7%86%E5%9B%BE%E7%B1%BB"><span class="toc-number">1.10.9.1.</span> <span class="toc-text">8.9.1 创建通用视图类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-9-2-%E9%80%9A%E8%BF%87%E6%B3%9B%E5%9E%8B%E6%8C%87%E5%AE%9A%E6%A8%A1%E5%9E%8B%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.10.9.2.</span> <span class="toc-text">8.9.2  通过泛型指定模型参数类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-10-%E5%AE%8C%E5%96%84%E5%8A%9F%E8%83%BD"><span class="toc-number">1.10.10.</span> <span class="toc-text">8.10 完善功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-10-1-%E4%BF%9D%E5%AD%98%E7%94%A8%E6%88%B7"><span class="toc-number">1.10.10.1.</span> <span class="toc-text">8.10.1 保存用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-10-2-%E5%88%9B%E5%BB%BA-UserShow-%E8%A7%86%E5%9B%BE%E7%B1%BB"><span class="toc-number">1.10.10.2.</span> <span class="toc-text">8.10.2 创建 UserShow 视图类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-10-3-%E5%88%9B%E5%BB%BA-UserEdit-%E8%A7%86%E5%9B%BE%E7%B1%BB"><span class="toc-number">1.10.10.3.</span> <span class="toc-text">8.10.3 创建 UserEdit 视图类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-10-4-%E8%A7%86%E5%9B%BE%E5%B5%8C%E5%A5%97"><span class="toc-number">1.10.10.4.</span> <span class="toc-text">8.10.4  视图嵌套</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-10-5-%E5%88%9B%E5%BB%BA%E9%80%9A%E7%94%A8%E9%9B%86%E5%90%88%E8%A7%86%E5%9B%BE%E7%B1%BB"><span class="toc-number">1.10.10.5.</span> <span class="toc-text">8.10.5 创建通用集合视图类</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/archives/88d3d46f.html" title="封装复选框组件"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/wallseven/wallseven48.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="封装复选框组件"/></a><div class="content"><a class="title" href="/archives/88d3d46f.html" title="封装复选框组件">封装复选框组件</a><time datetime="2023-04-07T01:31:00.000Z" title="Created 2023-04-07 09:31:00">2023-04-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/a9432027.html" title="路由守卫"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/wallseven/wallseven47.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="路由守卫"/></a><div class="content"><a class="title" href="/archives/a9432027.html" title="路由守卫">路由守卫</a><time datetime="2023-04-07T00:31:00.000Z" title="Created 2023-04-07 08:31:00">2023-04-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/12529ae2.html" title="React + TypeScript - 类组件"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/wallseven/wallseven45.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="React + TypeScript - 类组件"/></a><div class="content"><a class="title" href="/archives/12529ae2.html" title="React + TypeScript - 类组件">React + TypeScript - 类组件</a><time datetime="2023-04-02T07:31:00.000Z" title="Created 2023-04-02 15:31:00">2023-04-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/8ad35e55.html" title="React + TypeScript - 函数组件"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/wallseven/wallseven46.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="React + TypeScript - 函数组件"/></a><div class="content"><a class="title" href="/archives/8ad35e55.html" title="React + TypeScript - 函数组件">React + TypeScript - 函数组件</a><time datetime="2023-04-02T07:31:00.000Z" title="Created 2023-04-02 15:31:00">2023-04-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/942a5c06.html" title="react+ts规范化项目工程"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/wallseven/wallseven44.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="react+ts规范化项目工程"/></a><div class="content"><a class="title" href="/archives/942a5c06.html" title="react+ts规范化项目工程">react+ts规范化项目工程</a><time datetime="2023-04-01T03:31:00.000Z" title="Created 2023-04-01 11:31:00">2023-04-01</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By freelaeder</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '4J81xwLy9vrYOytbLOns5bwe-gzGzoHsz',
      appKey: 'B9fhoOdq525uv4Q5v7ugQj6q',
      placeholder: '您不再踩踩嘛ಠ_ಠ',
      avatar: 'hide',
      meta: 'nick,mail,link'.split(','),
      pageSize: '5',
      lang: 'en',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: true,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script src="/js/toos.js"></script><script src="/js/flower.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":null,"use":"live2d-widget-model-koharu","display":{"position":"left","width":100,"height":100},"mobile":{"show":true},"react":null,"opacity":0.9});</script><script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>